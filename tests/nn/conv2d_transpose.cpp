/**
 * @file ut_conv2d_transpose.cpp
 * @brief File generated by tests/nn/conv2d_transpose.py.
 * Tests for nn::conv2d_transpose function.
 */

#include <gtest/gtest.h>
#include "temper/NN.hpp"
#include "temper/SYCLQueue.hpp"

using namespace temper;

template<typename T>
class TypedConv2DTranspose : public ::testing:: Test {};

using Conv2DTransposeTestTypes = :: testing::Types<float>;
TYPED_TEST_SUITE(TypedConv2DTranspose, Conv2DTransposeTestTypes);


/**
 * @test TypedConv2DTranspose. basic_s2_nopad
 * @brief Conv2d transpose test: 
 *   input:  (1, 3, 3), kernel: (1, 1, 3, 3)
 *   stride: 2, padding: (0, 0), output_padding: (0, 0)
 */
TYPED_TEST(TypedConv2DTranspose, basic_s2_nopad)
{
    using value_t = TypeParam;

    Tensor<value_t> input(
        {1, 3, 3},
        MemoryLocation::DEVICE
    );

    std::vector<value_t> input_vals(9);
    input_vals[0] = static_cast<value_t>(-1.45094823837280273);
    input_vals[1] = static_cast<value_t>(1.91095316410064697);
    input_vals[2] = static_cast<value_t>(0.71187913417816162);
    input_vals[3] = static_cast<value_t>(-0.24773828685283661);
    input_vals[4] = static_cast<value_t>(0.36146622896194458);
    input_vals[5] = static_cast<value_t>(-0.03294967114925385);
    input_vals[6] = static_cast<value_t>(-0.22134672105312347);
    input_vals[7] = static_cast<value_t>(0.47725677490234375);
    input_vals[8] = static_cast<value_t>(-0.69193935394287109);
    input = input_vals;

    Tensor<value_t> kernel(
        {1, 1, 3, 3},
        MemoryLocation::DEVICE
    );

    std::vector<value_t> kernel_vals(9);
    kernel_vals[0] = static_cast<value_t>(0.79200595617294312);
    kernel_vals[1] = static_cast<value_t>(0.07324913144111633);
    kernel_vals[2] = static_cast<value_t>(1.30328607559204102);
    kernel_vals[3] = static_cast<value_t>(0.21348148584365845);
    kernel_vals[4] = static_cast<value_t>(1.01734900474548340);
    kernel_vals[5] = static_cast<value_t>(1.91171181201934814);
    kernel_vals[6] = static_cast<value_t>(-0.52967160940170288);
    kernel_vals[7] = static_cast<value_t>(1.84213519096374512);
    kernel_vals[8] = static_cast<value_t>(-1.05723512172698975);
    kernel = kernel_vals;

    // Run conv2d_transpose
    Tensor<value_t> result = nn:: conv2d_transpose<value_t>(
        input, kernel, 2, {0, 0}, {0, 0}
    );

    std::vector<value_t> expected(49);
    expected[0] = static_cast<value_t>(-1.14915966987609863);
    expected[1] = static_cast<value_t>(-0.10628069937229156);
    expected[2] = static_cast<value_t>(-0.37751436233520508);
    expected[3] = static_cast<value_t>(0.13997565209865570);
    expected[4] = static_cast<value_t>(3.05433106422424316);
    expected[5] = static_cast<value_t>(0.05214452743530273);
    expected[6] = static_cast<value_t>(0.92778217792510986);
    expected[7] = static_cast<value_t>(-0.30975058674812317);
    expected[8] = static_cast<value_t>(-1.47612071037292480);
    expected[9] = static_cast<value_t>(-2.36584186553955078);
    expected[10] = static_cast<value_t>(1.94410634040832520);
    expected[11] = static_cast<value_t>(3.80516481399536133);
    expected[12] = static_cast<value_t>(0.72422951459884644);
    expected[13] = static_cast<value_t>(1.36090779304504395);
    expected[14] = static_cast<value_t>(0.57231587171554565);
    expected[15] = static_cast<value_t>(-2.69098925590515137);
    expected[16] = static_cast<value_t>(0.48522543907165527);
    expected[17] = static_cast<value_t>(3.54671120643615723);
    expected[18] = static_cast<value_t>(-1.95239150524139404);
    expected[19] = static_cast<value_t>(1.30896413326263428);
    expected[20] = static_cast<value_t>(-0.79556643962860107);
    expected[21] = static_cast<value_t>(-0.05288753658533096);
    expected[22] = static_cast<value_t>(-0.25203630328178406);
    expected[23] = static_cast<value_t>(-0.39643785357475281);
    expected[24] = static_cast<value_t>(0.36773732304573059);
    expected[25] = static_cast<value_t>(0.68398511409759521);
    expected[26] = static_cast<value_t>(-0.03352131694555283);
    expected[27] = static_cast<value_t>(-0.06299027800559998);
    expected[28] = static_cast<value_t>(-0.04408797621726990);
    expected[29] = static_cast<value_t>(-0.47258085012435913);
    expected[30] = static_cast<value_t>(0.15997132658958435);
    expected[31] = static_cast<value_t>(0.70082831382751465);
    expected[32] = static_cast<value_t>(-0.29072022438049316);
    expected[33] = static_cast<value_t>(-0.11138170957565308);
    expected[34] = static_cast<value_t>(-0.86695933341979980);
    expected[35] = static_cast<value_t>(-0.04725342616438866);
    expected[36] = static_cast<value_t>(-0.22518686950206757);
    expected[37] = static_cast<value_t>(-0.32126563787460327);
    expected[38] = static_cast<value_t>(0.48553669452667236);
    expected[39] = static_cast<value_t>(0.76466119289398193);
    expected[40] = static_cast<value_t>(-0.70394378900527954);
    expected[41] = static_cast<value_t>(-1.32278859615325928);
    expected[42] = static_cast<value_t>(0.11724107712507248);
    expected[43] = static_cast<value_t>(-0.40775057673454285);
    expected[44] = static_cast<value_t>(-0.01877385377883911);
    expected[45] = static_cast<value_t>(0.87917149066925049);
    expected[46] = static_cast<value_t>(-0.13807198405265808);
    expected[47] = static_cast<value_t>(-1.27464580535888672);
    expected[48] = static_cast<value_t>(0.73154258728027344);

    std::vector<value_t> host(expected.size());
    g_sycl_queue.memcpy(host.data(), result.m_p_data. get(),
                        host.size() * sizeof(value_t)).wait();

    // Compare results
    for (size_t i = 0; i < host.size(); ++i)
    {
        if constexpr (std::is_floating_point<value_t>::value)
        {
            EXPECT_NEAR(static_cast<double>(host[i]),
                        static_cast<double>(expected[i]), 0.0001);
        }
        else
        {
            EXPECT_EQ(host[i], expected[i]);
        }
    }
}

/**
 * @test TypedConv2DTranspose. basic_s2_pad1
 * @brief Conv2d transpose test: 
 *   input:  (1, 3, 3), kernel: (1, 1, 3, 3)
 *   stride: 2, padding: (1, 1), output_padding: (0, 0)
 */
TYPED_TEST(TypedConv2DTranspose, basic_s2_pad1)
{
    using value_t = TypeParam;

    Tensor<value_t> input(
        {1, 3, 3},
        MemoryLocation::DEVICE
    );

    std::vector<value_t> input_vals(9);
    input_vals[0] = static_cast<value_t>(0.31678345799446106);
    input_vals[1] = static_cast<value_t>(-0.49341708421707153);
    input_vals[2] = static_cast<value_t>(1.21794581413269043);
    input_vals[3] = static_cast<value_t>(0.43677076697349548);
    input_vals[4] = static_cast<value_t>(-0.72769266366958618);
    input_vals[5] = static_cast<value_t>(0.43030744791030884);
    input_vals[6] = static_cast<value_t>(-0.68666529655456543);
    input_vals[7] = static_cast<value_t>(-0.45301800966262817);
    input_vals[8] = static_cast<value_t>(-0.73285919427871704);
    input = input_vals;

    Tensor<value_t> kernel(
        {1, 1, 3, 3},
        MemoryLocation::DEVICE
    );

    std::vector<value_t> kernel_vals(9);
    kernel_vals[0] = static_cast<value_t>(-0.75362741947174072);
    kernel_vals[1] = static_cast<value_t>(-0.83251893520355225);
    kernel_vals[2] = static_cast<value_t>(0.44987186789512634);
    kernel_vals[3] = static_cast<value_t>(1.80752301216125488);
    kernel_vals[4] = static_cast<value_t>(-0.48953136801719666);
    kernel_vals[5] = static_cast<value_t>(0.88158875703811646);
    kernel_vals[6] = static_cast<value_t>(-0.69834089279174805);
    kernel_vals[7] = static_cast<value_t>(-0.04997470602393150);
    kernel_vals[8] = static_cast<value_t>(1.90752232074737549);
    kernel = kernel_vals;

    // Run conv2d_transpose
    Tensor<value_t> result = nn:: conv2d_transpose<value_t>(
        input, kernel, 2, {1, 1}, {0, 0}
    );

    std::vector<value_t> expected(25);
    expected[0] = static_cast<value_t>(-0.15507544577121735);
    expected[1] = static_cast<value_t>(-0.61259001493453979);
    expected[2] = static_cast<value_t>(0.24154314398765564);
    expected[3] = static_cast<value_t>(1.76647424697875977);
    expected[4] = static_cast<value_t>(-0.59622269868850708);
    expected[5] = static_cast<value_t>(-0.37945109605789185);
    expected[6] = static_cast<value_t>(1.69374489784240723);
    expected[7] = static_cast<value_t>(0.63047629594802856);
    expected[8] = static_cast<value_t>(-2.44340538978576660);
    expected[9] = static_cast<value_t>(-0.41910555958747864);
    expected[10] = static_cast<value_t>(-0.21381299197673798);
    expected[11] = static_cast<value_t>(-0.93026900291442871);
    expected[12] = static_cast<value_t>(0.35622838139533997);
    expected[13] = static_cast<value_t>(0.13626492023468018);
    expected[14] = static_cast<value_t>(-0.21064899861812592);
    expected[15] = static_cast<value_t>(0.54983437061309814);
    expected[16] = static_cast<value_t>(1.37382292747497559);
    expected[17] = static_cast<value_t>(0.41351228952407837);
    expected[18] = static_cast<value_t>(-1.34008860588073730);
    expected[19] = static_cast<value_t>(0.58861470222473145);
    expected[20] = static_cast<value_t>(0.33614420890808105);
    expected[21] = static_cast<value_t>(-1.42419695854187012);
    expected[22] = static_cast<value_t>(0.22176653146743774);
    expected[23] = static_cast<value_t>(-1.72403538227081299);
    expected[24] = static_cast<value_t>(0.35875755548477173);

    std::vector<value_t> host(expected.size());
    g_sycl_queue.memcpy(host.data(), result.m_p_data. get(),
                        host.size() * sizeof(value_t)).wait();

    // Compare results
    for (size_t i = 0; i < host.size(); ++i)
    {
        if constexpr (std::is_floating_point<value_t>::value)
        {
            EXPECT_NEAR(static_cast<double>(host[i]),
                        static_cast<double>(expected[i]), 0.0001);
        }
        else
        {
            EXPECT_EQ(host[i], expected[i]);
        }
    }
}

/**
 * @test TypedConv2DTranspose. basic_s2_4x4
 * @brief Conv2d transpose test: 
 *   input:  (1, 4, 4), kernel: (1, 1, 3, 3)
 *   stride: 2, padding: (0, 0), output_padding: (0, 0)
 */
TYPED_TEST(TypedConv2DTranspose, basic_s2_4x4)
{
    using value_t = TypeParam;

    Tensor<value_t> input(
        {1, 4, 4},
        MemoryLocation::DEVICE
    );

    std::vector<value_t> input_vals(16);
    input_vals[0] = static_cast<value_t>(-0.73587375879287720);
    input_vals[1] = static_cast<value_t>(-0.86015313863754272);
    input_vals[2] = static_cast<value_t>(-0.92328238487243652);
    input_vals[3] = static_cast<value_t>(0.23845311999320984);
    input_vals[4] = static_cast<value_t>(-0.58321624994277954);
    input_vals[5] = static_cast<value_t>(0.67432552576065063);
    input_vals[6] = static_cast<value_t>(0.02370044030249119);
    input_vals[7] = static_cast<value_t>(0.22111871838569641);
    input_vals[8] = static_cast<value_t>(-0.83998936414718628);
    input_vals[9] = static_cast<value_t>(-0.12453543394804001);
    input_vals[10] = static_cast<value_t>(1.04406559467315674);
    input_vals[11] = static_cast<value_t>(-0.17260085046291351);
    input_vals[12] = static_cast<value_t>(1.52395987510681152);
    input_vals[13] = static_cast<value_t>(-0.55615597963333130);
    input_vals[14] = static_cast<value_t>(0.42340072989463806);
    input_vals[15] = static_cast<value_t>(-0.32132434844970703);
    input = input_vals;

    Tensor<value_t> kernel(
        {1, 1, 3, 3},
        MemoryLocation::DEVICE
    );

    std::vector<value_t> kernel_vals(9);
    kernel_vals[0] = static_cast<value_t>(-1.35914921760559082);
    kernel_vals[1] = static_cast<value_t>(0.23346489667892456);
    kernel_vals[2] = static_cast<value_t>(1.54657065868377686);
    kernel_vals[3] = static_cast<value_t>(-0.41466724872589111);
    kernel_vals[4] = static_cast<value_t>(-1.79020917415618896);
    kernel_vals[5] = static_cast<value_t>(-0.29215702414512634);
    kernel_vals[6] = static_cast<value_t>(-0.33103919029235840);
    kernel_vals[7] = static_cast<value_t>(0.80995708703994751);
    kernel_vals[8] = static_cast<value_t>(-1.13034880161285400);
    kernel = kernel_vals;

    // Run conv2d_transpose
    Tensor<value_t> result = nn:: conv2d_transpose<value_t>(
        input, kernel, 2, {0, 0}, {0, 0}
    );

    std::vector<value_t> expected(81);
    expected[0] = static_cast<value_t>(1.00016224384307861);
    expected[1] = static_cast<value_t>(-0.17180068790912628);
    expected[2] = static_cast<value_t>(0.03099572658538818);
    expected[3] = static_cast<value_t>(-0.20081555843353271);
    expected[4] = static_cast<value_t>(-0.07540905475616455);
    expected[5] = static_cast<value_t>(-0.21555402874946594);
    expected[6] = static_cast<value_t>(-1.75201475620269775);
    expected[7] = static_cast<value_t>(0.05567043274641037);
    expected[8] = static_cast<value_t>(0.36878460645675659);
    expected[9] = static_cast<value_t>(0.30514276027679443);
    expected[10] = static_cast<value_t>(1.31736791133880615);
    expected[11] = static_cast<value_t>(0.57166802883148193);
    expected[12] = static_cast<value_t>(1.53985404968261719);
    expected[13] = static_cast<value_t>(0.63415473699569702);
    expected[14] = static_cast<value_t>(1.65286862850189209);
    expected[15] = static_cast<value_t>(0.17086474597454071);
    expected[16] = static_cast<value_t>(-0.42688095569610596);
    expected[17] = static_cast<value_t>(-0.06966575235128403);
    expected[18] = static_cast<value_t>(1.03628098964691162);
    expected[19] = static_cast<value_t>(-0.73218667507171631);
    expected[20] = static_cast<value_t>(-0.70195579528808594);
    expected[21] = static_cast<value_t>(-0.53925573825836182);
    expected[22] = static_cast<value_t>(2.28859543800354004);
    expected[23] = static_cast<value_t>(-0.74228590726852417);
    expected[24] = static_cast<value_t>(0.70081496238708496);
    expected[25] = static_cast<value_t>(0.24476025998592377);
    expected[26] = static_cast<value_t>(0.07244053483009338);
    expected[27] = static_cast<value_t>(0.24184067547321320);
    expected[28] = static_cast<value_t>(1.04407906532287598);
    expected[29] = static_cast<value_t>(-0.10922998189926147);
    expected[30] = static_cast<value_t>(-1.20718371868133545);
    expected[31] = static_cast<value_t>(-0.20683673024177551);
    expected[32] = static_cast<value_t>(-0.04242874681949615);
    expected[33] = static_cast<value_t>(-0.09861493855714798);
    expected[34] = static_cast<value_t>(-0.39584875106811523);
    expected[35] = static_cast<value_t>(-0.06460138410329819);
    expected[36] = static_cast<value_t>(1.33473837375640869);
    expected[37] = static_cast<value_t>(-0.66848814487457275);
    expected[38] = static_cast<value_t>(-0.69383102655410767);
    expected[39] = static_cast<value_t>(0.51710009574890137);
    expected[40] = static_cast<value_t>(-2.38171267509460449);
    expected[41] = static_cast<value_t>(0.26294901967048645);
    expected[42] = static_cast<value_t>(1.74932277202606201);
    expected[43] = static_cast<value_t>(0.13880042731761932);
    expected[44] = static_cast<value_t>(-0.51688069105148315);
    expected[45] = static_cast<value_t>(0.34831607341766357);
    expected[46] = static_cast<value_t>(1.50375664234161377);
    expected[47] = static_cast<value_t>(0.29704955220222473);
    expected[48] = static_cast<value_t>(0.22294448316097260);
    expected[49] = static_cast<value_t>(-0.39655590057373047);
    expected[50] = static_cast<value_t>(-1.86909580230712891);
    expected[51] = static_cast<value_t>(-0.23345917463302612);
    expected[52] = static_cast<value_t>(0.30899164080619812);
    expected[53] = static_cast<value_t>(0.05042655020952225);
    expected[54] = static_cast<value_t>(-1.79321944713592529);
    expected[55] = static_cast<value_t>(-0.32456418871879578);
    expected[56] = static_cast<value_t>(4.10351753234863281);
    expected[57] = static_cast<value_t>(-0.23071125149726868);
    expected[58] = static_cast<value_t>(-1.64045739173889160);
    expected[59] = static_cast<value_t>(0.94449758529663086);
    expected[60] = static_cast<value_t>(-0.03147375583648682);
    expected[61] = static_cast<value_t>(-0.21481724083423615);
    expected[62] = static_cast<value_t>(-0.30185163021087646);
    expected[63] = static_cast<value_t>(-0.63193625211715698);
    expected[64] = static_cast<value_t>(-2.72820687294006348);
    expected[65] = static_cast<value_t>(-0.21461591124534607);
    expected[66] = static_cast<value_t>(0.99563550949096680);
    expected[67] = static_cast<value_t>(-0.01308554410934448);
    expected[68] = static_cast<value_t>(-0.75797587633132935);
    expected[69] = static_cast<value_t>(0.00954318791627884);
    expected[70] = static_cast<value_t>(0.57523781061172485);
    expected[71] = static_cast<value_t>(0.09387716650962830);
    expected[72] = static_cast<value_t>(-0.50449043512344360);
    expected[73] = static_cast<value_t>(1.23434209823608398);
    expected[74] = static_cast<value_t>(-1.53849673271179199);
    expected[75] = static_cast<value_t>(-0.45046249032020569);
    expected[76] = static_cast<value_t>(0.48848801851272583);
    expected[77] = static_cast<value_t>(0.34293642640113831);
    expected[78] = static_cast<value_t>(-0.37221956253051758);
    expected[79] = static_cast<value_t>(-0.26025894284248352);
    expected[80] = static_cast<value_t>(0.36320859193801880);

    std::vector<value_t> host(expected.size());
    g_sycl_queue.memcpy(host.data(), result.m_p_data. get(),
                        host.size() * sizeof(value_t)).wait();

    // Compare results
    for (size_t i = 0; i < host.size(); ++i)
    {
        if constexpr (std::is_floating_point<value_t>::value)
        {
            EXPECT_NEAR(static_cast<double>(host[i]),
                        static_cast<double>(expected[i]), 0.0001);
        }
        else
        {
            EXPECT_EQ(host[i], expected[i]);
        }
    }
}

/**
 * @test TypedConv2DTranspose. multi_in_channels
 * @brief Conv2d transpose test: 
 *   input:  (2, 3, 3), kernel: (2, 1, 3, 3)
 *   stride: 2, padding: (0, 0), output_padding: (0, 0)
 */
TYPED_TEST(TypedConv2DTranspose, multi_in_channels)
{
    using value_t = TypeParam;

    Tensor<value_t> input(
        {2, 3, 3},
        MemoryLocation::DEVICE
    );

    std::vector<value_t> input_vals(18);
    input_vals[0] = static_cast<value_t>(-0.35005822777748108);
    input_vals[1] = static_cast<value_t>(0.39151501655578613);
    input_vals[2] = static_cast<value_t>(2.13081932067871094);
    input_vals[3] = static_cast<value_t>(-0.83965003490447998);
    input_vals[4] = static_cast<value_t>(0.80189287662506104);
    input_vals[5] = static_cast<value_t>(0.18407188355922699);
    input_vals[6] = static_cast<value_t>(0.79008698463439941);
    input_vals[7] = static_cast<value_t>(-0.73250931501388550);
    input_vals[8] = static_cast<value_t>(1.21207559108734131);
    input_vals[9] = static_cast<value_t>(0.57256084680557251);
    input_vals[10] = static_cast<value_t>(-0.30912673473358154);
    input_vals[11] = static_cast<value_t>(0.87436187267303467);
    input_vals[12] = static_cast<value_t>(0.16310583055019379);
    input_vals[13] = static_cast<value_t>(2.58404707908630371);
    input_vals[14] = static_cast<value_t>(1.49225020408630371);
    input_vals[15] = static_cast<value_t>(1.19969582557678223);
    input_vals[16] = static_cast<value_t>(0.01425854861736298);
    input_vals[17] = static_cast<value_t>(-0.30933752655982971);
    input = input_vals;

    Tensor<value_t> kernel(
        {2, 1, 3, 3},
        MemoryLocation::DEVICE
    );

    std::vector<value_t> kernel_vals(18);
    kernel_vals[0] = static_cast<value_t>(0.52442193031311035);
    kernel_vals[1] = static_cast<value_t>(0.24628151953220367);
    kernel_vals[2] = static_cast<value_t>(-1.66625356674194336);
    kernel_vals[3] = static_cast<value_t>(-0.23378993570804596);
    kernel_vals[4] = static_cast<value_t>(0.68252581357955933);
    kernel_vals[5] = static_cast<value_t>(0.08235333114862442);
    kernel_vals[6] = static_cast<value_t>(0.97563153505325317);
    kernel_vals[7] = static_cast<value_t>(-0.53718191385269165);
    kernel_vals[8] = static_cast<value_t>(-0.28126677870750427);
    kernel_vals[9] = static_cast<value_t>(-1.41509473323822021);
    kernel_vals[10] = static_cast<value_t>(-0.39708673954010010);
    kernel_vals[11] = static_cast<value_t>(-0.19729605317115784);
    kernel_vals[12] = static_cast<value_t>(-0.11888910830020905);
    kernel_vals[13] = static_cast<value_t>(0.94087994098663330);
    kernel_vals[14] = static_cast<value_t>(-0.18783132731914520);
    kernel_vals[15] = static_cast<value_t>(-0.51047176122665405);
    kernel_vals[16] = static_cast<value_t>(-0.14979259669780731);
    kernel_vals[17] = static_cast<value_t>(0.92493748664855957);
    kernel = kernel_vals;

    // Run conv2d_transpose
    Tensor<value_t> result = nn:: conv2d_transpose<value_t>(
        input, kernel, 2, {0, 0}, {0, 0}
    );

    std::vector<value_t> expected(49);
    expected[0] = static_cast<value_t>(-0.99380600452423096);
    expected[1] = static_cast<value_t>(-0.31356918811798096);
    expected[2] = static_cast<value_t>(1.11308443546295166);
    expected[3] = static_cast<value_t>(0.21917304396629333);
    expected[4] = static_cast<value_t>(-0.71123039722442627);
    expected[5] = static_cast<value_t>(0.17758390307426453);
    expected[6] = static_cast<value_t>(-3.72299361228942871);
    expected[7] = static_cast<value_t>(0.01376884430646896);
    expected[8] = static_cast<value_t>(0.29978722333908081);
    expected[9] = static_cast<value_t>(-0.19115379452705383);
    expected[10] = static_cast<value_t>(-0.02363204956054688);
    expected[11] = static_cast<value_t>(-0.51180994510650635);
    expected[12] = static_cast<value_t>(2.27700877189636230);
    expected[13] = static_cast<value_t>(0.01124751567840576);
    expected[14] = static_cast<value_t>(-1.30494499206542969);
    expected[15] = static_cast<value_t>(-0.16927787661552429);
    expected[16] = static_cast<value_t>(-0.70143389701843262);
    expected[17] = static_cast<value_t>(-0.99260932207107544);
    expected[18] = static_cast<value_t>(-2.62460875511169434);
    expected[19] = static_cast<value_t>(-1.82282984256744385);
    expected[20] = static_cast<value_t>(-0.39172410964965820);
    expected[21] = static_cast<value_t>(0.17691022157669067);
    expected[22] = static_cast<value_t>(-0.41961979866027832);
    expected[23] = static_cast<value_t>(-0.59447389841079712);
    expected[24] = static_cast<value_t>(2.97859048843383789);
    expected[25] = static_cast<value_t>(-0.63977289199829102);
    expected[26] = static_cast<value_t>(1.52966213226318359);
    expected[27] = static_cast<value_t>(-0.26513242721557617);
    expected[28] = static_cast<value_t>(-2.18579435348510742);
    expected[29] = static_cast<value_t>(0.14481326937675476);
    expected[30] = static_cast<value_t>(-2.10720443725585938);
    expected[31] = static_cast<value_t>(-1.00389885902404785);
    expected[32] = static_cast<value_t>(3.87348508834838867);
    expected[33] = static_cast<value_t>(0.09893754124641418);
    expected[34] = static_cast<value_t>(-0.63012921810150146);
    expected[35] = static_cast<value_t>(-0.32734516263008118);
    expected[36] = static_cast<value_t>(1.66802453994750977);
    expected[37] = static_cast<value_t>(0.00928395986557007);
    expected[38] = static_cast<value_t>(-0.48654094338417053);
    expected[39] = static_cast<value_t>(-0.30959698557853699);
    expected[40] = static_cast<value_t>(0.53622341156005859);
    expected[41] = static_cast<value_t>(0.15792173147201538);
    expected[42] = static_cast<value_t>(0.15842294692993164);
    expected[43] = static_cast<value_t>(-0.60412597656250000);
    expected[44] = static_cast<value_t>(0.16548073291778564);
    expected[45] = static_cast<value_t>(0.39135494828224182);
    expected[46] = static_cast<value_t>(1.55966615676879883);
    expected[47] = static_cast<value_t>(-0.60476863384246826);
    expected[48] = static_cast<value_t>(-0.62703448534011841);

    std::vector<value_t> host(expected.size());
    g_sycl_queue.memcpy(host.data(), result.m_p_data. get(),
                        host.size() * sizeof(value_t)).wait();

    // Compare results
    for (size_t i = 0; i < host.size(); ++i)
    {
        if constexpr (std::is_floating_point<value_t>::value)
        {
            EXPECT_NEAR(static_cast<double>(host[i]),
                        static_cast<double>(expected[i]), 0.0001);
        }
        else
        {
            EXPECT_EQ(host[i], expected[i]);
        }
    }
}

/**
 * @test TypedConv2DTranspose. multi_out_channels
 * @brief Conv2d transpose test: 
 *   input:  (1, 3, 3), kernel: (1, 3, 3, 3)
 *   stride: 2, padding: (0, 0), output_padding: (0, 0)
 */
TYPED_TEST(TypedConv2DTranspose, multi_out_channels)
{
    using value_t = TypeParam;

    Tensor<value_t> input(
        {1, 3, 3},
        MemoryLocation::DEVICE
    );

    std::vector<value_t> input_vals(9);
    input_vals[0] = static_cast<value_t>(-0.17869535088539124);
    input_vals[1] = static_cast<value_t>(0.64764511585235596);
    input_vals[2] = static_cast<value_t>(0.24795007705688477);
    input_vals[3] = static_cast<value_t>(0.36234638094902039);
    input_vals[4] = static_cast<value_t>(1.48163998126983643);
    input_vals[5] = static_cast<value_t>(-1.55651557445526123);
    input_vals[6] = static_cast<value_t>(-0.06545094400644302);
    input_vals[7] = static_cast<value_t>(-1.72247648239135742);
    input_vals[8] = static_cast<value_t>(-0.84323436021804810);
    input = input_vals;

    Tensor<value_t> kernel(
        {1, 3, 3, 3},
        MemoryLocation::DEVICE
    );

    std::vector<value_t> kernel_vals(27);
    kernel_vals[0] = static_cast<value_t>(-0.79053682088851929);
    kernel_vals[1] = static_cast<value_t>(0.26354432106018066);
    kernel_vals[2] = static_cast<value_t>(0.77909243106842041);
    kernel_vals[3] = static_cast<value_t>(-0.33377936482429504);
    kernel_vals[4] = static_cast<value_t>(-0.35067149996757507);
    kernel_vals[5] = static_cast<value_t>(-1.33208894729614258);
    kernel_vals[6] = static_cast<value_t>(0.67972910404205322);
    kernel_vals[7] = static_cast<value_t>(0.03645185753703117);
    kernel_vals[8] = static_cast<value_t>(0.39005005359649658);
    kernel_vals[9] = static_cast<value_t>(0.16444744169712067);
    kernel_vals[10] = static_cast<value_t>(1.06358456611633301);
    kernel_vals[11] = static_cast<value_t>(-0.76326745748519897);
    kernel_vals[12] = static_cast<value_t>(-1.71401166915893555);
    kernel_vals[13] = static_cast<value_t>(0.60365790128707886);
    kernel_vals[14] = static_cast<value_t>(0.21445913612842560);
    kernel_vals[15] = static_cast<value_t>(0.15238329768180847);
    kernel_vals[16] = static_cast<value_t>(-0.44915363192558289);
    kernel_vals[17] = static_cast<value_t>(1.15109300613403320);
    kernel_vals[18] = static_cast<value_t>(2.54973983764648438);
    kernel_vals[19] = static_cast<value_t>(-0.89361989498138428);
    kernel_vals[20] = static_cast<value_t>(0.30017474293708801);
    kernel_vals[21] = static_cast<value_t>(0.66364276409149170);
    kernel_vals[22] = static_cast<value_t>(2.21349477767944336);
    kernel_vals[23] = static_cast<value_t>(-1.23949992656707764);
    kernel_vals[24] = static_cast<value_t>(-0.09750553965568542);
    kernel_vals[25] = static_cast<value_t>(1.63919603824615479);
    kernel_vals[26] = static_cast<value_t>(0.62213569879531860);
    kernel = kernel_vals;

    // Run conv2d_transpose
    Tensor<value_t> result = nn:: conv2d_transpose<value_t>(
        input, kernel, 2, {0, 0}, {0, 0}
    );

    std::vector<value_t> expected(147);
    expected[0] = static_cast<value_t>(0.14126525819301605);
    expected[1] = static_cast<value_t>(-0.04709414392709732);
    expected[2] = static_cast<value_t>(-0.65120750665664673);
    expected[3] = static_cast<value_t>(0.17068319022655487);
    expected[4] = static_cast<value_t>(0.30856177210807800);
    expected[5] = static_cast<value_t>(0.06534583121538162);
    expected[6] = static_cast<value_t>(0.19317603111267090);
    expected[7] = static_cast<value_t>(0.05964482203125954);
    expected[8] = static_cast<value_t>(0.06266336888074875);
    expected[9] = static_cast<value_t>(0.02186752855777740);
    expected[10] = static_cast<value_t>(-0.22711068391799927);
    expected[11] = static_cast<value_t>(-0.94548153877258301);
    expected[12] = static_cast<value_t>(-0.08694902807474136);
    expected[13] = static_cast<value_t>(-0.33029156923294067);
    expected[14] = static_cast<value_t>(-0.40791258215904236);
    expected[15] = static_cast<value_t>(0.08898055553436279);
    expected[16] = static_cast<value_t>(-0.51846659183502197);
    expected[17] = static_cast<value_t>(0.41408568620681763);
    expected[18] = static_cast<value_t>(2.80597019195556641);
    expected[19] = static_cast<value_t>(-0.40117260813713074);
    expected[20] = static_cast<value_t>(-1.11595654487609863);
    expected[21] = static_cast<value_t>(-0.12094374746084213);
    expected[22] = static_cast<value_t>(-0.12706455588340759);
    expected[23] = static_cast<value_t>(-0.97721844911575317);
    expected[24] = static_cast<value_t>(-0.51956892013549805);
    expected[25] = static_cast<value_t>(-1.45414340496063232);
    expected[26] = static_cast<value_t>(0.54582566022872925);
    expected[27] = static_cast<value_t>(2.07341718673706055);
    expected[28] = static_cast<value_t>(0.29803875088691711);
    expected[29] = static_cast<value_t>(-0.00404102634638548);
    expected[30] = static_cast<value_t>(2.45913553237915039);
    expected[31] = static_cast<value_t>(-0.39994037151336670);
    expected[32] = static_cast<value_t>(-1.15545582771301270);
    expected[33] = static_cast<value_t>(-0.27896749973297119);
    expected[34] = static_cast<value_t>(-1.26407647132873535);
    expected[35] = static_cast<value_t>(0.02184617519378662);
    expected[36] = static_cast<value_t>(0.02295177988708019);
    expected[37] = static_cast<value_t>(0.66211354732513428);
    expected[38] = static_cast<value_t>(0.60402339696884155);
    expected[39] = static_cast<value_t>(2.57594609260559082);
    expected[40] = static_cast<value_t>(0.29569825530052185);
    expected[41] = static_cast<value_t>(1.12326312065124512);
    expected[42] = static_cast<value_t>(-0.04448891058564186);
    expected[43] = static_cast<value_t>(-0.00238580838777125);
    expected[44] = static_cast<value_t>(-1.19634652137756348);
    expected[45] = static_cast<value_t>(-0.06278746575117111);
    expected[46] = static_cast<value_t>(-1.24502301216125488);
    expected[47] = static_cast<value_t>(-0.03073745965957642);
    expected[48] = static_cast<value_t>(-0.32890361547470093);
    expected[49] = static_cast<value_t>(-0.02938599325716496);
    expected[50] = static_cast<value_t>(-0.19005762040615082);
    expected[51] = static_cast<value_t>(0.24289593100547791);
    expected[52] = static_cast<value_t>(0.68882536888122559);
    expected[53] = static_cast<value_t>(-0.45355167984962463);
    expected[54] = static_cast<value_t>(0.26371586322784424);
    expected[55] = static_cast<value_t>(-0.18925222754478455);
    expected[56] = static_cast<value_t>(0.30628591775894165);
    expected[57] = static_cast<value_t>(-0.10787086188793182);
    expected[58] = static_cast<value_t>(-1.14839410781860352);
    expected[59] = static_cast<value_t>(0.39095610380172729);
    expected[60] = static_cast<value_t>(-0.28609591722488403);
    expected[61] = static_cast<value_t>(0.14967702329158783);
    expected[62] = static_cast<value_t>(0.05317515879869461);
    expected[63] = static_cast<value_t>(0.03235674649477005);
    expected[64] = static_cast<value_t>(0.46564769744873047);
    expected[65] = static_cast<value_t>(-0.13991995155811310);
    expected[66] = static_cast<value_t>(1.28495728969573975);
    expected[67] = static_cast<value_t>(-0.60356932878494263);
    expected[68] = static_cast<value_t>(-1.76685369014739990);
    expected[69] = static_cast<value_t>(1.47345125675201416);
    expected[70] = static_cast<value_t>(-0.62106591463088989);
    expected[71] = static_cast<value_t>(0.21873325109481812);
    expected[72] = static_cast<value_t>(-2.46183967590332031);
    expected[73] = static_cast<value_t>(0.89440369606018066);
    expected[74] = static_cast<value_t>(2.98563694953918457);
    expected[75] = static_cast<value_t>(-0.93960291147232056);
    expected[76] = static_cast<value_t>(-0.33380898833274841);
    expected[77] = static_cast<value_t>(0.04445229843258858);
    expected[78] = static_cast<value_t>(-0.23236179351806641);
    expected[79] = static_cast<value_t>(0.40957129001617432);
    expected[80] = static_cast<value_t>(-2.49748325347900391);
    expected[81] = static_cast<value_t>(2.64436101913452148);
    expected[82] = static_cast<value_t>(-0.19773644208908081);
    expected[83] = static_cast<value_t>(-1.14808082580566406);
    expected[84] = static_cast<value_t>(0.11218368262052536);
    expected[85] = static_cast<value_t>(-0.03950997814536095);
    expected[86] = static_cast<value_t>(2.93830823898315430);
    expected[87] = static_cast<value_t>(-1.03978657722473145);
    expected[88] = static_cast<value_t>(1.07591271400451660);
    expected[89] = static_cast<value_t>(-0.50902509689331055);
    expected[90] = static_cast<value_t>(-0.18083931505680084);
    expected[91] = static_cast<value_t>(-0.00997363030910492);
    expected[92] = static_cast<value_t>(0.02939752861857414);
    expected[93] = static_cast<value_t>(-0.33781677484512329);
    expected[94] = static_cast<value_t>(0.77365654706954956);
    expected[95] = static_cast<value_t>(-2.11122536659240723);
    expected[96] = static_cast<value_t>(0.37874177098274231);
    expected[97] = static_cast<value_t>(-0.97064119577407837);
    expected[98] = static_cast<value_t>(-0.45562666654586792);
    expected[99] = static_cast<value_t>(0.15968571603298187);
    expected[100] = static_cast<value_t>(1.59768676757812500);
    expected[101] = static_cast<value_t>(-0.57874858379364014);
    expected[102] = static_cast<value_t>(0.82661485671997070);
    expected[103] = static_cast<value_t>(-0.22157311439514160);
    expected[104] = static_cast<value_t>(0.07442834973335266);
    expected[105] = static_cast<value_t>(-0.11858987808227539);
    expected[106] = static_cast<value_t>(-0.39554122090339661);
    expected[107] = static_cast<value_t>(0.65129786729812622);
    expected[108] = static_cast<value_t>(1.43355906009674072);
    expected[109] = static_cast<value_t>(-0.63820576667785645);
    expected[110] = static_cast<value_t>(0.54883617162704468);
    expected[111] = static_cast<value_t>(-0.30733409523963928);
    expected[112] = static_cast<value_t>(0.94131278991699219);
    expected[113] = static_cast<value_t>(-0.61671662330627441);
    expected[114] = static_cast<value_t>(3.71224212646484375);
    expected[115] = static_cast<value_t>(-0.26240575313568115);
    expected[116] = static_cast<value_t>(-3.14521217346191406);
    expected[117] = static_cast<value_t>(1.79737210273742676);
    expected[118] = static_cast<value_t>(-0.31296807527542114);
    expected[119] = static_cast<value_t>(0.24046854674816132);
    expected[120] = static_cast<value_t>(0.80205184221267700);
    expected[121] = static_cast<value_t>(0.53415131568908691);
    expected[122] = static_cast<value_t>(3.27960228919982910);
    expected[123] = static_cast<value_t>(-2.86946296691894531);
    expected[124] = static_cast<value_t>(-3.44533920288085938);
    expected[125] = static_cast<value_t>(1.92930090427398682);
    expected[126] = static_cast<value_t>(-0.20221364498138428);
    expected[127] = static_cast<value_t>(0.65244501829147339);
    expected[128] = static_cast<value_t>(-4.33055305480957031);
    expected[129] = static_cast<value_t>(3.96793746948242188);
    expected[130] = static_cast<value_t>(-1.59352231025695801);
    expected[131] = static_cast<value_t>(-1.79790329933166504);
    expected[132] = static_cast<value_t>(-1.22148156166076660);
    expected[133] = static_cast<value_t>(-0.04343604668974876);
    expected[134] = static_cast<value_t>(-0.14487531781196594);
    expected[135] = static_cast<value_t>(-1.06198263168334961);
    expected[136] = static_cast<value_t>(-3.81269264221191406);
    expected[137] = static_cast<value_t>(1.57540321350097656);
    expected[138] = static_cast<value_t>(-1.86649489402770996);
    expected[139] = static_cast<value_t>(1.04518890380859375);
    expected[140] = static_cast<value_t>(0.00638182973489165);
    expected[141] = static_cast<value_t>(-0.10728693008422852);
    expected[142] = static_cast<value_t>(0.12723162770271301);
    expected[143] = static_cast<value_t>(-2.82347655296325684);
    expected[144] = static_cast<value_t>(-0.98939412832260132);
    expected[145] = static_cast<value_t>(-1.38222646713256836);
    expected[146] = static_cast<value_t>(-0.52460616827011108);

    std::vector<value_t> host(expected.size());
    g_sycl_queue.memcpy(host.data(), result.m_p_data. get(),
                        host.size() * sizeof(value_t)).wait();

    // Compare results
    for (size_t i = 0; i < host.size(); ++i)
    {
        if constexpr (std::is_floating_point<value_t>::value)
        {
            EXPECT_NEAR(static_cast<double>(host[i]),
                        static_cast<double>(expected[i]), 0.0001);
        }
        else
        {
            EXPECT_EQ(host[i], expected[i]);
        }
    }
}

/**
 * @test TypedConv2DTranspose. multi_both_channels
 * @brief Conv2d transpose test: 
 *   input:  (2, 4, 4), kernel: (2, 3, 3, 3)
 *   stride: 2, padding: (1, 1), output_padding: (0, 0)
 */
TYPED_TEST(TypedConv2DTranspose, multi_both_channels)
{
    using value_t = TypeParam;

    Tensor<value_t> input(
        {2, 4, 4},
        MemoryLocation::DEVICE
    );

    std::vector<value_t> input_vals(32);
    input_vals[0] = static_cast<value_t>(0.07147466391324997);
    input_vals[1] = static_cast<value_t>(0.53980702161788940);
    input_vals[2] = static_cast<value_t>(-0.11952499300241470);
    input_vals[3] = static_cast<value_t>(0.71190649271011353);
    input_vals[4] = static_cast<value_t>(0.80817037820816040);
    input_vals[5] = static_cast<value_t>(-1.36193323135375977);
    input_vals[6] = static_cast<value_t>(-0.37573054432868958);
    input_vals[7] = static_cast<value_t>(0.74506783485412598);
    input_vals[8] = static_cast<value_t>(1.66574180126190186);
    input_vals[9] = static_cast<value_t>(-0.94733959436416626);
    input_vals[10] = static_cast<value_t>(0.08626860380172729);
    input_vals[11] = static_cast<value_t>(-0.19642768800258636);
    input_vals[12] = static_cast<value_t>(-0.66876208782196045);
    input_vals[13] = static_cast<value_t>(-0.38013616204261780);
    input_vals[14] = static_cast<value_t>(0.30069038271903992);
    input_vals[15] = static_cast<value_t>(-0.69633996486663818);
    input_vals[16] = static_cast<value_t>(-0.02553789317607880);
    input_vals[17] = static_cast<value_t>(1.31538832187652588);
    input_vals[18] = static_cast<value_t>(0.48948118090629578);
    input_vals[19] = static_cast<value_t>(0.32173913717269897);
    input_vals[20] = static_cast<value_t>(-0.48444023728370667);
    input_vals[21] = static_cast<value_t>(0.81149232387542725);
    input_vals[22] = static_cast<value_t>(0.70890897512435913);
    input_vals[23] = static_cast<value_t>(-0.72934478521347046);
    input_vals[24] = static_cast<value_t>(-0.66120719909667969);
    input_vals[25] = static_cast<value_t>(0.25421637296676636);
    input_vals[26] = static_cast<value_t>(-0.40910542011260986);
    input_vals[27] = static_cast<value_t>(-1.07555615901947021);
    input_vals[28] = static_cast<value_t>(1.97098779678344727);
    input_vals[29] = static_cast<value_t>(-0.99787104129791260);
    input_vals[30] = static_cast<value_t>(-0.39865192770957947);
    input_vals[31] = static_cast<value_t>(-1.12203657627105713);
    input = input_vals;

    Tensor<value_t> kernel(
        {2, 3, 3, 3},
        MemoryLocation::DEVICE
    );

    std::vector<value_t> kernel_vals(54);
    kernel_vals[0] = static_cast<value_t>(-1.31760251522064209);
    kernel_vals[1] = static_cast<value_t>(0.85556131601333618);
    kernel_vals[2] = static_cast<value_t>(0.11852259933948517);
    kernel_vals[3] = static_cast<value_t>(-0.05652661249041557);
    kernel_vals[4] = static_cast<value_t>(-0.63154923915863037);
    kernel_vals[5] = static_cast<value_t>(0.02719719707965851);
    kernel_vals[6] = static_cast<value_t>(0.12451159954071045);
    kernel_vals[7] = static_cast<value_t>(0.48852059245109558);
    kernel_vals[8] = static_cast<value_t>(-0.57806348800659180);
    kernel_vals[9] = static_cast<value_t>(-0.97575771808624268);
    kernel_vals[10] = static_cast<value_t>(-0.07386439293622971);
    kernel_vals[11] = static_cast<value_t>(0.81515353918075562);
    kernel_vals[12] = static_cast<value_t>(-1.65785074234008789);
    kernel_vals[13] = static_cast<value_t>(0.15678869187831879);
    kernel_vals[14] = static_cast<value_t>(-0.36779564619064331);
    kernel_vals[15] = static_cast<value_t>(0.45322275161743164);
    kernel_vals[16] = static_cast<value_t>(-0.28639113903045654);
    kernel_vals[17] = static_cast<value_t>(-0.36807587742805481);
    kernel_vals[18] = static_cast<value_t>(0.23805651068687439);
    kernel_vals[19] = static_cast<value_t>(0.31645011901855469);
    kernel_vals[20] = static_cast<value_t>(0.00655058678239584);
    kernel_vals[21] = static_cast<value_t>(-0.33853387832641602);
    kernel_vals[22] = static_cast<value_t>(0.68670010566711426);
    kernel_vals[23] = static_cast<value_t>(-0.07192981988191605);
    kernel_vals[24] = static_cast<value_t>(-1.10835790634155273);
    kernel_vals[25] = static_cast<value_t>(-2.43781280517578125);
    kernel_vals[26] = static_cast<value_t>(-0.15589141845703125);
    kernel_vals[27] = static_cast<value_t>(1.87073361873626709);
    kernel_vals[28] = static_cast<value_t>(0.95312196016311646);
    kernel_vals[29] = static_cast<value_t>(-0.93886584043502808);
    kernel_vals[30] = static_cast<value_t>(1.01195025444030762);
    kernel_vals[31] = static_cast<value_t>(-1.03674101829528809);
    kernel_vals[32] = static_cast<value_t>(-0.10381773859262466);
    kernel_vals[33] = static_cast<value_t>(-1.02686762809753418);
    kernel_vals[34] = static_cast<value_t>(0.08059885352849960);
    kernel_vals[35] = static_cast<value_t>(1.21983134746551514);
    kernel_vals[36] = static_cast<value_t>(0.73985034227371216);
    kernel_vals[37] = static_cast<value_t>(0.63703936338424683);
    kernel_vals[38] = static_cast<value_t>(0.17882452905178070);
    kernel_vals[39] = static_cast<value_t>(-0.21259368956089020);
    kernel_vals[40] = static_cast<value_t>(0.46885877847671509);
    kernel_vals[41] = static_cast<value_t>(-0.40943080186843872);
    kernel_vals[42] = static_cast<value_t>(-0.64921951293945312);
    kernel_vals[43] = static_cast<value_t>(-0.16570571064949036);
    kernel_vals[44] = static_cast<value_t>(0.65872663259506226);
    kernel_vals[45] = static_cast<value_t>(1.05848932266235352);
    kernel_vals[46] = static_cast<value_t>(0.08128810673952103);
    kernel_vals[47] = static_cast<value_t>(0.27988508343696594);
    kernel_vals[48] = static_cast<value_t>(0.20715615153312683);
    kernel_vals[49] = static_cast<value_t>(0.14053204655647278);
    kernel_vals[50] = static_cast<value_t>(-0.76194536685943604);
    kernel_vals[51] = static_cast<value_t>(-2.11290144920349121);
    kernel_vals[52] = static_cast<value_t>(-1.10308301448822021);
    kernel_vals[53] = static_cast<value_t>(-0.41330289840698242);
    kernel = kernel_vals;

    // Run conv2d_transpose
    Tensor<value_t> result = nn:: conv2d_transpose<value_t>(
        input, kernel, 2, {1, 1}, {0, 0}
    );

    std::vector<value_t> expected(147);
    expected[0] = static_cast<value_t>(-0.01866358891129494);
    expected[1] = static_cast<value_t>(1.30518925189971924);
    expected[2] = static_cast<value_t>(-1.70463180541992188);
    expected[3] = static_cast<value_t>(0.38020753860473633);
    expected[4] = static_cast<value_t>(-0.43197929859161377);
    expected[5] = static_cast<value_t>(0.23127475380897522);
    expected[6] = static_cast<value_t>(-0.78316414356231689);
    expected[7] = static_cast<value_t>(0.26256722211837769);
    expected[8] = static_cast<value_t>(2.50719738006591797);
    expected[9] = static_cast<value_t>(-0.02204063534736633);
    expected[10] = static_cast<value_t>(1.67293572425842285);
    expected[11] = static_cast<value_t>(0.33527737855911255);
    expected[12] = static_cast<value_t>(-2.63178157806396484);
    expected[13] = static_cast<value_t>(0.31600946187973022);
    expected[14] = static_cast<value_t>(-0.00816033594310284);
    expected[15] = static_cast<value_t>(0.97044879198074341);
    expected[16] = static_cast<value_t>(0.01882048882544041);
    expected[17] = static_cast<value_t>(0.61733132600784302);
    expected[18] = static_cast<value_t>(-0.49766266345977783);
    expected[19] = static_cast<value_t>(-0.86399292945861816);
    expected[20] = static_cast<value_t>(0.28559464216232300);
    expected[21] = static_cast<value_t>(1.15069556236267090);
    expected[22] = static_cast<value_t>(0.48102021217346191);
    expected[23] = static_cast<value_t>(-1.16813492774963379);
    expected[24] = static_cast<value_t>(-0.22752201557159424);
    expected[25] = static_cast<value_t>(-0.44253414869308472);
    expected[26] = static_cast<value_t>(0.56471008062362671);
    expected[27] = static_cast<value_t>(-0.88799548149108887);
    expected[28] = static_cast<value_t>(-0.36649739742279053);
    expected[29] = static_cast<value_t>(0.42475277185440063);
    expected[30] = static_cast<value_t>(0.33473503589630127);
    expected[31] = static_cast<value_t>(-0.47102797031402588);
    expected[32] = static_cast<value_t>(0.36965349316596985);
    expected[33] = static_cast<value_t>(-1.03248727321624756);
    expected[34] = static_cast<value_t>(1.23912692070007324);
    expected[35] = static_cast<value_t>(2.06688141822814941);
    expected[36] = static_cast<value_t>(-5.44410610198974609);
    expected[37] = static_cast<value_t>(-1.71862792968750000);
    expected[38] = static_cast<value_t>(1.03841245174407959);
    expected[39] = static_cast<value_t>(-0.11353427171707153);
    expected[40] = static_cast<value_t>(-0.24052512645721436);
    expected[41] = static_cast<value_t>(-1.84784686565399170);
    expected[42] = static_cast<value_t>(-1.62104773521423340);
    expected[43] = static_cast<value_t>(-1.21112000942230225);
    expected[44] = static_cast<value_t>(1.27460849285125732);
    expected[45] = static_cast<value_t>(-0.32715484499931335);
    expected[46] = static_cast<value_t>(0.22339801490306854);
    expected[47] = static_cast<value_t>(-1.04651832580566406);
    expected[48] = static_cast<value_t>(1.60303425788879395);
    expected[49] = static_cast<value_t>(-0.00076724617974833);
    expected[50] = static_cast<value_t>(-1.19039475917816162);
    expected[51] = static_cast<value_t>(0.70136702060699463);
    expected[52] = static_cast<value_t>(-0.64300519227981567);
    expected[53] = static_cast<value_t>(0.21075737476348877);
    expected[54] = static_cast<value_t>(-1.40508222579956055);
    expected[55] = static_cast<value_t>(0.26246911287307739);
    expected[56] = static_cast<value_t>(-0.38454046845436096);
    expected[57] = static_cast<value_t>(1.84899926185607910);
    expected[58] = static_cast<value_t>(0.24498760700225830);
    expected[59] = static_cast<value_t>(0.22187775373458862);
    expected[60] = static_cast<value_t>(0.43247708678245544);
    expected[61] = static_cast<value_t>(-0.96591800451278687);
    expected[62] = static_cast<value_t>(-0.77685308456420898);
    expected[63] = static_cast<value_t>(-0.10042207688093185);
    expected[64] = static_cast<value_t>(1.98646712303161621);
    expected[65] = static_cast<value_t>(0.16693957149982452);
    expected[66] = static_cast<value_t>(0.64085870981216431);
    expected[67] = static_cast<value_t>(0.27346789836883545);
    expected[68] = static_cast<value_t>(-1.23221421241760254);
    expected[69] = static_cast<value_t>(-0.22514149546623230);
    expected[70] = static_cast<value_t>(-0.69543230533599854);
    expected[71] = static_cast<value_t>(0.59137380123138428);
    expected[72] = static_cast<value_t>(0.48749721050262451);
    expected[73] = static_cast<value_t>(-0.70830214023590088);
    expected[74] = static_cast<value_t>(-0.27685278654098511);
    expected[75] = static_cast<value_t>(0.80954039096832275);
    expected[76] = static_cast<value_t>(-0.76318681240081787);
    expected[77] = static_cast<value_t>(-0.04884333536028862);
    expected[78] = static_cast<value_t>(1.17456889152526855);
    expected[79] = static_cast<value_t>(-0.02934055961668491);
    expected[80] = static_cast<value_t>(0.18829613924026489);
    expected[81] = static_cast<value_t>(-0.17828673124313354);
    expected[82] = static_cast<value_t>(0.69007539749145508);
    expected[83] = static_cast<value_t>(-0.53508156538009644);
    expected[84] = static_cast<value_t>(0.93750655651092529);
    expected[85] = static_cast<value_t>(-2.20310950279235840);
    expected[86] = static_cast<value_t>(-0.37842005491256714);
    expected[87] = static_cast<value_t>(-0.25580686330795288);
    expected[88] = static_cast<value_t>(-0.23308272659778595);
    expected[89] = static_cast<value_t>(0.33114454150199890);
    expected[90] = static_cast<value_t>(-0.42886576056480408);
    expected[91] = static_cast<value_t>(0.81926059722900391);
    expected[92] = static_cast<value_t>(0.28133481740951538);
    expected[93] = static_cast<value_t>(-0.52746164798736572);
    expected[94] = static_cast<value_t>(0.13462266325950623);
    expected[95] = static_cast<value_t>(-0.13976660370826721);
    expected[96] = static_cast<value_t>(1.44559347629547119);
    expected[97] = static_cast<value_t>(-0.63525491952896118);
    expected[98] = static_cast<value_t>(0.04549276828765869);
    expected[99] = static_cast<value_t>(0.10406513512134552);
    expected[100] = static_cast<value_t>(0.55553978681564331);
    expected[101] = static_cast<value_t>(-0.89921998977661133);
    expected[102] = static_cast<value_t>(-0.01329003181308508);
    expected[103] = static_cast<value_t>(-0.53871476650238037);
    expected[104] = static_cast<value_t>(0.53408092260360718);
    expected[105] = static_cast<value_t>(0.07029496133327484);
    expected[106] = static_cast<value_t>(-2.97372722625732422);
    expected[107] = static_cast<value_t>(-3.13195037841796875);
    expected[108] = static_cast<value_t>(-0.65042352676391602);
    expected[109] = static_cast<value_t>(-0.30983293056488037);
    expected[110] = static_cast<value_t>(-2.05120491981506348);
    expected[111] = static_cast<value_t>(-1.91391003131866455);
    expected[112] = static_cast<value_t>(0.48689129948616028);
    expected[113] = static_cast<value_t>(0.94015157222747803);
    expected[114] = static_cast<value_t>(-0.82119899988174438);
    expected[115] = static_cast<value_t>(-0.24629682302474976);
    expected[116] = static_cast<value_t>(-0.15838977694511414);
    expected[117] = static_cast<value_t>(-0.91644263267517090);
    expected[118] = static_cast<value_t>(0.40914183855056763);
    expected[119] = static_cast<value_t>(-0.96241438388824463);
    expected[120] = static_cast<value_t>(-0.26144564151763916);
    expected[121] = static_cast<value_t>(2.14587378501892090);
    expected[122] = static_cast<value_t>(-1.55204045772552490);
    expected[123] = static_cast<value_t>(0.12801958620548248);
    expected[124] = static_cast<value_t>(-0.81835216283798218);
    expected[125] = static_cast<value_t>(-1.16139757633209229);
    expected[126] = static_cast<value_t>(1.05094432830810547);
    expected[127] = static_cast<value_t>(0.75735628604888916);
    expected[128] = static_cast<value_t>(-0.61481267213821411);
    expected[129] = static_cast<value_t>(-0.23951056599617004);
    expected[130] = static_cast<value_t>(0.00174823589622974);
    expected[131] = static_cast<value_t>(0.14920005202293396);
    expected[132] = static_cast<value_t>(-0.28603702783584595);
    expected[133] = static_cast<value_t>(-3.38281202316284180);
    expected[134] = static_cast<value_t>(-0.07299921661615372);
    expected[135] = static_cast<value_t>(1.82760560512542725);
    expected[136] = static_cast<value_t>(0.17922985553741455);
    expected[137] = static_cast<value_t>(0.30371838808059692);
    expected[138] = static_cast<value_t>(1.18285322189331055);
    expected[139] = static_cast<value_t>(1.35371661186218262);
    expected[140] = static_cast<value_t>(-0.18225206434726715);
    expected[141] = static_cast<value_t>(-1.53170728683471680);
    expected[142] = static_cast<value_t>(-0.40127241611480713);
    expected[143] = static_cast<value_t>(0.60328924655914307);
    expected[144] = static_cast<value_t>(0.15046074986457825);
    expected[145] = static_cast<value_t>(0.28542026877403259);
    expected[146] = static_cast<value_t>(-0.63585883378982544);

    std::vector<value_t> host(expected.size());
    g_sycl_queue.memcpy(host.data(), result.m_p_data. get(),
                        host.size() * sizeof(value_t)).wait();

    // Compare results
    for (size_t i = 0; i < host.size(); ++i)
    {
        if constexpr (std::is_floating_point<value_t>::value)
        {
            EXPECT_NEAR(static_cast<double>(host[i]),
                        static_cast<double>(expected[i]), 0.0001);
        }
        else
        {
            EXPECT_EQ(host[i], expected[i]);
        }
    }
}

/**
 * @test TypedConv2DTranspose. s1_nopad
 * @brief Conv2d transpose test: 
 *   input:  (1, 5, 5), kernel: (1, 1, 3, 3)
 *   stride: 1, padding: (0, 0), output_padding: (0, 0)
 */
TYPED_TEST(TypedConv2DTranspose, s1_nopad)
{
    using value_t = TypeParam;

    Tensor<value_t> input(
        {1, 5, 5},
        MemoryLocation::DEVICE
    );

    std::vector<value_t> input_vals(25);
    input_vals[0] = static_cast<value_t>(-0.56222391128540039);
    input_vals[1] = static_cast<value_t>(-2.70438194274902344);
    input_vals[2] = static_cast<value_t>(0.10013283044099808);
    input_vals[3] = static_cast<value_t>(-0.55671215057373047);
    input_vals[4] = static_cast<value_t>(0.28223919868469238);
    input_vals[5] = static_cast<value_t>(0.87741988897323608);
    input_vals[6] = static_cast<value_t>(0.50391292572021484);
    input_vals[7] = static_cast<value_t>(-0.98143351078033447);
    input_vals[8] = static_cast<value_t>(-1.63461673259735107);
    input_vals[9] = static_cast<value_t>(-0.32176780700683594);
    input_vals[10] = static_cast<value_t>(-0.05782927945256233);
    input_vals[11] = static_cast<value_t>(0.73000228404998779);
    input_vals[12] = static_cast<value_t>(-1.13279724121093750);
    input_vals[13] = static_cast<value_t>(-0.72181707620620728);
    input_vals[14] = static_cast<value_t>(-0.81492006778717041);
    input_vals[15] = static_cast<value_t>(1.04277384281158447);
    input_vals[16] = static_cast<value_t>(0.61222696304321289);
    input_vals[17] = static_cast<value_t>(1.79957115650177002);
    input_vals[18] = static_cast<value_t>(-0.16601921617984772);
    input_vals[19] = static_cast<value_t>(-1.69786763191223145);
    input_vals[20] = static_cast<value_t>(-0.59599715471267700);
    input_vals[21] = static_cast<value_t>(1.91393291950225830);
    input_vals[22] = static_cast<value_t>(-0.87771451473236084);
    input_vals[23] = static_cast<value_t>(-1.03005564212799072);
    input_vals[24] = static_cast<value_t>(-1.58215641975402832);
    input = input_vals;

    Tensor<value_t> kernel(
        {1, 1, 3, 3},
        MemoryLocation::DEVICE
    );

    std::vector<value_t> kernel_vals(9);
    kernel_vals[0] = static_cast<value_t>(-0.27706298232078552);
    kernel_vals[1] = static_cast<value_t>(0.25572031736373901);
    kernel_vals[2] = static_cast<value_t>(-2.21532201766967773);
    kernel_vals[3] = static_cast<value_t>(-1.00658118724822998);
    kernel_vals[4] = static_cast<value_t>(0.56044560670852661);
    kernel_vals[5] = static_cast<value_t>(-1.50181829929351807);
    kernel_vals[6] = static_cast<value_t>(0.62819927930831909);
    kernel_vals[7] = static_cast<value_t>(2.24023485183715820);
    kernel_vals[8] = static_cast<value_t>(-0.31547090411186218);
    kernel = kernel_vals;

    // Run conv2d_transpose
    Tensor<value_t> result = nn:: conv2d_transpose<value_t>(
        input, kernel, 1, {0, 0}, {0, 0}
    );

    std::vector<value_t> expected(49);
    expected[0] = static_cast<value_t>(0.15577143430709839);
    expected[1] = static_cast<value_t>(0.60551208257675171);
    expected[2] = static_cast<value_t>(0.52619850635528564);
    expected[3] = static_cast<value_t>(6.17092704772949219);
    expected[4] = static_cast<value_t>(-0.44238710403442383);
    expected[5] = static_cast<value_t>(1.30547094345092773);
    expected[6] = static_cast<value_t>(-0.62525069713592529);
    expected[7] = static_cast<value_t>(0.32282340526580811);
    expected[8] = static_cast<value_t>(2.49184250831604004);
    expected[9] = static_cast<value_t>(-2.31508040428161621);
    expected[10] = static_cast<value_t>(3.76357483863830566);
    expected[11] = static_cast<value_t>(1.09885144233703613);
    expected[12] = static_cast<value_t>(4.53318023681640625);
    expected[13] = static_cast<value_t>(0.28894728422164917);
    expected[14] = static_cast<value_t>(-1.22036063671112061);
    expected[15] = static_cast<value_t>(-3.19093227386474609);
    expected[16] = static_cast<value_t>(-5.23695564270019531);
    expected[17] = static_cast<value_t>(-0.64058327674865723);
    expected[18] = static_cast<value_t>(2.33096528053283691);
    expected[19] = static_cast<value_t>(4.47313833236694336);
    expected[20] = static_cast<value_t>(2.19950866699218750);
    expected[21] = static_cast<value_t>(0.32049039006233215);
    expected[22] = static_cast<value_t>(1.61200070381164551);
    expected[23] = static_cast<value_t>(-0.78034061193466187);
    expected[24] = static_cast<value_t>(-5.23920631408691406);
    expected[25] = static_cast<value_t>(-4.99611425399780273);
    expected[26] = static_cast<value_t>(0.35576510429382324);
    expected[27] = static_cast<value_t>(5.08669376373291016);
    expected[28] = static_cast<value_t>(-0.92083603143692017);
    expected[29] = static_cast<value_t>(-0.38549098372459412);
    expected[30] = static_cast<value_t>(-0.03941438347101212);
    expected[31] = static_cast<value_t>(-7.14428853988647461);
    expected[32] = static_cast<value_t>(-0.73886835575103760);
    expected[33] = static_cast<value_t>(-0.42281639575958252);
    expected[34] = static_cast<value_t>(6.31195783615112305);
    expected[35] = static_cast<value_t>(1.25498926639556885);
    expected[36] = static_cast<value_t>(0.46010601520538330);
    expected[37] = static_cast<value_t>(5.02428245544433594);
    expected[38] = static_cast<value_t>(1.40457320213317871);
    expected[39] = static_cast<value_t>(0.32721287012100220);
    expected[40] = static_cast<value_t>(-3.09100437164306641);
    expected[41] = static_cast<value_t>(2.91173934936523438);
    expected[42] = static_cast<value_t>(-0.37440499663352966);
    expected[43] = static_cast<value_t>(-0.13284230232238770);
    expected[44] = static_cast<value_t>(3.92429924011230469);
    expected[45] = static_cast<value_t>(-3.21715688705444336);
    expected[46] = static_cast<value_t>(-3.02458286285400391);
    expected[47] = static_cast<value_t>(-3.21944928169250488);
    expected[48] = static_cast<value_t>(0.49912431836128235);

    std::vector<value_t> host(expected.size());
    g_sycl_queue.memcpy(host.data(), result.m_p_data. get(),
                        host.size() * sizeof(value_t)).wait();

    // Compare results
    for (size_t i = 0; i < host.size(); ++i)
    {
        if constexpr (std::is_floating_point<value_t>::value)
        {
            EXPECT_NEAR(static_cast<double>(host[i]),
                        static_cast<double>(expected[i]), 0.0001);
        }
        else
        {
            EXPECT_EQ(host[i], expected[i]);
        }
    }
}

/**
 * @test TypedConv2DTranspose. s1_pad1
 * @brief Conv2d transpose test: 
 *   input:  (2, 5, 5), kernel: (2, 2, 3, 3)
 *   stride: 1, padding: (1, 1), output_padding: (0, 0)
 */
TYPED_TEST(TypedConv2DTranspose, s1_pad1)
{
    using value_t = TypeParam;

    Tensor<value_t> input(
        {2, 5, 5},
        MemoryLocation::DEVICE
    );

    std::vector<value_t> input_vals(50);
    input_vals[0] = static_cast<value_t>(-2.29438233375549316);
    input_vals[1] = static_cast<value_t>(0.05077365040779114);
    input_vals[2] = static_cast<value_t>(-2.06281733512878418);
    input_vals[3] = static_cast<value_t>(-0.78689765930175781);
    input_vals[4] = static_cast<value_t>(0.63173013925552368);
    input_vals[5] = static_cast<value_t>(2.15747976303100586);
    input_vals[6] = static_cast<value_t>(-0.44497185945510864);
    input_vals[7] = static_cast<value_t>(0.03896220773458481);
    input_vals[8] = static_cast<value_t>(-0.41987541317939758);
    input_vals[9] = static_cast<value_t>(0.08015103638172150);
    input_vals[10] = static_cast<value_t>(-1.23771679401397705);
    input_vals[11] = static_cast<value_t>(0.35469621419906616);
    input_vals[12] = static_cast<value_t>(-1.19456958770751953);
    input_vals[13] = static_cast<value_t>(0.50223302841186523);
    input_vals[14] = static_cast<value_t>(0.98585844039916992);
    input_vals[15] = static_cast<value_t>(-2.23922204971313477);
    input_vals[16] = static_cast<value_t>(0.42290237545967102);
    input_vals[17] = static_cast<value_t>(-0.91527605056762695);
    input_vals[18] = static_cast<value_t>(0.13676632940769196);
    input_vals[19] = static_cast<value_t>(0.56187725067138672);
    input_vals[20] = static_cast<value_t>(0.22611086070537567);
    input_vals[21] = static_cast<value_t>(0.31633111834526062);
    input_vals[22] = static_cast<value_t>(-0.83409118652343750);
    input_vals[23] = static_cast<value_t>(-1.27062499523162842);
    input_vals[24] = static_cast<value_t>(-1.33610439300537109);
    input_vals[25] = static_cast<value_t>(-0.09190045297145844);
    input_vals[26] = static_cast<value_t>(0.17435424029827118);
    input_vals[27] = static_cast<value_t>(-0.78352570533752441);
    input_vals[28] = static_cast<value_t>(-0.64575707912445068);
    input_vals[29] = static_cast<value_t>(1.06882905960083008);
    input_vals[30] = static_cast<value_t>(0.55296397209167480);
    input_vals[31] = static_cast<value_t>(0.82069492340087891);
    input_vals[32] = static_cast<value_t>(0.10773804783821106);
    input_vals[33] = static_cast<value_t>(-1.31737840175628662);
    input_vals[34] = static_cast<value_t>(-0.23274402320384979);
    input_vals[35] = static_cast<value_t>(0.48808217048645020);
    input_vals[36] = static_cast<value_t>(-0.08096331357955933);
    input_vals[37] = static_cast<value_t>(-0.40834826231002808);
    input_vals[38] = static_cast<value_t>(1.30850148200988770);
    input_vals[39] = static_cast<value_t>(0.18012866377830505);
    input_vals[40] = static_cast<value_t>(-0.67264074087142944);
    input_vals[41] = static_cast<value_t>(0.08473898470401764);
    input_vals[42] = static_cast<value_t>(0.11880097538232803);
    input_vals[43] = static_cast<value_t>(-1.69970977306365967);
    input_vals[44] = static_cast<value_t>(0.52551305294036865);
    input_vals[45] = static_cast<value_t>(-1.74241936206817627);
    input_vals[46] = static_cast<value_t>(0.63309663534164429);
    input_vals[47] = static_cast<value_t>(0.05134505778551102);
    input_vals[48] = static_cast<value_t>(3.08052897453308105);
    input_vals[49] = static_cast<value_t>(2.16381597518920898);
    input = input_vals;

    Tensor<value_t> kernel(
        {2, 2, 3, 3},
        MemoryLocation::DEVICE
    );

    std::vector<value_t> kernel_vals(36);
    kernel_vals[0] = static_cast<value_t>(2.09135150909423828);
    kernel_vals[1] = static_cast<value_t>(-0.32884693145751953);
    kernel_vals[2] = static_cast<value_t>(-1.04561901092529297);
    kernel_vals[3] = static_cast<value_t>(1.10223305225372314);
    kernel_vals[4] = static_cast<value_t>(0.57505422830581665);
    kernel_vals[5] = static_cast<value_t>(0.10142706334590912);
    kernel_vals[6] = static_cast<value_t>(-0.06330941617488861);
    kernel_vals[7] = static_cast<value_t>(-0.30890706181526184);
    kernel_vals[8] = static_cast<value_t>(1.22687506675720215);
    kernel_vals[9] = static_cast<value_t>(0.52436649799346924);
    kernel_vals[10] = static_cast<value_t>(0.50858610868453979);
    kernel_vals[11] = static_cast<value_t>(-1.05819809436798096);
    kernel_vals[12] = static_cast<value_t>(0.69973498582839966);
    kernel_vals[13] = static_cast<value_t>(0.39466741681098938);
    kernel_vals[14] = static_cast<value_t>(0.43680962920188904);
    kernel_vals[15] = static_cast<value_t>(0.24883285164833069);
    kernel_vals[16] = static_cast<value_t>(-0.90232455730438232);
    kernel_vals[17] = static_cast<value_t>(0.80224543809890747);
    kernel_vals[18] = static_cast<value_t>(0.77208316326141357);
    kernel_vals[19] = static_cast<value_t>(-2.22237110137939453);
    kernel_vals[20] = static_cast<value_t>(0.29479160904884338);
    kernel_vals[21] = static_cast<value_t>(0.52359777688980103);
    kernel_vals[22] = static_cast<value_t>(-1.11058986186981201);
    kernel_vals[23] = static_cast<value_t>(-1.22148835659027100);
    kernel_vals[24] = static_cast<value_t>(-1.09589469432830811);
    kernel_vals[25] = static_cast<value_t>(-0.35420000553131104);
    kernel_vals[26] = static_cast<value_t>(1.43493115901947021);
    kernel_vals[27] = static_cast<value_t>(1.26252746582031250);
    kernel_vals[28] = static_cast<value_t>(-0.34849998354911804);
    kernel_vals[29] = static_cast<value_t>(0.52622717618942261);
    kernel_vals[30] = static_cast<value_t>(1.63813233375549316);
    kernel_vals[31] = static_cast<value_t>(0.36315378546714783);
    kernel_vals[32] = static_cast<value_t>(1.09127330780029297);
    kernel_vals[33] = static_cast<value_t>(0.56444901227951050);
    kernel_vals[34] = static_cast<value_t>(-0.39925217628479004);
    kernel_vals[35] = static_cast<value_t>(-0.62377578020095825);
    kernel = kernel_vals;

    // Run conv2d_transpose
    Tensor<value_t> result = nn:: conv2d_transpose<value_t>(
        input, kernel, 1, {1, 1}, {0, 0}
    );

    std::vector<value_t> expected(50);
    expected[0] = static_cast<value_t>(-3.30539417266845703);
    expected[1] = static_cast<value_t>(-6.57464075088500977);
    expected[2] = static_cast<value_t>(-3.16961383819580078);
    expected[3] = static_cast<value_t>(5.31317996978759766);
    expected[4] = static_cast<value_t>(0.42678421735763550);
    expected[5] = static_cast<value_t>(1.11442041397094727);
    expected[6] = static_cast<value_t>(-4.87175941467285156);
    expected[7] = static_cast<value_t>(2.65350222587585449);
    expected[8] = static_cast<value_t>(-3.07778573036193848);
    expected[9] = static_cast<value_t>(-1.45853567123413086);
    expected[10] = static_cast<value_t>(0.54228872060775757);
    expected[11] = static_cast<value_t>(1.20156216621398926);
    expected[12] = static_cast<value_t>(1.78541302680969238);
    expected[13] = static_cast<value_t>(7.74818372726440430);
    expected[14] = static_cast<value_t>(-5.52503204345703125);
    expected[15] = static_cast<value_t>(5.19390201568603516);
    expected[16] = static_cast<value_t>(-4.54478454589843750);
    expected[17] = static_cast<value_t>(-2.35408782958984375);
    expected[18] = static_cast<value_t>(-6.97169017791748047);
    expected[19] = static_cast<value_t>(1.82225036621093750);
    expected[20] = static_cast<value_t>(3.55562019348144531);
    expected[21] = static_cast<value_t>(-3.20774221420288086);
    expected[22] = static_cast<value_t>(1.66966986656188965);
    expected[23] = static_cast<value_t>(-5.64307689666748047);
    expected[24] = static_cast<value_t>(-9.69402599334716797);
    expected[25] = static_cast<value_t>(1.08962941169738770);
    expected[26] = static_cast<value_t>(-6.09400749206542969);
    expected[27] = static_cast<value_t>(-3.49306178092956543);
    expected[28] = static_cast<value_t>(-0.09903287887573242);
    expected[29] = static_cast<value_t>(-0.53800332546234131);
    expected[30] = static_cast<value_t>(3.58754968643188477);
    expected[31] = static_cast<value_t>(-0.34903943538665771);
    expected[32] = static_cast<value_t>(0.88191974163055420);
    expected[33] = static_cast<value_t>(1.32048976421356201);
    expected[34] = static_cast<value_t>(-2.30342364311218262);
    expected[35] = static_cast<value_t>(-2.58635592460632324);
    expected[36] = static_cast<value_t>(1.99919271469116211);
    expected[37] = static_cast<value_t>(-2.83742594718933105);
    expected[38] = static_cast<value_t>(4.09942245483398438);
    expected[39] = static_cast<value_t>(1.67078292369842529);
    expected[40] = static_cast<value_t>(1.95863330364227295);
    expected[41] = static_cast<value_t>(-5.66165733337402344);
    expected[42] = static_cast<value_t>(2.48928928375244141);
    expected[43] = static_cast<value_t>(0.30949205160140991);
    expected[44] = static_cast<value_t>(-1.22527158260345459);
    expected[45] = static_cast<value_t>(3.15703749656677246);
    expected[46] = static_cast<value_t>(-3.90041399002075195);
    expected[47] = static_cast<value_t>(4.81521892547607422);
    expected[48] = static_cast<value_t>(3.10188436508178711);
    expected[49] = static_cast<value_t>(3.51830911636352539);

    std::vector<value_t> host(expected.size());
    g_sycl_queue.memcpy(host.data(), result.m_p_data. get(),
                        host.size() * sizeof(value_t)).wait();

    // Compare results
    for (size_t i = 0; i < host.size(); ++i)
    {
        if constexpr (std::is_floating_point<value_t>::value)
        {
            EXPECT_NEAR(static_cast<double>(host[i]),
                        static_cast<double>(expected[i]), 0.0001);
        }
        else
        {
            EXPECT_EQ(host[i], expected[i]);
        }
    }
}

/**
 * @test TypedConv2DTranspose. nonsquare_kernel_3x2
 * @brief Conv2d transpose test: 
 *   input:  (1, 4, 4), kernel: (1, 1, 3, 2)
 *   stride: 2, padding: (0, 0), output_padding: (0, 0)
 */
TYPED_TEST(TypedConv2DTranspose, nonsquare_kernel_3x2)
{
    using value_t = TypeParam;

    Tensor<value_t> input(
        {1, 4, 4},
        MemoryLocation::DEVICE
    );

    std::vector<value_t> input_vals(16);
    input_vals[0] = static_cast<value_t>(0.10803945362567902);
    input_vals[1] = static_cast<value_t>(-0.13649764657020569);
    input_vals[2] = static_cast<value_t>(-0.01905726827681065);
    input_vals[3] = static_cast<value_t>(0.06614600121974945);
    input_vals[4] = static_cast<value_t>(-0.37487903237342834);
    input_vals[5] = static_cast<value_t>(-0.31716486811637878);
    input_vals[6] = static_cast<value_t>(0.45006111264228821);
    input_vals[7] = static_cast<value_t>(-1.39936399459838867);
    input_vals[8] = static_cast<value_t>(-0.58605742454528809);
    input_vals[9] = static_cast<value_t>(1.09544491767883301);
    input_vals[10] = static_cast<value_t>(-1.49766945838928223);
    input_vals[11] = static_cast<value_t>(0.27445778250694275);
    input_vals[12] = static_cast<value_t>(0.35520300269126892);
    input_vals[13] = static_cast<value_t>(-1.12511193752288818);
    input_vals[14] = static_cast<value_t>(-1.02503633499145508);
    input_vals[15] = static_cast<value_t>(-1.94878780841827393);
    input = input_vals;

    Tensor<value_t> kernel(
        {1, 1, 3, 2},
        MemoryLocation::DEVICE
    );

    std::vector<value_t> kernel_vals(6);
    kernel_vals[0] = static_cast<value_t>(0.51418489217758179);
    kernel_vals[1] = static_cast<value_t>(-0.07303996384143829);
    kernel_vals[2] = static_cast<value_t>(0.73970574140548706);
    kernel_vals[3] = static_cast<value_t>(-0.61501121520996094);
    kernel_vals[4] = static_cast<value_t>(1.16510736942291260);
    kernel_vals[5] = static_cast<value_t>(-1.50205135345458984);
    kernel = kernel_vals;

    // Run conv2d_transpose
    Tensor<value_t> result = nn:: conv2d_transpose<value_t>(
        input, kernel, 2, {0, 0}, {0, 0}
    );

    std::vector<value_t> expected(72);
    expected[0] = static_cast<value_t>(0.05555225536227226);
    expected[1] = static_cast<value_t>(-0.00789119768887758);
    expected[2] = static_cast<value_t>(-0.07018502801656723);
    expected[3] = static_cast<value_t>(0.00996978301554918);
    expected[4] = static_cast<value_t>(-0.00979895982891321);
    expected[5] = static_cast<value_t>(0.00139194214716554);
    expected[6] = static_cast<value_t>(0.03401127457618713);
    expected[7] = static_cast<value_t>(-0.00483130151405931);
    expected[8] = static_cast<value_t>(0.07991740107536316);
    expected[9] = static_cast<value_t>(-0.06644547730684280);
    expected[10] = static_cast<value_t>(-0.10096809267997742);
    expected[11] = static_cast<value_t>(0.08394758403301239);
    expected[12] = static_cast<value_t>(-0.01409677043557167);
    expected[13] = static_cast<value_t>(0.01172043383121490);
    expected[14] = static_cast<value_t>(0.04892857745289803);
    expected[15] = static_cast<value_t>(-0.04068053141236305);
    expected[16] = static_cast<value_t>(-0.06687957048416138);
    expected[17] = static_cast<value_t>(-0.13489966094493866);
    expected[18] = static_cast<value_t>(-0.32211577892303467);
    expected[19] = static_cast<value_t>(0.22819218039512634);
    expected[20] = static_cast<value_t>(0.20921087265014648);
    expected[21] = static_cast<value_t>(-0.00424745120108128);
    expected[22] = static_cast<value_t>(-0.64246463775634766);
    expected[23] = static_cast<value_t>(0.00285480171442032);
    expected[24] = static_cast<value_t>(-0.27730017900466919);
    expected[25] = static_cast<value_t>(0.23055480420589447);
    expected[26] = static_cast<value_t>(-0.23460868000984192);
    expected[27] = static_cast<value_t>(0.19505995512008667);
    expected[28] = static_cast<value_t>(0.33291280269622803);
    expected[29] = static_cast<value_t>(-0.27679264545440674);
    expected[30] = static_cast<value_t>(-1.03511762619018555);
    expected[31] = static_cast<value_t>(0.86062455177307129);
    expected[32] = static_cast<value_t>(-0.73811614513397217);
    expected[33] = static_cast<value_t>(0.60589319467544556);
    expected[34] = static_cast<value_t>(0.19373008608818054);
    expected[35] = static_cast<value_t>(0.39638668298721313);
    expected[36] = static_cast<value_t>(-0.24570947885513306);
    expected[37] = static_cast<value_t>(-0.56662517786026001);
    expected[38] = static_cast<value_t>(-1.48928737640380859);
    expected[39] = static_cast<value_t>(2.08187007904052734);
    expected[40] = static_cast<value_t>(-0.43351003527641296);
    expected[41] = static_cast<value_t>(0.36043187975883484);
    expected[42] = static_cast<value_t>(0.81030690670013428);
    expected[43] = static_cast<value_t>(-0.67371088266372681);
    expected[44] = static_cast<value_t>(-1.10783469676971436);
    expected[45] = static_cast<value_t>(0.92108350992202759);
    expected[46] = static_cast<value_t>(0.20301799476146698);
    expected[47] = static_cast<value_t>(-0.16879461705684662);
    expected[48] = static_cast<value_t>(-0.50017982721328735);
    expected[49] = static_cast<value_t>(0.85434436798095703);
    expected[50] = static_cast<value_t>(0.69779533147811890);
    expected[51] = static_cast<value_t>(-1.56323635578155518);
    expected[52] = static_cast<value_t>(-2.27200388908386230);
    expected[53] = static_cast<value_t>(2.32444500923156738);
    expected[54] = static_cast<value_t>(-0.68226450681686401);
    expected[55] = static_cast<value_t>(-0.26991027593612671);
    expected[56] = static_cast<value_t>(0.26274570822715759);
    expected[57] = static_cast<value_t>(-0.21845382452011108);
    expected[58] = static_cast<value_t>(-0.83225178718566895);
    expected[59] = static_cast<value_t>(0.69195646047592163);
    expected[60] = static_cast<value_t>(-0.75822526216506958);
    expected[61] = static_cast<value_t>(0.63040882349014282);
    expected[62] = static_cast<value_t>(-1.44152951240539551);
    expected[63] = static_cast<value_t>(1.19852638244628906);
    expected[64] = static_cast<value_t>(0.41384962201118469);
    expected[65] = static_cast<value_t>(-0.53353315591812134);
    expected[66] = static_cast<value_t>(-1.31087625026702881);
    expected[67] = static_cast<value_t>(1.68997585773468018);
    expected[68] = static_cast<value_t>(-1.19427740573883057);
    expected[69] = static_cast<value_t>(1.53965723514556885);
    expected[70] = static_cast<value_t>(-2.27054715156555176);
    expected[71] = static_cast<value_t>(2.92717933654785156);

    std::vector<value_t> host(expected.size());
    g_sycl_queue.memcpy(host.data(), result.m_p_data. get(),
                        host.size() * sizeof(value_t)).wait();

    // Compare results
    for (size_t i = 0; i < host.size(); ++i)
    {
        if constexpr (std::is_floating_point<value_t>::value)
        {
            EXPECT_NEAR(static_cast<double>(host[i]),
                        static_cast<double>(expected[i]), 0.0001);
        }
        else
        {
            EXPECT_EQ(host[i], expected[i]);
        }
    }
}

/**
 * @test TypedConv2DTranspose. nonsquare_kernel_2x3
 * @brief Conv2d transpose test: 
 *   input:  (2, 3, 5), kernel: (2, 2, 2, 3)
 *   stride: 2, padding: (1, 0), output_padding: (0, 0)
 */
TYPED_TEST(TypedConv2DTranspose, nonsquare_kernel_2x3)
{
    using value_t = TypeParam;

    Tensor<value_t> input(
        {2, 3, 5},
        MemoryLocation::DEVICE
    );

    std::vector<value_t> input_vals(30);
    input_vals[0] = static_cast<value_t>(-0.44787266850471497);
    input_vals[1] = static_cast<value_t>(0.94974285364151001);
    input_vals[2] = static_cast<value_t>(0.45374006032943726);
    input_vals[3] = static_cast<value_t>(1.14066088199615479);
    input_vals[4] = static_cast<value_t>(1.32059144973754883);
    input_vals[5] = static_cast<value_t>(-0.95453834533691406);
    input_vals[6] = static_cast<value_t>(-0.52277946472167969);
    input_vals[7] = static_cast<value_t>(-0.26403141021728516);
    input_vals[8] = static_cast<value_t>(-0.40687358379364014);
    input_vals[9] = static_cast<value_t>(1.00633823871612549);
    input_vals[10] = static_cast<value_t>(0.75254309177398682);
    input_vals[11] = static_cast<value_t>(-0.13130266964435577);
    input_vals[12] = static_cast<value_t>(0.25348603725433350);
    input_vals[13] = static_cast<value_t>(-0.73447406291961670);
    input_vals[14] = static_cast<value_t>(1.32540190219879150);
    input_vals[15] = static_cast<value_t>(-0.73783737421035767);
    input_vals[16] = static_cast<value_t>(0.99480855464935303);
    input_vals[17] = static_cast<value_t>(-0.62566912174224854);
    input_vals[18] = static_cast<value_t>(-0.74289476871490479);
    input_vals[19] = static_cast<value_t>(0.92474091053009033);
    input_vals[20] = static_cast<value_t>(0.18022911250591278);
    input_vals[21] = static_cast<value_t>(-0.24891877174377441);
    input_vals[22] = static_cast<value_t>(0.42301511764526367);
    input_vals[23] = static_cast<value_t>(-0.34723365306854248);
    input_vals[24] = static_cast<value_t>(-1.01929831504821777);
    input_vals[25] = static_cast<value_t>(1.74891912937164307);
    input_vals[26] = static_cast<value_t>(0.24589841067790985);
    input_vals[27] = static_cast<value_t>(-1.80997025966644287);
    input_vals[28] = static_cast<value_t>(-1.00150179862976074);
    input_vals[29] = static_cast<value_t>(-0.21144096553325653);
    input = input_vals;

    Tensor<value_t> kernel(
        {2, 2, 2, 3},
        MemoryLocation::DEVICE
    );

    std::vector<value_t> kernel_vals(24);
    kernel_vals[0] = static_cast<value_t>(0.85305643081665039);
    kernel_vals[1] = static_cast<value_t>(0.34527170658111572);
    kernel_vals[2] = static_cast<value_t>(1.65607607364654541);
    kernel_vals[3] = static_cast<value_t>(1.85076975822448730);
    kernel_vals[4] = static_cast<value_t>(-0.64427906274795532);
    kernel_vals[5] = static_cast<value_t>(1.50184416770935059);
    kernel_vals[6] = static_cast<value_t>(0.55274522304534912);
    kernel_vals[7] = static_cast<value_t>(1.12573111057281494);
    kernel_vals[8] = static_cast<value_t>(0.88759279251098633);
    kernel_vals[9] = static_cast<value_t>(0.03182828426361084);
    kernel_vals[10] = static_cast<value_t>(-0.12257772684097290);
    kernel_vals[11] = static_cast<value_t>(1.16659688949584961);
    kernel_vals[12] = static_cast<value_t>(-0.21707665920257568);
    kernel_vals[13] = static_cast<value_t>(0.26966542005538940);
    kernel_vals[14] = static_cast<value_t>(0.31419146060943604);
    kernel_vals[15] = static_cast<value_t>(0.71458357572555542);
    kernel_vals[16] = static_cast<value_t>(0.16989099979400635);
    kernel_vals[17] = static_cast<value_t>(-1.30276751518249512);
    kernel_vals[18] = static_cast<value_t>(-0.78931629657745361);
    kernel_vals[19] = static_cast<value_t>(1.19822931289672852);
    kernel_vals[20] = static_cast<value_t>(-1.06421005725860596);
    kernel_vals[21] = static_cast<value_t>(0.65694534778594971);
    kernel_vals[22] = static_cast<value_t>(-2.23080706596374512);
    kernel_vals[23] = static_cast<value_t>(1.55551433563232422);
    kernel = kernel_vals;

    // Run conv2d_transpose
    Tensor<value_t> result = nn:: conv2d_transpose<value_t>(
        input, kernel, 2, {1, 0}, {0, 0}
    );

    std::vector<value_t> expected(88);
    expected[0] = static_cast<value_t>(-1.35615563392639160);
    expected[1] = static_cast<value_t>(0.16320306062698364);
    expected[2] = static_cast<value_t>(2.75722503662109375);
    expected[3] = static_cast<value_t>(-0.44289040565490723);
    expected[4] = static_cast<value_t>(0.52303695678710938);
    expected[5] = static_cast<value_t>(-0.39863076806068420);
    expected[6] = static_cast<value_t>(3.07678842544555664);
    expected[7] = static_cast<value_t>(-0.86111503839492798);
    expected[8] = static_cast<value_t>(5.78582954406738281);
    expected[9] = static_cast<value_t>(-0.69372427463531494);
    expected[10] = static_cast<value_t>(0.77860021591186523);
    expected[11] = static_cast<value_t>(-0.85339862108230591);
    expected[12] = static_cast<value_t>(-0.28097352385520935);
    expected[13] = static_cast<value_t>(-1.91608762741088867);
    expected[14] = static_cast<value_t>(-0.24762573838233948);
    expected[15] = static_cast<value_t>(-1.26103115081787109);
    expected[16] = static_cast<value_t>(0.02290997281670570);
    expected[17] = static_cast<value_t>(-0.57605814933776855);
    expected[18] = static_cast<value_t>(-0.23411884903907776);
    expected[19] = static_cast<value_t>(0.29681777954101562);
    expected[20] = static_cast<value_t>(0.07259061187505722);
    expected[21] = static_cast<value_t>(1.34631788730621338);
    expected[22] = static_cast<value_t>(-1.63784193992614746);
    expected[23] = static_cast<value_t>(0.64560836553573608);
    expected[24] = static_cast<value_t>(-2.81378221511840820);
    expected[25] = static_cast<value_t>(0.29452681541442871);
    expected[26] = static_cast<value_t>(-0.64723169803619385);
    expected[27] = static_cast<value_t>(0.24197638034820557);
    expected[28] = static_cast<value_t>(-1.94878125190734863);
    expected[29] = static_cast<value_t>(0.20314824581146240);
    expected[30] = static_cast<value_t>(0.97543054819107056);
    expected[31] = static_cast<value_t>(-0.82153224945068359);
    expected[32] = static_cast<value_t>(2.83927202224731445);
    expected[33] = static_cast<value_t>(0.26231223344802856);
    expected[34] = static_cast<value_t>(0.73145484924316406);
    expected[35] = static_cast<value_t>(1.63037669658660889);
    expected[36] = static_cast<value_t>(0.02097520232200623);
    expected[37] = static_cast<value_t>(0.46895211935043335);
    expected[38] = static_cast<value_t>(-0.40056484937667847);
    expected[39] = static_cast<value_t>(-0.55803018808364868);
    expected[40] = static_cast<value_t>(-0.52366352081298828);
    expected[41] = static_cast<value_t>(-0.35446667671203613);
    expected[42] = static_cast<value_t>(0.40060546994209290);
    expected[43] = static_cast<value_t>(2.12853336334228516);
    expected[44] = static_cast<value_t>(-0.49897384643554688);
    expected[45] = static_cast<value_t>(1.70087206363677979);
    expected[46] = static_cast<value_t>(-0.98643988370895386);
    expected[47] = static_cast<value_t>(-2.33564329147338867);
    expected[48] = static_cast<value_t>(2.25881743431091309);
    expected[49] = static_cast<value_t>(1.34012866020202637);
    expected[50] = static_cast<value_t>(-0.89564150571823120);
    expected[51] = static_cast<value_t>(1.51743531227111816);
    expected[52] = static_cast<value_t>(0.82464438676834106);
    expected[53] = static_cast<value_t>(-2.22479367256164551);
    expected[54] = static_cast<value_t>(2.97904562950134277);
    expected[55] = static_cast<value_t>(-0.66987425088882446);
    expected[56] = static_cast<value_t>(-0.85859769582748413);
    expected[57] = static_cast<value_t>(-1.13153111934661865);
    expected[58] = static_cast<value_t>(-0.88677084445953369);
    expected[59] = static_cast<value_t>(-0.67894822359085083);
    expected[60] = static_cast<value_t>(0.20964074134826660);
    expected[61] = static_cast<value_t>(-0.63534957170486450);
    expected[62] = static_cast<value_t>(-0.87409579753875732);
    expected[63] = static_cast<value_t>(1.36918890476226807);
    expected[64] = static_cast<value_t>(-0.08848685771226883);
    expected[65] = static_cast<value_t>(1.97796607017517090);
    expected[66] = static_cast<value_t>(0.08801935613155365);
    expected[67] = static_cast<value_t>(-0.28505122661590576);
    expected[68] = static_cast<value_t>(-1.01337778568267822);
    expected[69] = static_cast<value_t>(0.61937087774276733);
    expected[70] = static_cast<value_t>(-0.72757542133331299);
    expected[71] = static_cast<value_t>(-0.91130071878433228);
    expected[72] = static_cast<value_t>(0.10892423987388611);
    expected[73] = static_cast<value_t>(0.82448494434356689);
    expected[74] = static_cast<value_t>(-1.65237760543823242);
    expected[75] = static_cast<value_t>(2.15050315856933594);
    expected[76] = static_cast<value_t>(-0.41154205799102783);
    expected[77] = static_cast<value_t>(-0.96448576450347900);
    expected[78] = static_cast<value_t>(2.94276738166809082);
    expected[79] = static_cast<value_t>(-1.45993411540985107);
    expected[80] = static_cast<value_t>(0.14683118462562561);
    expected[81] = static_cast<value_t>(1.19052124023437500);
    expected[82] = static_cast<value_t>(-1.88340234756469727);
    expected[83] = static_cast<value_t>(2.53570556640625000);
    expected[84] = static_cast<value_t>(-2.02684903144836426);
    expected[85] = static_cast<value_t>(1.31339776515960693);
    expected[86] = static_cast<value_t>(1.23869132995605469);
    expected[87] = static_cast<value_t>(1.40143477916717529);

    std::vector<value_t> host(expected.size());
    g_sycl_queue.memcpy(host.data(), result.m_p_data. get(),
                        host.size() * sizeof(value_t)).wait();

    // Compare results
    for (size_t i = 0; i < host.size(); ++i)
    {
        if constexpr (std::is_floating_point<value_t>::value)
        {
            EXPECT_NEAR(static_cast<double>(host[i]),
                        static_cast<double>(expected[i]), 0.0001);
        }
        else
        {
            EXPECT_EQ(host[i], expected[i]);
        }
    }
}

/**
 * @test TypedConv2DTranspose. asym_padding
 * @brief Conv2d transpose test: 
 *   input:  (1, 3, 3), kernel: (1, 1, 3, 3)
 *   stride: 2, padding: (1, 2), output_padding: (0, 0)
 */
TYPED_TEST(TypedConv2DTranspose, asym_padding)
{
    using value_t = TypeParam;

    Tensor<value_t> input(
        {1, 3, 3},
        MemoryLocation::DEVICE
    );

    std::vector<value_t> input_vals(9);
    input_vals[0] = static_cast<value_t>(-0.29882666468620300);
    input_vals[1] = static_cast<value_t>(-0.60640197992324829);
    input_vals[2] = static_cast<value_t>(0.02334302105009556);
    input_vals[3] = static_cast<value_t>(1.50823593139648438);
    input_vals[4] = static_cast<value_t>(1.46195578575134277);
    input_vals[5] = static_cast<value_t>(-0.59917443990707397);
    input_vals[6] = static_cast<value_t>(1.02521741390228271);
    input_vals[7] = static_cast<value_t>(0.16583847999572754);
    input_vals[8] = static_cast<value_t>(-0.77786654233932495);
    input = input_vals;

    Tensor<value_t> kernel(
        {1, 1, 3, 3},
        MemoryLocation::DEVICE
    );

    std::vector<value_t> kernel_vals(9);
    kernel_vals[0] = static_cast<value_t>(-0.63878178596496582);
    kernel_vals[1] = static_cast<value_t>(0.43592724204063416);
    kernel_vals[2] = static_cast<value_t>(0.36236089468002319);
    kernel_vals[3] = static_cast<value_t>(-0.65567320585250854);
    kernel_vals[4] = static_cast<value_t>(-0.38853132724761963);
    kernel_vals[5] = static_cast<value_t>(0.91373872756958008);
    kernel_vals[6] = static_cast<value_t>(0.31996369361877441);
    kernel_vals[7] = static_cast<value_t>(1.27875995635986328);
    kernel_vals[8] = static_cast<value_t>(-0.78601670265197754);
    kernel = kernel_vals;

    // Run conv2d_transpose
    Tensor<value_t> result = nn:: conv2d_transpose<value_t>(
        input, kernel, 2, {1, 2}, {0, 0}
    );

    std::vector<value_t> expected(15);
    expected[0] = static_cast<value_t>(0.12455204129219055);
    expected[1] = static_cast<value_t>(0.23560616374015808);
    expected[2] = static_cast<value_t>(-0.56939840316772461);
    expected[3] = static_cast<value_t>(-0.34648889303207397);
    expected[4] = static_cast<value_t>(-0.13813620805740356);
    expected[5] = static_cast<value_t>(1.39660835266113281);
    expected[6] = static_cast<value_t>(0.41956830024719238);
    expected[7] = static_cast<value_t>(-0.56801563501358032);
    expected[8] = static_cast<value_t>(1.72870826721191406);
    expected[9] = static_cast<value_t>(-0.45216166973114014);
    expected[10] = static_cast<value_t>(1.94178402423858643);
    expected[11] = static_cast<value_t>(-0.78385531902313232);
    expected[12] = static_cast<value_t>(0.82804501056671143);
    expected[13] = static_cast<value_t>(-0.06443344801664352);
    expected[14] = static_cast<value_t>(0.66155934333801270);

    std::vector<value_t> host(expected.size());
    g_sycl_queue.memcpy(host.data(), result.m_p_data. get(),
                        host.size() * sizeof(value_t)).wait();

    // Compare results
    for (size_t i = 0; i < host.size(); ++i)
    {
        if constexpr (std::is_floating_point<value_t>::value)
        {
            EXPECT_NEAR(static_cast<double>(host[i]),
                        static_cast<double>(expected[i]), 0.0001);
        }
        else
        {
            EXPECT_EQ(host[i], expected[i]);
        }
    }
}

/**
 * @test TypedConv2DTranspose. output_padding_1_1
 * @brief Conv2d transpose test: 
 *   input:  (1, 3, 3), kernel: (1, 1, 3, 3)
 *   stride: 2, padding: (0, 0), output_padding: (1, 1)
 */
TYPED_TEST(TypedConv2DTranspose, output_padding_1_1)
{
    using value_t = TypeParam;

    Tensor<value_t> input(
        {1, 3, 3},
        MemoryLocation::DEVICE
    );

    std::vector<value_t> input_vals(9);
    input_vals[0] = static_cast<value_t>(0.69918179512023926);
    input_vals[1] = static_cast<value_t>(1.02021777629852295);
    input_vals[2] = static_cast<value_t>(-0.09656475484371185);
    input_vals[3] = static_cast<value_t>(1.80759894847869873);
    input_vals[4] = static_cast<value_t>(-0.49911499023437500);
    input_vals[5] = static_cast<value_t>(0.93322134017944336);
    input_vals[6] = static_cast<value_t>(0.72876673936843872);
    input_vals[7] = static_cast<value_t>(-0.67945265769958496);
    input_vals[8] = static_cast<value_t>(0.51876568794250488);
    input = input_vals;

    Tensor<value_t> kernel(
        {1, 1, 3, 3},
        MemoryLocation::DEVICE
    );

    std::vector<value_t> kernel_vals(9);
    kernel_vals[0] = static_cast<value_t>(-1.28276622295379639);
    kernel_vals[1] = static_cast<value_t>(-2.23343467712402344);
    kernel_vals[2] = static_cast<value_t>(0.13631442189216614);
    kernel_vals[3] = static_cast<value_t>(-0.74448114633560181);
    kernel_vals[4] = static_cast<value_t>(1.02706670761108398);
    kernel_vals[5] = static_cast<value_t>(1.70966076850891113);
    kernel_vals[6] = static_cast<value_t>(-1.03301584720611572);
    kernel_vals[7] = static_cast<value_t>(0.13858050107955933);
    kernel_vals[8] = static_cast<value_t>(0.71088850498199463);
    kernel = kernel_vals;

    // Run conv2d_transpose
    Tensor<value_t> result = nn:: conv2d_transpose<value_t>(
        input, kernel, 2, {0, 0}, {1, 1}
    );

    std::vector<value_t> expected(64);
    expected[0] = static_cast<value_t>(-0.89688676595687866);
    expected[1] = static_cast<value_t>(-1.56157684326171875);
    expected[2] = static_cast<value_t>(-1.21339237689971924);
    expected[3] = static_cast<value_t>(-2.27858972549438477);
    expected[4] = static_cast<value_t>(0.26294040679931641);
    expected[5] = static_cast<value_t>(0.21567107737064362);
    expected[6] = static_cast<value_t>(-0.01316316891461611);
    expected[7] = static_cast<value_t>(0.00000000000000000);
    expected[8] = static_cast<value_t>(-0.52052766084671021);
    expected[9] = static_cast<value_t>(0.71810632944107056);
    expected[10] = static_cast<value_t>(0.43583071231842041);
    expected[11] = static_cast<value_t>(1.04783165454864502);
    expected[12] = static_cast<value_t>(1.81611692905426025);
    expected[13] = static_cast<value_t>(-0.09917844831943512);
    expected[14] = static_cast<value_t>(-0.16509297490119934);
    expected[15] = static_cast<value_t>(0.00000000000000000);
    expected[16] = static_cast<value_t>(-3.04099273681640625);
    expected[17] = static_cast<value_t>(-3.94026112556457520);
    expected[18] = static_cast<value_t>(0.32978883385658264);
    expected[19] = static_cast<value_t>(1.25612306594848633);
    expected[20] = static_cast<value_t>(-0.44012737274169922);
    expected[21] = static_cast<value_t>(-2.09767079353332520);
    expected[22] = static_cast<value_t>(0.05856475234031677);
    expected[23] = static_cast<value_t>(0.00000000000000000);
    expected[24] = static_cast<value_t>(-1.34572339057922363);
    expected[25] = static_cast<value_t>(1.85652470588684082);
    expected[26] = static_cast<value_t>(3.46196269989013672);
    expected[27] = static_cast<value_t>(-0.51262438297271729);
    expected[28] = static_cast<value_t>(-1.54808306694030762);
    expected[29] = static_cast<value_t>(0.95848059654235840);
    expected[30] = static_cast<value_t>(1.59549188613891602);
    expected[31] = static_cast<value_t>(0.00000000000000000);
    expected[32] = static_cast<value_t>(-2.80211567878723145);
    expected[33] = static_cast<value_t>(-1.37715494632720947);
    expected[34] = static_cast<value_t>(2.77151536941528320);
    expected[35] = static_cast<value_t>(1.44834554195404053);
    expected[36] = static_cast<value_t>(-2.07692170143127441);
    expected[37] = static_cast<value_t>(-1.02930307388305664);
    expected[38] = static_cast<value_t>(0.73413157463073730);
    expected[39] = static_cast<value_t>(0.00000000000000000);
    expected[40] = static_cast<value_t>(-0.54255312681198120);
    expected[41] = static_cast<value_t>(0.74849206209182739);
    expected[42] = static_cast<value_t>(1.75178360939025879);
    expected[43] = static_cast<value_t>(-0.69784319400787354);
    expected[44] = static_cast<value_t>(-1.54784488677978516);
    expected[45] = static_cast<value_t>(0.53280699253082275);
    expected[46] = static_cast<value_t>(0.88691335916519165);
    expected[47] = static_cast<value_t>(0.00000000000000000);
    expected[48] = static_cast<value_t>(-0.75282758474349976);
    expected[49] = static_cast<value_t>(0.10099285840988159);
    expected[50] = static_cast<value_t>(1.21995723247528076);
    expected[51] = static_cast<value_t>(-0.09415888786315918);
    expected[52] = static_cast<value_t>(-1.01890826225280762);
    expected[53] = static_cast<value_t>(0.07189080864191055);
    expected[54] = static_cast<value_t>(0.36878457665443420);
    expected[55] = static_cast<value_t>(0.00000000000000000);
    expected[56] = static_cast<value_t>(0.00000000000000000);
    expected[57] = static_cast<value_t>(0.00000000000000000);
    expected[58] = static_cast<value_t>(0.00000000000000000);
    expected[59] = static_cast<value_t>(0.00000000000000000);
    expected[60] = static_cast<value_t>(0.00000000000000000);
    expected[61] = static_cast<value_t>(0.00000000000000000);
    expected[62] = static_cast<value_t>(0.00000000000000000);
    expected[63] = static_cast<value_t>(0.00000000000000000);

    std::vector<value_t> host(expected.size());
    g_sycl_queue.memcpy(host.data(), result.m_p_data. get(),
                        host.size() * sizeof(value_t)).wait();

    // Compare results
    for (size_t i = 0; i < host.size(); ++i)
    {
        if constexpr (std::is_floating_point<value_t>::value)
        {
            EXPECT_NEAR(static_cast<double>(host[i]),
                        static_cast<double>(expected[i]), 0.0001);
        }
        else
        {
            EXPECT_EQ(host[i], expected[i]);
        }
    }
}

/**
 * @test TypedConv2DTranspose. output_padding_1_0
 * @brief Conv2d transpose test: 
 *   input:  (2, 4, 4), kernel: (2, 2, 3, 3)
 *   stride: 2, padding: (1, 1), output_padding: (1, 0)
 */
TYPED_TEST(TypedConv2DTranspose, output_padding_1_0)
{
    using value_t = TypeParam;

    Tensor<value_t> input(
        {2, 4, 4},
        MemoryLocation::DEVICE
    );

    std::vector<value_t> input_vals(32);
    input_vals[0] = static_cast<value_t>(0.22934691607952118);
    input_vals[1] = static_cast<value_t>(-0.14879703521728516);
    input_vals[2] = static_cast<value_t>(-1.13444519042968750);
    input_vals[3] = static_cast<value_t>(-1.07508707046508789);
    input_vals[4] = static_cast<value_t>(-0.36619222164154053);
    input_vals[5] = static_cast<value_t>(-0.95191729068756104);
    input_vals[6] = static_cast<value_t>(-0.85861474275588989);
    input_vals[7] = static_cast<value_t>(-0.67974793910980225);
    input_vals[8] = static_cast<value_t>(0.68845057487487793);
    input_vals[9] = static_cast<value_t>(0.19481180608272552);
    input_vals[10] = static_cast<value_t>(-0.44863080978393555);
    input_vals[11] = static_cast<value_t>(0.50426518917083740);
    input_vals[12] = static_cast<value_t>(-0.58570230007171631);
    input_vals[13] = static_cast<value_t>(0.41588807106018066);
    input_vals[14] = static_cast<value_t>(0.19039121270179749);
    input_vals[15] = static_cast<value_t>(0.67263513803482056);
    input_vals[16] = static_cast<value_t>(0.81036889553070068);
    input_vals[17] = static_cast<value_t>(1.61212003231048584);
    input_vals[18] = static_cast<value_t>(-2.45904254913330078);
    input_vals[19] = static_cast<value_t>(0.26708358526229858);
    input_vals[20] = static_cast<value_t>(0.29480347037315369);
    input_vals[21] = static_cast<value_t>(1.07211947441101074);
    input_vals[22] = static_cast<value_t>(0.85752028226852417);
    input_vals[23] = static_cast<value_t>(1.11543393135070801);
    input_vals[24] = static_cast<value_t>(0.68396216630935669);
    input_vals[25] = static_cast<value_t>(0.68649905920028687);
    input_vals[26] = static_cast<value_t>(-0.05759226530790329);
    input_vals[27] = static_cast<value_t>(0.20913827419281006);
    input_vals[28] = static_cast<value_t>(0.40064853429794312);
    input_vals[29] = static_cast<value_t>(-1.23310935497283936);
    input_vals[30] = static_cast<value_t>(0.79792809486389160);
    input_vals[31] = static_cast<value_t>(-0.10941365361213684);
    input = input_vals;

    Tensor<value_t> kernel(
        {2, 2, 3, 3},
        MemoryLocation::DEVICE
    );

    std::vector<value_t> kernel_vals(36);
    kernel_vals[0] = static_cast<value_t>(-0.36531183123588562);
    kernel_vals[1] = static_cast<value_t>(-0.64907324314117432);
    kernel_vals[2] = static_cast<value_t>(-1.10113990306854248);
    kernel_vals[3] = static_cast<value_t>(0.13652613759040833);
    kernel_vals[4] = static_cast<value_t>(-0.55446720123291016);
    kernel_vals[5] = static_cast<value_t>(1.69952368736267090);
    kernel_vals[6] = static_cast<value_t>(0.03674108535051346);
    kernel_vals[7] = static_cast<value_t>(0.37669998407363892);
    kernel_vals[8] = static_cast<value_t>(0.96435093879699707);
    kernel_vals[9] = static_cast<value_t>(0.21656630933284760);
    kernel_vals[10] = static_cast<value_t>(0.23643904924392700);
    kernel_vals[11] = static_cast<value_t>(-0.69816279411315918);
    kernel_vals[12] = static_cast<value_t>(-0.19998787343502045);
    kernel_vals[13] = static_cast<value_t>(-0.93434810638427734);
    kernel_vals[14] = static_cast<value_t>(1.11417078971862793);
    kernel_vals[15] = static_cast<value_t>(1.80182695388793945);
    kernel_vals[16] = static_cast<value_t>(-0.15108940005302429);
    kernel_vals[17] = static_cast<value_t>(0.52064031362533569);
    kernel_vals[18] = static_cast<value_t>(-0.80100893974304199);
    kernel_vals[19] = static_cast<value_t>(0.78248125314712524);
    kernel_vals[20] = static_cast<value_t>(1.38717603683471680);
    kernel_vals[21] = static_cast<value_t>(-0.77695536613464355);
    kernel_vals[22] = static_cast<value_t>(0.95973163843154907);
    kernel_vals[23] = static_cast<value_t>(0.69807732105255127);
    kernel_vals[24] = static_cast<value_t>(0.50530552864074707);
    kernel_vals[25] = static_cast<value_t>(0.78501522541046143);
    kernel_vals[26] = static_cast<value_t>(0.51544803380966187);
    kernel_vals[27] = static_cast<value_t>(-1.61397159099578857);
    kernel_vals[28] = static_cast<value_t>(-1.81722438335418701);
    kernel_vals[29] = static_cast<value_t>(-0.97673708200454712);
    kernel_vals[30] = static_cast<value_t>(-0.38300949335098267);
    kernel_vals[31] = static_cast<value_t>(-0.93839126825332642);
    kernel_vals[32] = static_cast<value_t>(-1.54056942462921143);
    kernel_vals[33] = static_cast<value_t>(0.90438491106033325);
    kernel_vals[34] = static_cast<value_t>(0.20180363953113556);
    kernel_vals[35] = static_cast<value_t>(-1.59909677505493164);
    kernel = kernel_vals;

    // Run conv2d_transpose
    Tensor<value_t> result = nn:: conv2d_transpose<value_t>(
        input, kernel, 2, {1, 1}, {1, 0}
    );

    std::vector<value_t> expected(112);
    expected[0] = static_cast<value_t>(0.65057134628295898);
    expected[1] = static_cast<value_t>(-0.31737935543060303);
    expected[2] = static_cast<value_t>(1.62970566749572754);
    expected[3] = static_cast<value_t>(2.62818527221679688);
    expected[4] = static_cast<value_t>(-1.73100829124450684);
    expected[5] = static_cast<value_t>(-3.99890780448913574);
    expected[6] = static_cast<value_t>(0.85242909193038940);
    expected[7] = static_cast<value_t>(1.19091057777404785);
    expected[8] = static_cast<value_t>(1.74916291236877441);
    expected[9] = static_cast<value_t>(2.66626453399658203);
    expected[10] = static_cast<value_t>(1.56541621685028076);
    expected[11] = static_cast<value_t>(-1.12943398952484131);
    expected[12] = static_cast<value_t>(-0.77621889114379883);
    expected[13] = static_cast<value_t>(1.11869168281555176);
    expected[14] = static_cast<value_t>(0.48597380518913269);
    expected[15] = static_cast<value_t>(-1.37950730323791504);
    expected[16] = static_cast<value_t>(1.55675387382507324);
    expected[17] = static_cast<value_t>(-1.65286207199096680);
    expected[18] = static_cast<value_t>(1.29906308650970459);
    expected[19] = static_cast<value_t>(-1.82006645202636719);
    expected[20] = static_cast<value_t>(1.44741511344909668);
    expected[21] = static_cast<value_t>(0.18181331455707550);
    expected[22] = static_cast<value_t>(-0.12477195262908936);
    expected[23] = static_cast<value_t>(0.89376837015151978);
    expected[24] = static_cast<value_t>(0.98420488834381104);
    expected[25] = static_cast<value_t>(0.59585571289062500);
    expected[26] = static_cast<value_t>(0.21504047513008118);
    expected[27] = static_cast<value_t>(0.45591330528259277);
    expected[28] = static_cast<value_t>(0.27469688653945923);
    expected[29] = static_cast<value_t>(1.14071440696716309);
    expected[30] = static_cast<value_t>(0.55083811283111572);
    expected[31] = static_cast<value_t>(0.79381352663040161);
    expected[32] = static_cast<value_t>(0.19347795844078064);
    expected[33] = static_cast<value_t>(-0.89630830287933350);
    expected[34] = static_cast<value_t>(-0.07888188213109970);
    expected[35] = static_cast<value_t>(1.48992371559143066);
    expected[36] = static_cast<value_t>(3.40701746940612793);
    expected[37] = static_cast<value_t>(-0.62252897024154663);
    expected[38] = static_cast<value_t>(-2.38105368614196777);
    expected[39] = static_cast<value_t>(0.28657591342926025);
    expected[40] = static_cast<value_t>(0.40102165937423706);
    expected[41] = static_cast<value_t>(-0.16807019710540771);
    expected[42] = static_cast<value_t>(0.70926779508590698);
    expected[43] = static_cast<value_t>(0.29911923408508301);
    expected[44] = static_cast<value_t>(-1.41405034065246582);
    expected[45] = static_cast<value_t>(-0.74795520305633545);
    expected[46] = static_cast<value_t>(0.66023117303848267);
    expected[47] = static_cast<value_t>(1.05743169784545898);
    expected[48] = static_cast<value_t>(-0.47796186804771423);
    expected[49] = static_cast<value_t>(0.09388115257024765);
    expected[50] = static_cast<value_t>(-0.96612584590911865);
    expected[51] = static_cast<value_t>(-0.81134456396102905);
    expected[52] = static_cast<value_t>(0.17565092444419861);
    expected[53] = static_cast<value_t>(0.69810605049133301);
    expected[54] = static_cast<value_t>(0.56432044506072998);
    expected[55] = static_cast<value_t>(0.16749025881290436);
    expected[56] = static_cast<value_t>(-0.97473293542861938);
    expected[57] = static_cast<value_t>(-1.58059763908386230);
    expected[58] = static_cast<value_t>(-1.37377119064331055);
    expected[59] = static_cast<value_t>(-1.48065614700317383);
    expected[60] = static_cast<value_t>(3.36751079559326172);
    expected[61] = static_cast<value_t>(2.63706874847412109);
    expected[62] = static_cast<value_t>(0.75387662649154663);
    expected[63] = static_cast<value_t>(-0.49342265725135803);
    expected[64] = static_cast<value_t>(-1.95538783073425293);
    expected[65] = static_cast<value_t>(-1.82553863525390625);
    expected[66] = static_cast<value_t>(-8.87594699859619141);
    expected[67] = static_cast<value_t>(-2.08615779876708984);
    expected[68] = static_cast<value_t>(-0.53957366943359375);
    expected[69] = static_cast<value_t>(-1.97137999534606934);
    expected[70] = static_cast<value_t>(0.06551001220941544);
    expected[71] = static_cast<value_t>(-1.08242583274841309);
    expected[72] = static_cast<value_t>(-0.11664543300867081);
    expected[73] = static_cast<value_t>(-2.86899876594543457);
    expected[74] = static_cast<value_t>(-0.00244446471333504);
    expected[75] = static_cast<value_t>(-2.56899356842041016);
    expected[76] = static_cast<value_t>(-0.41159224510192871);
    expected[77] = static_cast<value_t>(-0.96531599760055542);
    expected[78] = static_cast<value_t>(-3.62215757369995117);
    expected[79] = static_cast<value_t>(-0.84127944707870483);
    expected[80] = static_cast<value_t>(-3.79232168197631836);
    expected[81] = static_cast<value_t>(0.30136254429817200);
    expected[82] = static_cast<value_t>(-1.89316046237945557);
    expected[83] = static_cast<value_t>(0.06697815656661987);
    expected[84] = static_cast<value_t>(-1.28507661819458008);
    expected[85] = static_cast<value_t>(-0.58853530883789062);
    expected[86] = static_cast<value_t>(-0.82622677087783813);
    expected[87] = static_cast<value_t>(-0.72876673936843872);
    expected[88] = static_cast<value_t>(0.47322142124176025);
    expected[89] = static_cast<value_t>(-0.59207534790039062);
    expected[90] = static_cast<value_t>(-0.66741275787353516);
    expected[91] = static_cast<value_t>(-0.83254271745681763);
    expected[92] = static_cast<value_t>(2.33444786071777344);
    expected[93] = static_cast<value_t>(2.44827246665954590);
    expected[94] = static_cast<value_t>(-2.18932723999023438);
    expected[95] = static_cast<value_t>(-1.34883737564086914);
    expected[96] = static_cast<value_t>(0.36623102426528931);
    expected[97] = static_cast<value_t>(0.32388210296630859);
    expected[98] = static_cast<value_t>(0.17128476500511169);
    expected[99] = static_cast<value_t>(-0.88067924976348877);
    expected[100] = static_cast<value_t>(0.76855480670928955);
    expected[101] = static_cast<value_t>(2.01937103271484375);
    expected[102] = static_cast<value_t>(-0.92666041851043701);
    expected[103] = static_cast<value_t>(-1.10974764823913574);
    expected[104] = static_cast<value_t>(-0.52580255270004272);
    expected[105] = static_cast<value_t>(0.16934573650360107);
    expected[106] = static_cast<value_t>(-1.31146311759948730);
    expected[107] = static_cast<value_t>(-0.31168222427368164);
    expected[108] = static_cast<value_t>(3.25307559967041016);
    expected[109] = static_cast<value_t>(0.13225869834423065);
    expected[110] = static_cast<value_t>(-0.06381881237030029);
    expected[111] = static_cast<value_t>(-0.12370811402797699);

    std::vector<value_t> host(expected.size());
    g_sycl_queue.memcpy(host.data(), result.m_p_data. get(),
                        host.size() * sizeof(value_t)).wait();

    // Compare results
    for (size_t i = 0; i < host.size(); ++i)
    {
        if constexpr (std::is_floating_point<value_t>::value)
        {
            EXPECT_NEAR(static_cast<double>(host[i]),
                        static_cast<double>(expected[i]), 0.0001);
        }
        else
        {
            EXPECT_EQ(host[i], expected[i]);
        }
    }
}

/**
 * @test TypedConv2DTranspose. large_stride_s3
 * @brief Conv2d transpose test: 
 *   input:  (1, 2, 2), kernel: (1, 1, 3, 3)
 *   stride: 3, padding: (0, 0), output_padding: (0, 0)
 */
TYPED_TEST(TypedConv2DTranspose, large_stride_s3)
{
    using value_t = TypeParam;

    Tensor<value_t> input(
        {1, 2, 2},
        MemoryLocation::DEVICE
    );

    std::vector<value_t> input_vals(4);
    input_vals[0] = static_cast<value_t>(0.13484546542167664);
    input_vals[1] = static_cast<value_t>(0.59377789497375488);
    input_vals[2] = static_cast<value_t>(0.79062134027481079);
    input_vals[3] = static_cast<value_t>(0.93572199344635010);
    input = input_vals;

    Tensor<value_t> kernel(
        {1, 1, 3, 3},
        MemoryLocation::DEVICE
    );

    std::vector<value_t> kernel_vals(9);
    kernel_vals[0] = static_cast<value_t>(-0.97686582803726196);
    kernel_vals[1] = static_cast<value_t>(-0.34959560632705688);
    kernel_vals[2] = static_cast<value_t>(-0.61018854379653931);
    kernel_vals[3] = static_cast<value_t>(-0.26352337002754211);
    kernel_vals[4] = static_cast<value_t>(-0.44064065814018250);
    kernel_vals[5] = static_cast<value_t>(0.98573708534240723);
    kernel_vals[6] = static_cast<value_t>(-0.18629854917526245);
    kernel_vals[7] = static_cast<value_t>(-0.70285397768020630);
    kernel_vals[8] = static_cast<value_t>(0.91175192594528198);
    kernel = kernel_vals;

    // Run conv2d_transpose
    Tensor<value_t> result = nn:: conv2d_transpose<value_t>(
        input, kernel, 3, {0, 0}, {0, 0}
    );

    std::vector<value_t> expected(36);
    expected[0] = static_cast<value_t>(-0.13172592222690582);
    expected[1] = static_cast<value_t>(-0.04714138060808182);
    expected[2] = static_cast<value_t>(-0.08228115737438202);
    expected[3] = static_cast<value_t>(-0.58004134893417358);
    expected[4] = static_cast<value_t>(-0.20758214592933655);
    expected[5] = static_cast<value_t>(-0.36231645941734314);
    expected[6] = static_cast<value_t>(-0.03553493320941925);
    expected[7] = static_cast<value_t>(-0.05941839516162872);
    expected[8] = static_cast<value_t>(0.13292217254638672);
    expected[9] = static_cast<value_t>(-0.15647435188293457);
    expected[10] = static_cast<value_t>(-0.26164269447326660);
    expected[11] = static_cast<value_t>(0.58530890941619873);
    expected[12] = static_cast<value_t>(-0.02512151375412941);
    expected[13] = static_cast<value_t>(-0.09477667510509491);
    expected[14] = static_cast<value_t>(0.12294561415910721);
    expected[15] = static_cast<value_t>(-0.11061996221542358);
    expected[16] = static_cast<value_t>(-0.41733914613723755);
    expected[17] = static_cast<value_t>(0.54137814044952393);
    expected[18] = static_cast<value_t>(-0.77233099937438965);
    expected[19] = static_cast<value_t>(-0.27639773488044739);
    expected[20] = static_cast<value_t>(-0.48242807388305664);
    expected[21] = static_cast<value_t>(-0.91407483816146851);
    expected[22] = static_cast<value_t>(-0.32712429761886597);
    expected[23] = static_cast<value_t>(-0.57096683979034424);
    expected[24] = static_cast<value_t>(-0.20834720134735107);
    expected[25] = static_cast<value_t>(-0.34837990999221802);
    expected[26] = static_cast<value_t>(0.77934479713439941);
    expected[27] = static_cast<value_t>(-0.24658460915088654);
    expected[28] = static_cast<value_t>(-0.41231715679168701);
    expected[29] = static_cast<value_t>(0.92237585783004761);
    expected[30] = static_cast<value_t>(-0.14729161560535431);
    expected[31] = static_cast<value_t>(-0.55569136142730713);
    expected[32] = static_cast<value_t>(0.72085052728652954);
    expected[33] = static_cast<value_t>(-0.17432364821434021);
    expected[34] = static_cast<value_t>(-0.65767592191696167);
    expected[35] = static_cast<value_t>(0.85314631462097168);

    std::vector<value_t> host(expected.size());
    g_sycl_queue.memcpy(host.data(), result.m_p_data. get(),
                        host.size() * sizeof(value_t)).wait();

    // Compare results
    for (size_t i = 0; i < host.size(); ++i)
    {
        if constexpr (std::is_floating_point<value_t>::value)
        {
            EXPECT_NEAR(static_cast<double>(host[i]),
                        static_cast<double>(expected[i]), 0.0001);
        }
        else
        {
            EXPECT_EQ(host[i], expected[i]);
        }
    }
}

/**
 * @test TypedConv2DTranspose. view_weird_strides
 * @brief Ensure nn::conv2d_transpose accepts non-contiguous/alias views
 */
TYPED_TEST(TypedConv2DTranspose, view_weird_strides)
{
    using value_t = TypeParam;

    Tensor<value_t> input_owner({30}, MemoryLocation::DEVICE);
    std::vector<value_t> input_owner_vals(30);
    input_owner_vals[0] = static_cast<value_t>(0.00000000000000000);
    input_owner_vals[1] = static_cast<value_t>(1.00000000000000000);
    input_owner_vals[2] = static_cast<value_t>(2.00000000000000000);
    input_owner_vals[3] = static_cast<value_t>(3.00000000000000000);
    input_owner_vals[4] = static_cast<value_t>(4.00000000000000000);
    input_owner_vals[5] = static_cast<value_t>(5.00000000000000000);
    input_owner_vals[6] = static_cast<value_t>(6.00000000000000000);
    input_owner_vals[7] = static_cast<value_t>(7.00000000000000000);
    input_owner_vals[8] = static_cast<value_t>(8.00000000000000000);
    input_owner_vals[9] = static_cast<value_t>(9.00000000000000000);
    input_owner_vals[10] = static_cast<value_t>(10.00000000000000000);
    input_owner_vals[11] = static_cast<value_t>(11.00000000000000000);
    input_owner_vals[12] = static_cast<value_t>(12.00000000000000000);
    input_owner_vals[13] = static_cast<value_t>(13.00000000000000000);
    input_owner_vals[14] = static_cast<value_t>(14.00000000000000000);
    input_owner_vals[15] = static_cast<value_t>(15.00000000000000000);
    input_owner_vals[16] = static_cast<value_t>(16.00000000000000000);
    input_owner_vals[17] = static_cast<value_t>(17.00000000000000000);
    input_owner_vals[18] = static_cast<value_t>(18.00000000000000000);
    input_owner_vals[19] = static_cast<value_t>(19.00000000000000000);
    input_owner_vals[20] = static_cast<value_t>(20.00000000000000000);
    input_owner_vals[21] = static_cast<value_t>(21.00000000000000000);
    input_owner_vals[22] = static_cast<value_t>(22.00000000000000000);
    input_owner_vals[23] = static_cast<value_t>(23.00000000000000000);
    input_owner_vals[24] = static_cast<value_t>(24.00000000000000000);
    input_owner_vals[25] = static_cast<value_t>(25.00000000000000000);
    input_owner_vals[26] = static_cast<value_t>(26.00000000000000000);
    input_owner_vals[27] = static_cast<value_t>(27.00000000000000000);
    input_owner_vals[28] = static_cast<value_t>(28.00000000000000000);
    input_owner_vals[29] = static_cast<value_t>(29.00000000000000000);
    input_owner = input_owner_vals;

    Tensor<value_t> input_alias(
        input_owner,
        std::vector<uint64_t>{0ull},
        std::vector<uint64_t>{1ull, 2ull, 2ull},
        std::vector<uint64_t>{8ull, 4ull, 2ull}
    );

    Tensor<value_t> kernel_owner({30}, MemoryLocation::DEVICE);
    std::vector<value_t> kernel_owner_vals(30);
    kernel_owner_vals[0] = static_cast<value_t>(0.00000000000000000);
    kernel_owner_vals[1] = static_cast<value_t>(1.00000000000000000);
    kernel_owner_vals[2] = static_cast<value_t>(2.00000000000000000);
    kernel_owner_vals[3] = static_cast<value_t>(3.00000000000000000);
    kernel_owner_vals[4] = static_cast<value_t>(4.00000000000000000);
    kernel_owner_vals[5] = static_cast<value_t>(5.00000000000000000);
    kernel_owner_vals[6] = static_cast<value_t>(6.00000000000000000);
    kernel_owner_vals[7] = static_cast<value_t>(7.00000000000000000);
    kernel_owner_vals[8] = static_cast<value_t>(8.00000000000000000);
    kernel_owner_vals[9] = static_cast<value_t>(9.00000000000000000);
    kernel_owner_vals[10] = static_cast<value_t>(10.00000000000000000);
    kernel_owner_vals[11] = static_cast<value_t>(11.00000000000000000);
    kernel_owner_vals[12] = static_cast<value_t>(12.00000000000000000);
    kernel_owner_vals[13] = static_cast<value_t>(13.00000000000000000);
    kernel_owner_vals[14] = static_cast<value_t>(14.00000000000000000);
    kernel_owner_vals[15] = static_cast<value_t>(15.00000000000000000);
    kernel_owner_vals[16] = static_cast<value_t>(16.00000000000000000);
    kernel_owner_vals[17] = static_cast<value_t>(17.00000000000000000);
    kernel_owner_vals[18] = static_cast<value_t>(18.00000000000000000);
    kernel_owner_vals[19] = static_cast<value_t>(19.00000000000000000);
    kernel_owner_vals[20] = static_cast<value_t>(20.00000000000000000);
    kernel_owner_vals[21] = static_cast<value_t>(21.00000000000000000);
    kernel_owner_vals[22] = static_cast<value_t>(22.00000000000000000);
    kernel_owner_vals[23] = static_cast<value_t>(23.00000000000000000);
    kernel_owner_vals[24] = static_cast<value_t>(24.00000000000000000);
    kernel_owner_vals[25] = static_cast<value_t>(25.00000000000000000);
    kernel_owner_vals[26] = static_cast<value_t>(26.00000000000000000);
    kernel_owner_vals[27] = static_cast<value_t>(27.00000000000000000);
    kernel_owner_vals[28] = static_cast<value_t>(28.00000000000000000);
    kernel_owner_vals[29] = static_cast<value_t>(29.00000000000000000);
    kernel_owner = kernel_owner_vals;

    Tensor<value_t> kernel_alias(
        kernel_owner,
        std::vector<uint64_t>{0ull},
        std::vector<uint64_t>{1ull, 1ull, 2ull, 2ull},
        std::vector<uint64_t>{8ull, 8ull, 4ull, 2ull}
    );

    Tensor<value_t> result = nn::conv2d_transpose<value_t>(
        input_alias, kernel_alias, 2, {0, 0}, {0, 0}
    );

    std::vector<value_t> expected(16);
    expected[0] = static_cast<value_t>(0.00000000000000000);
    expected[1] = static_cast<value_t>(0.00000000000000000);
    expected[2] = static_cast<value_t>(0.00000000000000000);
    expected[3] = static_cast<value_t>(4.00000000000000000);
    expected[4] = static_cast<value_t>(0.00000000000000000);
    expected[5] = static_cast<value_t>(0.00000000000000000);
    expected[6] = static_cast<value_t>(8.00000000000000000);
    expected[7] = static_cast<value_t>(12.00000000000000000);
    expected[8] = static_cast<value_t>(0.00000000000000000);
    expected[9] = static_cast<value_t>(8.00000000000000000);
    expected[10] = static_cast<value_t>(0.00000000000000000);
    expected[11] = static_cast<value_t>(12.00000000000000000);
    expected[12] = static_cast<value_t>(16.00000000000000000);
    expected[13] = static_cast<value_t>(24.00000000000000000);
    expected[14] = static_cast<value_t>(24.00000000000000000);
    expected[15] = static_cast<value_t>(36.00000000000000000);

    std::vector<value_t> host(expected.size());
    g_sycl_queue.memcpy(host.data(), result.m_p_data.get(),
                        host.size() * sizeof(value_t)).wait();

    // compare element-wise
    for (size_t i = 0; i < host.size(); ++i)
    {
        if constexpr (std::is_floating_point<value_t>::value)
        {
            EXPECT_NEAR(static_cast<double>(host[i]),
                        static_cast<double>(expected[i]), 0.0001);
        }
        else
        {
            EXPECT_EQ(host[i], expected[i]);
        }
    }
}
