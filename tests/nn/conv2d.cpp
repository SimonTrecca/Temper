/**
  * @file conv2d.cpp
  * @brief File generated by tests/nn/conv2d. py.
  * Tests use true mathematical convolution (with kernel flipping).
  */

/**
  * @test CONV2D. conv2d_random_test_ic1_oc1_k3x3_s1_p0_0
  * @brief Randomly generated conv2d test (true convolution):
  *   input: (1, 5, 5), kernel: (1, 1, 3, 3)
  *   stride: 1, padding: (0, 0)
  *
  * The test is generated from the script, expecting values from PyTorch
  * with kernel flipping to match mathematical convolution.
  */
TEST(CONV2D, conv2d_random_test_ic1_oc1_k3x3_s1_p0_0)
{
    Tensor<float> input({1, 5, 5});
    input = std::vector<float>{-0.32025453448295593, 1.09050679206848145, 1.52886152267456055, 1.37612140178680420, -0.30621761083602905, -0.32709565758705139, -1.43723583221435547, -0.72984111309051514, -1.39495539665222168, 0.87123191356658936, -1.55909168720245361, 0.92335337400436401, 0.07040371000766754, 1.55344438552856445, -1.39755153656005859, -0.12756143510341644, -0.33480945229530334, -0.02569027058780193, -0.61265736818313599, 0.34612938761711121, -0.45054748654365540, -0.44789901375770569, -0.90636932849884033, -0.24323007464408875, -0.09989316761493683};
    Tensor<float> kernel({1, 1, 3, 3});
    kernel = std::vector<float>{-0.11314842104911804, -0.65692752599716187, 1.46753966808319092, -0.83684521913528442, -0.49411997199058533, 1.59754228591918945, -0.08843056112527847, -1.76865053176879883, -0.40919393301010132};
    Tensor<float> expected_result({1, 3, 3});
    expected_result = std::vector<float>{-4.03706693649291992, -2.90695786476135254, -4.99721240997314453, -0.22987465560436249, 1.73746585845947266, 3.52881717681884766, -1.28259921073913574, -0.68357038497924805, -3.83974027633666992};
    // run Temper nn::conv2d
    Tensor<float> result = nn::conv2d(input, kernel, 1, {0, 0});
    // check values
    EXPECT_NEAR(result[0][0][0], expected_result[0][0][0], 0.0001);
    EXPECT_NEAR(result[0][0][1], expected_result[0][0][1], 0.0001);
    EXPECT_NEAR(result[0][0][2], expected_result[0][0][2], 0.0001);
    EXPECT_NEAR(result[0][1][0], expected_result[0][1][0], 0.0001);
    EXPECT_NEAR(result[0][1][1], expected_result[0][1][1], 0.0001);
    EXPECT_NEAR(result[0][1][2], expected_result[0][1][2], 0.0001);
    EXPECT_NEAR(result[0][2][0], expected_result[0][2][0], 0.0001);
    EXPECT_NEAR(result[0][2][1], expected_result[0][2][1], 0.0001);
    EXPECT_NEAR(result[0][2][2], expected_result[0][2][2], 0.0001);
}

/**
  * @test CONV2D. conv2d_random_test_ic1_oc1_k3x3_s1_p1_1
  * @brief Randomly generated conv2d test (true convolution):
  *   input: (1, 5, 5), kernel: (1, 1, 3, 3)
  *   stride: 1, padding: (1, 1)
  *
  * The test is generated from the script, expecting values from PyTorch
  * with kernel flipping to match mathematical convolution.
  */
TEST(CONV2D, conv2d_random_test_ic1_oc1_k3x3_s1_p1_1)
{
    Tensor<float> input({1, 5, 5});
    input = std::vector<float>{-2.53475332260131836, -0.06538607180118561, 0.12405334413051605, -0.85589134693145752, -0.49764564633369446, -0.58272987604141235, -0.70518511533737183, 1.20940780639648438, 1.22638773918151855, 0.31923842430114746, -1.52496385574340820, -1.70568227767944336, -0.42592552304267883, 1.24464833736419678, 0.49398347735404968, 1.87258839607238770, -0.06424432992935181, 1.40322554111480713, -0.87162196636199951, -0.79654562473297119, -0.04781258478760719, -0.57865208387374878, 0.81793671846389771, -0.42460450530052185, -0.90231823921203613};
    Tensor<float> kernel({1, 1, 3, 3});
    kernel = std::vector<float>{0.46981075406074524, 1.11543941497802734, 0.90451461076736450, -0.50501388311386108, -0.92185431718826294, 0.49242639541625977, -1.71311390399932861, -0.21506716310977936, -1.32905745506286621};
    Tensor<float> expected_result({1, 5, 5});
    expected_result = std::vector<float>{1.38839077949523926, -1.99603796005249023, 1.57302105426788330, 3.71328210830688477, 1.50267004966735840, -0.95187628269195557, -0.55930554866790771, -1.98819041252136230, 1.41065025329589844, 3.23098182678222656, 5.65915203094482422, 2.17221999168395996, -1.40205478668212891, -4.10183858871459961, -3.21797370910644531, 1.23099899291992188, 3.09152460098266602, -0.46922028064727783, 1.19120323657989502, -2.84590172767639160, 0.04362913966178894, -4.78202676773071289, 0.45225340127944946, 0.93694365024566650, 1.95246601104736328};
    // run Temper nn::conv2d
    Tensor<float> result = nn::conv2d(input, kernel, 1, {1, 1});
    // check values
    EXPECT_NEAR(result[0][0][0], expected_result[0][0][0], 0.0001);
    EXPECT_NEAR(result[0][0][1], expected_result[0][0][1], 0.0001);
    EXPECT_NEAR(result[0][0][2], expected_result[0][0][2], 0.0001);
    EXPECT_NEAR(result[0][0][3], expected_result[0][0][3], 0.0001);
    EXPECT_NEAR(result[0][0][4], expected_result[0][0][4], 0.0001);
    EXPECT_NEAR(result[0][1][0], expected_result[0][1][0], 0.0001);
    EXPECT_NEAR(result[0][1][1], expected_result[0][1][1], 0.0001);
    EXPECT_NEAR(result[0][1][2], expected_result[0][1][2], 0.0001);
    EXPECT_NEAR(result[0][1][3], expected_result[0][1][3], 0.0001);
    EXPECT_NEAR(result[0][1][4], expected_result[0][1][4], 0.0001);
    EXPECT_NEAR(result[0][2][0], expected_result[0][2][0], 0.0001);
    EXPECT_NEAR(result[0][2][1], expected_result[0][2][1], 0.0001);
    EXPECT_NEAR(result[0][2][2], expected_result[0][2][2], 0.0001);
    EXPECT_NEAR(result[0][2][3], expected_result[0][2][3], 0.0001);
    EXPECT_NEAR(result[0][2][4], expected_result[0][2][4], 0.0001);
    EXPECT_NEAR(result[0][3][0], expected_result[0][3][0], 0.0001);
    EXPECT_NEAR(result[0][3][1], expected_result[0][3][1], 0.0001);
    EXPECT_NEAR(result[0][3][2], expected_result[0][3][2], 0.0001);
    EXPECT_NEAR(result[0][3][3], expected_result[0][3][3], 0.0001);
    EXPECT_NEAR(result[0][3][4], expected_result[0][3][4], 0.0001);
    EXPECT_NEAR(result[0][4][0], expected_result[0][4][0], 0.0001);
    EXPECT_NEAR(result[0][4][1], expected_result[0][4][1], 0.0001);
    EXPECT_NEAR(result[0][4][2], expected_result[0][4][2], 0.0001);
    EXPECT_NEAR(result[0][4][3], expected_result[0][4][3], 0.0001);
    EXPECT_NEAR(result[0][4][4], expected_result[0][4][4], 0.0001);
}

/**
  * @test CONV2D. conv2d_random_test_ic1_oc1_k3x3_s2_p0_0
  * @brief Randomly generated conv2d test (true convolution):
  *   input: (1, 6, 6), kernel: (1, 1, 3, 3)
  *   stride: 2, padding: (0, 0)
  *
  * The test is generated from the script, expecting values from PyTorch
  * with kernel flipping to match mathematical convolution.
  */
TEST(CONV2D, conv2d_random_test_ic1_oc1_k3x3_s2_p0_0)
{
    Tensor<float> input({1, 6, 6});
    input = std::vector<float>{0.05178675428032875, -1.63707685470581055, -1.50252282619476318, 0.55438178777694702, -0.39824515581130981, 1.29898011684417725, -0.95397400856018066, 0.76000750064849854, -1.22151470184326172, 0.08294533193111420, 1.05967724323272705, 0.80840682983398438, 0.93891829252243042, 0.41035738587379456, -0.82013696432113647, -0.64084458351135254, 1.28758084774017334, -0.75450515747070312, 0.99942362308502197, -1.97890555858612061, 0.47309339046478271, 1.10695600509643555, 1.05477082729339600, 0.42934912443161011, -0.96534764766693115, 0.13878674805164337, -0.68299299478530884, 0.71628504991531372, 0.07890740782022476, -1.27675151824951172, 1.24630808830261230, 0.19304127991199493, 0.02247252687811852, 1.02092361450195312, -0.25393885374069214, -0.49982595443725586};
    Tensor<float> kernel({1, 1, 3, 3});
    kernel = std::vector<float>{-0.98784965276718140, -1.63178932666778564, 0.82204824686050415, -1.00205183029174805, 1.29393351078033447, 0.96331578493118286, 0.41032949090003967, 1.69475686550140381, -0.96424067020416260};
    Tensor<float> expected_result({1, 2, 2});
    expected_result = std::vector<float>{-1.24007821083068848, -0.80671113729476929, -2.96362781524658203, -0.74403136968612671};
    // run Temper nn::conv2d
    Tensor<float> result = nn::conv2d(input, kernel, 2, {0, 0});
    // check values
    EXPECT_NEAR(result[0][0][0], expected_result[0][0][0], 0.0001);
    EXPECT_NEAR(result[0][0][1], expected_result[0][0][1], 0.0001);
    EXPECT_NEAR(result[0][1][0], expected_result[0][1][0], 0.0001);
    EXPECT_NEAR(result[0][1][1], expected_result[0][1][1], 0.0001);
}

/**
  * @test CONV2D. conv2d_random_test_ic3_oc1_k3x3_s1_p0_0
  * @brief Randomly generated conv2d test (true convolution):
  *   input: (3, 5, 5), kernel: (1, 3, 3, 3)
  *   stride: 1, padding: (0, 0)
  *
  * The test is generated from the script, expecting values from PyTorch
  * with kernel flipping to match mathematical convolution.
  */
TEST(CONV2D, conv2d_random_test_ic3_oc1_k3x3_s1_p0_0)
{
    Tensor<float> input({3, 5, 5});
    input = std::vector<float>{-0.66273570060729980, -0.16373935341835022, 1.15502643585205078, 0.99199587106704712, 0.38493540883064270, -0.29411661624908447, 1.55988764762878418, -0.45315542817115784, -0.56048417091369629, 0.79234266281127930, 1.07976233959197998, -0.22087351977825165, 0.95579254627227783, -0.26935368776321411, -1.36397886276245117, -0.83510327339172363, -0.76804149150848389, -0.68626356124877930, -0.73487579822540283, -0.33815109729766846, -0.78951704502105713, 0.92598271369934082, -1.46613574028015137, 0.66293513774871826, 1.29636347293853760, -0.28432911634445190, 0.36301285028457642, 0.38155367970466614, -0.72173905372619629, -1.31823968887329102, -0.18512465059757233, 1.23776400089263916, -0.03266875445842743, -1.95682513713836670, -0.80635672807693481, 1.35164785385131836, 1.69422972202301025, 0.79139953851699829, 1.57962095737457275, 0.17422308027744293, 0.03416933119297028, -0.15814851224422455, 1.23115253448486328, 1.55785596370697021, 1.86346817016601562, -1.59782886505126953, -1.65053224563598633, 0.40163803100585938, 0.08646292239427567, 1.03880405426025391, 1.04969561100006104, -0.83342641592025757, -0.89026772975921631, -0.44862347841262817, -0.49714705348014832, -0.04846218600869179, 0.29147341847419739, 0.10085124522447586, 0.56850790977478027, 0.36747357249259949, -0.04093047603964806, 1.72869575023651123, 0.03189796209335327, 0.09666817635297775, 0.93979358673095703, -1.03328859806060791, -0.30579540133476257, -0.07753363996744156, -0.06294257938861847, -0.24051670730113983, -0.95389550924301147, 0.17364995181560516, 0.42801061272621155, -1.19584929943084717, -1.24210000038146973};
    Tensor<float> kernel({1, 3, 3, 3});
    kernel = std::vector<float>{-0.37323111295700073, -0.71010494232177734, 1.18185126781463623, 1.02822291851043701, 0.41684621572494507, -0.57818186283111572, 0.29535207152366638, -0.70437383651733398, 0.01985891163349152, -1.85411012172698975, 0.84659403562545776, 1.38623583316802979, -2.30268073081970215, -0.26599258184432983, 0.33299556374549866, 0.99826902151107788, 0.28480342030525208, 0.56836253404617310, -0.62843734025955200, 0.75529181957244873, -0.19392366707324982, 2.35649657249450684, -0.32129156589508057, -0.33987930417060852, -1.39994597434997559, 0.02068970166146755, -0.21365424990653992};
    Tensor<float> expected_result({1, 3, 3});
    expected_result = std::vector<float>{6.18044328689575195, 3.20497608184814453, 6.28615903854370117, -5.70789194107055664, -7.50641012191772461, -2.21163082122802734, -5.91101408004760742, -2.25959610939025879, -9.70291996002197266};
    // run Temper nn::conv2d
    Tensor<float> result = nn::conv2d(input, kernel, 1, {0, 0});
    // check values
    EXPECT_NEAR(result[0][0][0], expected_result[0][0][0], 0.0001);
    EXPECT_NEAR(result[0][0][1], expected_result[0][0][1], 0.0001);
    EXPECT_NEAR(result[0][0][2], expected_result[0][0][2], 0.0001);
    EXPECT_NEAR(result[0][1][0], expected_result[0][1][0], 0.0001);
    EXPECT_NEAR(result[0][1][1], expected_result[0][1][1], 0.0001);
    EXPECT_NEAR(result[0][1][2], expected_result[0][1][2], 0.0001);
    EXPECT_NEAR(result[0][2][0], expected_result[0][2][0], 0.0001);
    EXPECT_NEAR(result[0][2][1], expected_result[0][2][1], 0.0001);
    EXPECT_NEAR(result[0][2][2], expected_result[0][2][2], 0.0001);
}

/**
  * @test CONV2D. conv2d_random_test_ic1_oc2_k3x3_s1_p0_0
  * @brief Randomly generated conv2d test (true convolution):
  *   input: (1, 5, 5), kernel: (2, 1, 3, 3)
  *   stride: 1, padding: (0, 0)
  *
  * The test is generated from the script, expecting values from PyTorch
  * with kernel flipping to match mathematical convolution.
  */
TEST(CONV2D, conv2d_random_test_ic1_oc2_k3x3_s1_p0_0)
{
    Tensor<float> input({1, 5, 5});
    input = std::vector<float>{-0.81652158498764038, -0.83747977018356323, -1.12154495716094971, 2.78928160667419434, 1.30727970600128174, -1.10670387744903564, 0.19688762724399567, 0.66669034957885742, -0.45507097244262695, -0.20072947442531586, -0.66377443075180054, 1.87833237648010254, -0.22584347426891327, 0.38269892334938049, -0.70907664299011230, 0.41878074407577515, -0.61372029781341553, 0.56702184677124023, 0.49282580614089966, -0.21248216927051544, -0.23567159473896027, 0.69667357206344604, -1.27861893177032471, -0.74902582168579102, 0.39272582530975342};
    Tensor<float> kernel({2, 1, 3, 3});
    kernel = std::vector<float>{-2.62328577041625977, -1.29067277908325195, 1.10352671146392822, 0.44924178719520569, 0.87270635366439819, 0.96757102012634277, 1.31979370117187500, 1.54106795787811279, -0.80854302644729614, 0.55628424882888794, -0.97514665126800537, 0.22875557839870453, 0.07720714062452316, -2.24707388877868652, 1.17463243007659912, 1.23880136013031006, 0.77924281358718872, 0.67329180240631104};
    Tensor<float> expected_result({2, 3, 3});
    expected_result = std::vector<float>{-5.27446556091308594, 4.55827999114990234, 8.20532703399658203, 2.74044156074523926, -0.64204680919647217, -1.16129899024963379, 5.45252895355224609, 3.14474010467529297, -0.75467032194137573, -6.39177131652832031, 1.57837438583374023, 4.00875806808471680, -3.77400255203247070, 2.41254806518554688, -1.80344772338867188, 1.20720863342285156, 0.59531843662261963, -0.53364109992980957};
    // run Temper nn::conv2d
    Tensor<float> result = nn::conv2d(input, kernel, 1, {0, 0});
    // check values
    EXPECT_NEAR(result[0][0][0], expected_result[0][0][0], 0.0001);
    EXPECT_NEAR(result[0][0][1], expected_result[0][0][1], 0.0001);
    EXPECT_NEAR(result[0][0][2], expected_result[0][0][2], 0.0001);
    EXPECT_NEAR(result[0][1][0], expected_result[0][1][0], 0.0001);
    EXPECT_NEAR(result[0][1][1], expected_result[0][1][1], 0.0001);
    EXPECT_NEAR(result[0][1][2], expected_result[0][1][2], 0.0001);
    EXPECT_NEAR(result[0][2][0], expected_result[0][2][0], 0.0001);
    EXPECT_NEAR(result[0][2][1], expected_result[0][2][1], 0.0001);
    EXPECT_NEAR(result[0][2][2], expected_result[0][2][2], 0.0001);
    EXPECT_NEAR(result[1][0][0], expected_result[1][0][0], 0.0001);
    EXPECT_NEAR(result[1][0][1], expected_result[1][0][1], 0.0001);
    EXPECT_NEAR(result[1][0][2], expected_result[1][0][2], 0.0001);
    EXPECT_NEAR(result[1][1][0], expected_result[1][1][0], 0.0001);
    EXPECT_NEAR(result[1][1][1], expected_result[1][1][1], 0.0001);
    EXPECT_NEAR(result[1][1][2], expected_result[1][1][2], 0.0001);
    EXPECT_NEAR(result[1][2][0], expected_result[1][2][0], 0.0001);
    EXPECT_NEAR(result[1][2][1], expected_result[1][2][1], 0.0001);
    EXPECT_NEAR(result[1][2][2], expected_result[1][2][2], 0.0001);
}

/**
  * @test CONV2D. conv2d_random_test_ic3_oc2_k3x3_s1_p1_1
  * @brief Randomly generated conv2d test (true convolution):
  *   input: (3, 5, 5), kernel: (2, 3, 3, 3)
  *   stride: 1, padding: (1, 1)
  *
  * The test is generated from the script, expecting values from PyTorch
  * with kernel flipping to match mathematical convolution.
  */
TEST(CONV2D, conv2d_random_test_ic3_oc2_k3x3_s1_p1_1)
{
    Tensor<float> input({3, 5, 5});
    input = std::vector<float>{-0.20399188995361328, 0.96650588512420654, 0.58635997772216797, 1.61752974987030029, 0.47260728478431702, -1.76071107387542725, 0.12656345963478088, -0.76818931102752686, 0.05099049210548401, -0.91117948293685913, -0.35690262913703918, 0.67754644155502319, -0.68710070848464966, 0.59583503007888794, 0.79745852947235107, -1.08942711353302002, 1.26967918872833252, 0.09173126518726349, 0.91501039266586304, 0.13638067245483398, -1.49096548557281494, 0.60869026184082031, 0.52383846044540405, 0.17136828601360321, 0.71994227170944214, -1.00421524047851562, 0.32885688543319702, -0.66735339164733887, 0.96715784072875977, -0.96738821268081665, -1.13025724887847900, 1.86675631999969482, -0.60484749078750610, -0.07224774360656738, -0.33762115240097046, -0.82446402311325073, 0.66331815719604492, -1.71842670440673828, -0.32086977362632751, -1.01857256889343262, 0.76857733726501465, -0.03365264460444450, 1.35137677192687988, -0.50147897005081177, -1.30121016502380371, 0.71233648061752319, -0.66383308172225952, 2.42526817321777344, -1.82447373867034912, -1.17929828166961670, -0.09310922026634216, 2.16919255256652832, 1.16828048229217529, 1.02305483818054199, 0.04965483024716377, -0.78504312038421631, -1.10270786285400391, 0.69081449508666992, -1.06500649452209473, -1.83192884922027588, 1.96864593029022217, 0.58943301439285278, -0.97081339359283447, -0.61380410194396973, -0.52267038822174072, 1.27499341964721680, 0.20259431004524231, -0.43942749500274658, 0.34863987565040588, -0.46351981163024902, 1.12563180923461914, 1.10249471664428711, 0.43696051836013794, -0.96412044763565063, -1.10188722610473633};
    Tensor<float> kernel({2, 3, 3, 3});
    kernel = std::vector<float>{-0.54205256700515747, 0.80411547422409058, -0.17036668956279755, 0.33907645940780640, 1.33981728553771973, 0.25735723972320557, -0.51252645254135132, -0.77947729825973511, 0.09166144579648972, 0.55522227287292480, 0.78634083271026611, 0.01932375133037567, -0.93293797969818115, -1.69670200347900391, 1.86774361133575439, -2.03929638862609863, -1.13983881473541260, 1.44825518131256104, -0.16475416719913483, 1.15597617626190186, -1.83541178703308105, 0.55571168661117554, 0.27215635776519775, -0.32761767506599426, 1.37672364711761475, 1.86114859580993652, 0.65303641557693481, 1.01394450664520264, -0.35713261365890503, 2.05526614189147949, 0.08719807863235474, -0.65345609188079834, 0.06362377852201462, -1.18420374393463135, 1.08072519302368164, 0.72155225276947021, -1.38745558261871338, 1.56914484500885010, 0.19303549826145172, -0.00919432472437620, 0.19002684950828552, -0.19602522253990173, 0.03235382959246635, 0.54917913675308228, -0.20027482509613037, -2.10519433021545410, 0.28256133198738098, -0.88007402420043945, -1.72192335128784180, 0.18755716085433960, -1.26079106330871582, 0.50733542442321777, 0.55574357509613037, -0.18309806287288666};
    Tensor<float> expected_result({2, 5, 5});
    expected_result = std::vector<float>{0.56902658939361572, 2.88110184669494629, 4.45423364639282227, -1.37069082260131836, 3.00440335273742676, 1.22864484786987305, -3.11554265022277832, 2.01435899734497070, -1.00346887111663818, 2.37927961349487305, -2.33336758613586426, -5.65269851684570312, 5.54302787780761719, -3.92234468460083008, -2.95513629913330078, 1.93351221084594727, 3.90293359756469727, 0.22523307800292969, -1.73119926452636719, 0.28762686252593994, 0.58136248588562012, -1.15855073928833008, -4.71022033691406250, 12.44757843017578125, -0.28259924054145813, -5.23577213287353516, -3.78297543525695801, -1.15282177925109863, -1.35649752616882324, -1.55373668670654297, -0.26009118556976318, 4.36343002319335938, 3.79159355163574219, 6.19777917861938477, 2.01310491561889648, -1.26203870773315430, -4.55101823806762695, 4.03789901733398438, 3.67361521720886230, -2.62448191642761230, 1.81850981712341309, -9.25520896911621094, 5.05475950241088867, 2.04903006553649902, -1.65824329853057861, -1.96704697608947754, -2.69484829902648926, 1.23116886615753174, 0.68294250965118408, 0.55490517616271973};
    // run Temper nn::conv2d
    Tensor<float> result = nn::conv2d(input, kernel, 1, {1, 1});
    // check values
    EXPECT_NEAR(result[0][0][0], expected_result[0][0][0], 0.0001);
    EXPECT_NEAR(result[0][0][1], expected_result[0][0][1], 0.0001);
    EXPECT_NEAR(result[0][0][2], expected_result[0][0][2], 0.0001);
    EXPECT_NEAR(result[0][0][3], expected_result[0][0][3], 0.0001);
    EXPECT_NEAR(result[0][0][4], expected_result[0][0][4], 0.0001);
    EXPECT_NEAR(result[0][1][0], expected_result[0][1][0], 0.0001);
    EXPECT_NEAR(result[0][1][1], expected_result[0][1][1], 0.0001);
    EXPECT_NEAR(result[0][1][2], expected_result[0][1][2], 0.0001);
    EXPECT_NEAR(result[0][1][3], expected_result[0][1][3], 0.0001);
    EXPECT_NEAR(result[0][1][4], expected_result[0][1][4], 0.0001);
    EXPECT_NEAR(result[0][2][0], expected_result[0][2][0], 0.0001);
    EXPECT_NEAR(result[0][2][1], expected_result[0][2][1], 0.0001);
    EXPECT_NEAR(result[0][2][2], expected_result[0][2][2], 0.0001);
    EXPECT_NEAR(result[0][2][3], expected_result[0][2][3], 0.0001);
    EXPECT_NEAR(result[0][2][4], expected_result[0][2][4], 0.0001);
    EXPECT_NEAR(result[0][3][0], expected_result[0][3][0], 0.0001);
    EXPECT_NEAR(result[0][3][1], expected_result[0][3][1], 0.0001);
    EXPECT_NEAR(result[0][3][2], expected_result[0][3][2], 0.0001);
    EXPECT_NEAR(result[0][3][3], expected_result[0][3][3], 0.0001);
    EXPECT_NEAR(result[0][3][4], expected_result[0][3][4], 0.0001);
    EXPECT_NEAR(result[0][4][0], expected_result[0][4][0], 0.0001);
    EXPECT_NEAR(result[0][4][1], expected_result[0][4][1], 0.0001);
    EXPECT_NEAR(result[0][4][2], expected_result[0][4][2], 0.0001);
    EXPECT_NEAR(result[0][4][3], expected_result[0][4][3], 0.0001);
    EXPECT_NEAR(result[0][4][4], expected_result[0][4][4], 0.0001);
    EXPECT_NEAR(result[1][0][0], expected_result[1][0][0], 0.0001);
    EXPECT_NEAR(result[1][0][1], expected_result[1][0][1], 0.0001);
    EXPECT_NEAR(result[1][0][2], expected_result[1][0][2], 0.0001);
    EXPECT_NEAR(result[1][0][3], expected_result[1][0][3], 0.0001);
    EXPECT_NEAR(result[1][0][4], expected_result[1][0][4], 0.0001);
    EXPECT_NEAR(result[1][1][0], expected_result[1][1][0], 0.0001);
    EXPECT_NEAR(result[1][1][1], expected_result[1][1][1], 0.0001);
    EXPECT_NEAR(result[1][1][2], expected_result[1][1][2], 0.0001);
    EXPECT_NEAR(result[1][1][3], expected_result[1][1][3], 0.0001);
    EXPECT_NEAR(result[1][1][4], expected_result[1][1][4], 0.0001);
    EXPECT_NEAR(result[1][2][0], expected_result[1][2][0], 0.0001);
    EXPECT_NEAR(result[1][2][1], expected_result[1][2][1], 0.0001);
    EXPECT_NEAR(result[1][2][2], expected_result[1][2][2], 0.0001);
    EXPECT_NEAR(result[1][2][3], expected_result[1][2][3], 0.0001);
    EXPECT_NEAR(result[1][2][4], expected_result[1][2][4], 0.0001);
    EXPECT_NEAR(result[1][3][0], expected_result[1][3][0], 0.0001);
    EXPECT_NEAR(result[1][3][1], expected_result[1][3][1], 0.0001);
    EXPECT_NEAR(result[1][3][2], expected_result[1][3][2], 0.0001);
    EXPECT_NEAR(result[1][3][3], expected_result[1][3][3], 0.0001);
    EXPECT_NEAR(result[1][3][4], expected_result[1][3][4], 0.0001);
    EXPECT_NEAR(result[1][4][0], expected_result[1][4][0], 0.0001);
    EXPECT_NEAR(result[1][4][1], expected_result[1][4][1], 0.0001);
    EXPECT_NEAR(result[1][4][2], expected_result[1][4][2], 0.0001);
    EXPECT_NEAR(result[1][4][3], expected_result[1][4][3], 0.0001);
    EXPECT_NEAR(result[1][4][4], expected_result[1][4][4], 0.0001);
}

/**
  * @test CONV2D. conv2d_random_test_ic1_oc1_k3x2_s1_p0_0
  * @brief Randomly generated conv2d test (true convolution):
  *   input: (1, 5, 7), kernel: (1, 1, 3, 2)
  *   stride: 1, padding: (0, 0)
  *
  * The test is generated from the script, expecting values from PyTorch
  * with kernel flipping to match mathematical convolution.
  */
TEST(CONV2D, conv2d_random_test_ic1_oc1_k3x2_s1_p0_0)
{
    Tensor<float> input({1, 5, 7});
    input = std::vector<float>{1.93390917778015137, -0.45481920242309570, -0.24360948801040649, -1.15062522888183594, 1.13091611862182617, 0.55527967214584351, 0.61461210250854492, -0.71923136711120605, -1.63617336750030518, -0.10316782444715500, 2.06189250946044922, 1.02283811569213867, -0.19271120429039001, -1.32135200500488281, 0.84720396995544434, -1.09872519969940186, -1.62005925178527832, 0.31553825736045837, -1.11432838439941406, -0.86541366577148438, 0.47060501575469971, 0.99341893196105957, 0.30752530694007874, -0.19972725212574005, 1.30241966247558594, 0.11403929442167282, 1.93175542354583740, 0.89336782693862915, 0.33546105027198792, 0.18777939677238464, 0.47826620936393738, 1.26852154731750488, 0.51901316642761230, 0.21259574592113495, -1.94120037555694580};
    Tensor<float> kernel({1, 1, 3, 2});
    kernel = std::vector<float>{1.16198992729187012, -0.64483278989791870, 1.44142532348632812, -0.81810575723648071, -1.25046193599700928, -2.69378447532653809};
    Tensor<float> expected_result({1, 3, 6});
    expected_result = std::vector<float>{-8.23382759094238281, 1.54566454887390137, 6.56283044815063477, -0.02544021606445312, -5.14241504669189453, -2.90643954277038574, 1.42334651947021484, 2.66980123519897461, 1.12198758125305176, -9.40500926971435547, -0.67897415161132812, 3.35018968582153320, -1.27583622932434082, 4.88072538375854492, 7.17586803436279297, -0.57260090112686157, 6.68746948242187500, -0.94263696670532227};
    // run Temper nn::conv2d
    Tensor<float> result = nn::conv2d(input, kernel, 1, {0, 0});
    // check values
    EXPECT_NEAR(result[0][0][0], expected_result[0][0][0], 0.0001);
    EXPECT_NEAR(result[0][0][1], expected_result[0][0][1], 0.0001);
    EXPECT_NEAR(result[0][0][2], expected_result[0][0][2], 0.0001);
    EXPECT_NEAR(result[0][0][3], expected_result[0][0][3], 0.0001);
    EXPECT_NEAR(result[0][0][4], expected_result[0][0][4], 0.0001);
    EXPECT_NEAR(result[0][0][5], expected_result[0][0][5], 0.0001);
    EXPECT_NEAR(result[0][1][0], expected_result[0][1][0], 0.0001);
    EXPECT_NEAR(result[0][1][1], expected_result[0][1][1], 0.0001);
    EXPECT_NEAR(result[0][1][2], expected_result[0][1][2], 0.0001);
    EXPECT_NEAR(result[0][1][3], expected_result[0][1][3], 0.0001);
    EXPECT_NEAR(result[0][1][4], expected_result[0][1][4], 0.0001);
    EXPECT_NEAR(result[0][1][5], expected_result[0][1][5], 0.0001);
    EXPECT_NEAR(result[0][2][0], expected_result[0][2][0], 0.0001);
    EXPECT_NEAR(result[0][2][1], expected_result[0][2][1], 0.0001);
    EXPECT_NEAR(result[0][2][2], expected_result[0][2][2], 0.0001);
    EXPECT_NEAR(result[0][2][3], expected_result[0][2][3], 0.0001);
    EXPECT_NEAR(result[0][2][4], expected_result[0][2][4], 0.0001);
    EXPECT_NEAR(result[0][2][5], expected_result[0][2][5], 0.0001);
}

/**
  * @test CONV2D. conv2d_random_test_ic2_oc2_k2x3_s1_p1_0
  * @brief Randomly generated conv2d test (true convolution):
  *   input: (2, 7, 5), kernel: (2, 2, 2, 3)
  *   stride: 1, padding: (1, 0)
  *
  * The test is generated from the script, expecting values from PyTorch
  * with kernel flipping to match mathematical convolution.
  */
TEST(CONV2D, conv2d_random_test_ic2_oc2_k2x3_s1_p1_0)
{
    Tensor<float> input({2, 7, 5});
    input = std::vector<float>{-0.84899485111236572, 0.47933936119079590, -0.93960154056549072, -0.27031955122947693, 0.05754975229501724, 1.64204800128936768, 1.69545269012451172, -1.58267080783843994, -0.82357484102249146, -0.20437316596508026, 0.66306561231613159, -0.79811954498291016, -0.48497241735458374, 0.83564633131027222, 0.98689615726470947, 0.09807275980710983, 0.17711648344993591, -0.16159501671791077, -0.66665440797805786, 1.14097678661346436, 1.16237223148345947, -1.02455031871795654, 0.21027436852455139, 0.10583801567554474, 2.92698025703430176, 0.37795162200927734, 0.92451673746109009, -0.45326033234596252, -0.99018567800521851, 1.37973988056182861, -0.70480918884277344, 1.72158193588256836, 0.75233590602874756, -0.75798243284225464, -2.42995095252990723, 0.01591395214200020, 1.15833353996276855, -0.01495231501758099, 1.00200629234313965, 0.47000849246978760, 0.69523721933364868, -1.45263087749481201, 0.80579996109008789, 0.43255349993705750, 0.98214107751846313, 0.24735955893993378, -0.83058118820190430, 1.44461143016815186, 0.82932895421981812, 0.51499629020690918, -0.10791074484586716, 2.16478776931762695, -0.54979872703552246, 1.27878725528717041, -0.69250822067260742, -0.19999441504478455, 0.05291637778282166, 1.41950488090515137, -1.14402747154235840, -0.42502129077911377, 1.09187674522399902, 0.66611373424530029, 0.42113319039344788, -1.11552798748016357, 0.52734935283660889, -0.39482927322387695, 0.55346482992172241, -0.05284279212355614, -0.85420429706573486, 0.70247936248779297};
    Tensor<float> kernel({2, 2, 2, 3});
    kernel = std::vector<float>{-1.59079158306121826, 0.14374963939189911, 0.70676845312118530, -1.03096866607666016, -0.84261274337768555, -2.29575610160827637, 0.16635017096996307, -1.16753423213958740, -0.57766461372375488, -0.27179390192031860, -0.22916631400585175, -0.09283783286809921, -0.09850849956274033, 0.05385157093405724, 0.56194329261779785, -0.81353127956390381, -0.05704586207866669, -0.48596650362014771, 1.35031998157501221, 0.33424943685531616, -0.55595511198043823, 1.13846135139465332, -0.24637830257415771, -1.67855632305145264};
    Tensor<float> expected_result({2, 8, 3});
    expected_result = std::vector<float>{-0.40050205588340759, 0.14874956011772156, -1.87754201889038086, 7.60141897201538086, 1.84472477436065674, 0.25057634711265564, -1.32478237152099609, -4.90907239913940430, 0.58752101659774780, -2.77974724769592285, 1.66662609577178955, -4.38807392120361328, 0.08519086241722107, -2.74615669250488281, -4.34478569030761719, -2.61871051788330078, 3.14794254302978516, -4.85433673858642578, -3.42224740982055664, 1.55573379993438721, 5.95867156982421875, -0.68400967121124268, -3.61190915107727051, 1.42644023895263672, -0.00058057159185410, 0.94944119453430176, 0.42966568470001221, 2.20648407936096191, 1.85034179687500000, 0.84773653745651245, 2.41407203674316406, 4.17614507675170898, 0.48607724905014038, 1.67364263534545898, 2.21409177780151367, -3.09886145591735840, 1.71851253509521484, -3.25151515007019043, -2.90220880508422852, 1.75232577323913574, -2.48441672325134277, -5.41299057006835938, -1.42943549156188965, -2.50593352317810059, 0.63636195659637451, 0.09847769141197205, -2.15138769149780273, 2.75337338447570801};
    // run Temper nn::conv2d
    Tensor<float> result = nn::conv2d(input, kernel, 1, {1, 0});
    // check values
    EXPECT_NEAR(result[0][0][0], expected_result[0][0][0], 0.0001);
    EXPECT_NEAR(result[0][0][1], expected_result[0][0][1], 0.0001);
    EXPECT_NEAR(result[0][0][2], expected_result[0][0][2], 0.0001);
    EXPECT_NEAR(result[0][1][0], expected_result[0][1][0], 0.0001);
    EXPECT_NEAR(result[0][1][1], expected_result[0][1][1], 0.0001);
    EXPECT_NEAR(result[0][1][2], expected_result[0][1][2], 0.0001);
    EXPECT_NEAR(result[0][2][0], expected_result[0][2][0], 0.0001);
    EXPECT_NEAR(result[0][2][1], expected_result[0][2][1], 0.0001);
    EXPECT_NEAR(result[0][2][2], expected_result[0][2][2], 0.0001);
    EXPECT_NEAR(result[0][3][0], expected_result[0][3][0], 0.0001);
    EXPECT_NEAR(result[0][3][1], expected_result[0][3][1], 0.0001);
    EXPECT_NEAR(result[0][3][2], expected_result[0][3][2], 0.0001);
    EXPECT_NEAR(result[0][4][0], expected_result[0][4][0], 0.0001);
    EXPECT_NEAR(result[0][4][1], expected_result[0][4][1], 0.0001);
    EXPECT_NEAR(result[0][4][2], expected_result[0][4][2], 0.0001);
    EXPECT_NEAR(result[0][5][0], expected_result[0][5][0], 0.0001);
    EXPECT_NEAR(result[0][5][1], expected_result[0][5][1], 0.0001);
    EXPECT_NEAR(result[0][5][2], expected_result[0][5][2], 0.0001);
    EXPECT_NEAR(result[0][6][0], expected_result[0][6][0], 0.0001);
    EXPECT_NEAR(result[0][6][1], expected_result[0][6][1], 0.0001);
    EXPECT_NEAR(result[0][6][2], expected_result[0][6][2], 0.0001);
    EXPECT_NEAR(result[0][7][0], expected_result[0][7][0], 0.0001);
    EXPECT_NEAR(result[0][7][1], expected_result[0][7][1], 0.0001);
    EXPECT_NEAR(result[0][7][2], expected_result[0][7][2], 0.0001);
    EXPECT_NEAR(result[1][0][0], expected_result[1][0][0], 0.0001);
    EXPECT_NEAR(result[1][0][1], expected_result[1][0][1], 0.0001);
    EXPECT_NEAR(result[1][0][2], expected_result[1][0][2], 0.0001);
    EXPECT_NEAR(result[1][1][0], expected_result[1][1][0], 0.0001);
    EXPECT_NEAR(result[1][1][1], expected_result[1][1][1], 0.0001);
    EXPECT_NEAR(result[1][1][2], expected_result[1][1][2], 0.0001);
    EXPECT_NEAR(result[1][2][0], expected_result[1][2][0], 0.0001);
    EXPECT_NEAR(result[1][2][1], expected_result[1][2][1], 0.0001);
    EXPECT_NEAR(result[1][2][2], expected_result[1][2][2], 0.0001);
    EXPECT_NEAR(result[1][3][0], expected_result[1][3][0], 0.0001);
    EXPECT_NEAR(result[1][3][1], expected_result[1][3][1], 0.0001);
    EXPECT_NEAR(result[1][3][2], expected_result[1][3][2], 0.0001);
    EXPECT_NEAR(result[1][4][0], expected_result[1][4][0], 0.0001);
    EXPECT_NEAR(result[1][4][1], expected_result[1][4][1], 0.0001);
    EXPECT_NEAR(result[1][4][2], expected_result[1][4][2], 0.0001);
    EXPECT_NEAR(result[1][5][0], expected_result[1][5][0], 0.0001);
    EXPECT_NEAR(result[1][5][1], expected_result[1][5][1], 0.0001);
    EXPECT_NEAR(result[1][5][2], expected_result[1][5][2], 0.0001);
    EXPECT_NEAR(result[1][6][0], expected_result[1][6][0], 0.0001);
    EXPECT_NEAR(result[1][6][1], expected_result[1][6][1], 0.0001);
    EXPECT_NEAR(result[1][6][2], expected_result[1][6][2], 0.0001);
    EXPECT_NEAR(result[1][7][0], expected_result[1][7][0], 0.0001);
    EXPECT_NEAR(result[1][7][1], expected_result[1][7][1], 0.0001);
    EXPECT_NEAR(result[1][7][2], expected_result[1][7][2], 0.0001);
}

/**
  * @test CONV2D. conv2d_random_test_ic1_oc1_k3x3_s1_p1_2
  * @brief Randomly generated conv2d test (true convolution):
  *   input: (1, 5, 5), kernel: (1, 1, 3, 3)
  *   stride: 1, padding: (1, 2)
  *
  * The test is generated from the script, expecting values from PyTorch
  * with kernel flipping to match mathematical convolution.
  */
TEST(CONV2D, conv2d_random_test_ic1_oc1_k3x3_s1_p1_2)
{
    Tensor<float> input({1, 5, 5});
    input = std::vector<float>{-1.45733010768890381, -1.43804419040679932, -0.17566445469856262, 0.74634373188018799, 0.63787734508514404, -0.50005686283111572, -1.60176241397857666, -0.20591682195663452, -0.12850274145603180, 0.04861872643232346, -1.03658187389373779, 1.79706287384033203, -1.45457875728607178, -0.74035811424255371, -0.39830958843231201, 0.76070803403854370, -0.13207320868968964, -0.50869226455688477, 1.57449603080749512, 1.83170926570892334, -0.31250268220901489, 2.76763844490051270, 0.09605695307254791, -3.19175720214843750, 1.57701444625854492};
    Tensor<float> kernel({1, 1, 3, 3});
    kernel = std::vector<float>{1.67373442649841309, 0.14276815950870514, 1.15133881568908691, -1.87871599197387695, 0.11511288583278656, -1.19223618507385254, 1.77495896816253662, 1.30182969570159912, -2.25965857505798340};
    Tensor<float> expected_result({1, 5, 7});
    expected_result = std::vector<float>{1.90094685554504395, -0.21839809417724609, 0.75290226936340332, -1.79654991626739502, -1.07709419727325439, -0.95739907026290894, -0.70452380180358887, -3.38219928741455078, 1.36184382438659668, -1.46362781524658203, 7.09512662887573242, 0.19305157661437988, -1.60654115676879883, -1.95793938636779785, 2.33308577537536621, -7.10199689865112305, 2.86025905609130859, 4.61484146118164062, 5.48650217056274414, 3.26478481292724609, 2.47393536567687988, -3.79209113121032715, 6.76363134384155273, 2.32962298393249512, -12.26954364776611328, 1.25692903995513916, -3.96153903007507324, 0.53189170360565186, 1.93732929229736328, -4.47969150543212891, -2.28308105468750000, 5.13865947723388672, 3.00570774078369141, 2.81361317634582520, -6.01921129226684570};
    // run Temper nn::conv2d
    Tensor<float> result = nn::conv2d(input, kernel, 1, {1, 2});
    // check values
    EXPECT_NEAR(result[0][0][0], expected_result[0][0][0], 0.0001);
    EXPECT_NEAR(result[0][0][1], expected_result[0][0][1], 0.0001);
    EXPECT_NEAR(result[0][0][2], expected_result[0][0][2], 0.0001);
    EXPECT_NEAR(result[0][0][3], expected_result[0][0][3], 0.0001);
    EXPECT_NEAR(result[0][0][4], expected_result[0][0][4], 0.0001);
    EXPECT_NEAR(result[0][0][5], expected_result[0][0][5], 0.0001);
    EXPECT_NEAR(result[0][0][6], expected_result[0][0][6], 0.0001);
    EXPECT_NEAR(result[0][1][0], expected_result[0][1][0], 0.0001);
    EXPECT_NEAR(result[0][1][1], expected_result[0][1][1], 0.0001);
    EXPECT_NEAR(result[0][1][2], expected_result[0][1][2], 0.0001);
    EXPECT_NEAR(result[0][1][3], expected_result[0][1][3], 0.0001);
    EXPECT_NEAR(result[0][1][4], expected_result[0][1][4], 0.0001);
    EXPECT_NEAR(result[0][1][5], expected_result[0][1][5], 0.0001);
    EXPECT_NEAR(result[0][1][6], expected_result[0][1][6], 0.0001);
    EXPECT_NEAR(result[0][2][0], expected_result[0][2][0], 0.0001);
    EXPECT_NEAR(result[0][2][1], expected_result[0][2][1], 0.0001);
    EXPECT_NEAR(result[0][2][2], expected_result[0][2][2], 0.0001);
    EXPECT_NEAR(result[0][2][3], expected_result[0][2][3], 0.0001);
    EXPECT_NEAR(result[0][2][4], expected_result[0][2][4], 0.0001);
    EXPECT_NEAR(result[0][2][5], expected_result[0][2][5], 0.0001);
    EXPECT_NEAR(result[0][2][6], expected_result[0][2][6], 0.0001);
    EXPECT_NEAR(result[0][3][0], expected_result[0][3][0], 0.0001);
    EXPECT_NEAR(result[0][3][1], expected_result[0][3][1], 0.0001);
    EXPECT_NEAR(result[0][3][2], expected_result[0][3][2], 0.0001);
    EXPECT_NEAR(result[0][3][3], expected_result[0][3][3], 0.0001);
    EXPECT_NEAR(result[0][3][4], expected_result[0][3][4], 0.0001);
    EXPECT_NEAR(result[0][3][5], expected_result[0][3][5], 0.0001);
    EXPECT_NEAR(result[0][3][6], expected_result[0][3][6], 0.0001);
    EXPECT_NEAR(result[0][4][0], expected_result[0][4][0], 0.0001);
    EXPECT_NEAR(result[0][4][1], expected_result[0][4][1], 0.0001);
    EXPECT_NEAR(result[0][4][2], expected_result[0][4][2], 0.0001);
    EXPECT_NEAR(result[0][4][3], expected_result[0][4][3], 0.0001);
    EXPECT_NEAR(result[0][4][4], expected_result[0][4][4], 0.0001);
    EXPECT_NEAR(result[0][4][5], expected_result[0][4][5], 0.0001);
    EXPECT_NEAR(result[0][4][6], expected_result[0][4][6], 0.0001);
}

/**
  * @test CONV2D. conv2d_random_test_ic3_oc4_k1x1_s1_p0_0
  * @brief Randomly generated conv2d test (true convolution):
  *   input: (3, 8, 8), kernel: (4, 3, 1, 1)
  *   stride: 1, padding: (0, 0)
  *
  * The test is generated from the script, expecting values from PyTorch
  * with kernel flipping to match mathematical convolution.
  */
TEST(CONV2D, conv2d_random_test_ic3_oc4_k1x1_s1_p0_0)
{
    Tensor<float> input({3, 8, 8});
    input = std::vector<float>{-0.60679888725280762, 0.22743190824985504, -1.91705095767974854, -0.87830710411071777, -0.94829905033111572, 1.10603809356689453, -0.76899975538253784, -0.55078345537185669, -1.13236927986145020, -0.23924766480922699, 0.21734797954559326, 0.53576940298080444, 0.14699281752109528, 1.18928086757659912, 1.37021851539611816, -0.20537842810153961, 0.68031477928161621, 1.26938545703887939, 1.40024483203887939, 0.03938252478837967, -0.18529094755649567, 0.69419920444488525, -0.70524770021438599, -1.53948986530303955, 2.03333592414855957, 1.74411344528198242, 0.59842318296432495, 0.69275277853012085, -0.90568339824676514, -0.25771486759185791, 0.52954542636871338, -2.00274062156677246, 1.80419659614562988, -2.08184361457824707, 0.83672845363616943, 1.20234453678131104, -0.38306877017021179, -2.07256388664245605, -0.27116668224334717, 1.89041483402252197, -0.75757730007171631, 0.70382136106491089, 0.06030793860554695, 2.13128185272216797, -0.76764589548110962, -1.24928569793701172, 0.09872779995203018, 2.15588259696960449, -0.34980773925781250, 1.00629889965057373, 1.53043699264526367, -0.65101641416549683, -1.45977079868316650, 2.44998598098754883, 0.76285338401794434, -0.67337971925735474, 0.03306027501821518, -0.96687817573547363, -0.28888294100761414, 0.14980621635913849, 0.77270621061325073, 0.26618665456771851, -1.19815599918365479, 0.56530809402465820, 2.36888694763183594, 1.82993412017822266, -2.41750907897949219, 1.25762355327606201, 1.02368831634521484, -0.32145270705223083, 0.96542561054229736, 0.66398000717163086, -0.20892147719860077, -2.07823514938354492, -2.19537854194641113, 0.16469182074069977, 0.66140323877334595, -0.58538764715194702, 0.70492655038833618, 0.25120750069618225, 1.49469161033630371, 0.48549330234527588, -0.41592660546302795, -0.93910253047943115, 0.03632668033242226, 0.86860054731369019, 0.99305337667465210, 0.35022452473640442, -0.20615993440151215, -0.35586673021316528, 0.70121538639068604, -0.50883907079696655, -1.31286501884460449, 0.54947179555892944, 1.19161820411682129, 0.00920434109866619, -1.04152882099151611, -0.57599723339080811, -0.47395199537277222, 0.03810707107186317, 0.84499412775039673, 1.14708149433135986, 1.55689013004302979, -2.46313881874084473, -1.90665674209594727, 0.84272456169128418, 0.66895890235900879, -1.39319765567779541, -1.37314426898956299, 1.01078295707702637, -0.19338469207286835, -0.23408448696136475, -1.24028599262237549, 0.32163083553314209, 1.85240471363067627, -0.66335451602935791, -0.41233423352241516, -1.60217642784118652, 0.38899916410446167, -0.72972303628921509, 1.59653317928314209, 1.17169868946075439, -0.23359245061874390, -1.15037453174591064, 1.06213045120239258, -1.51624035835266113, -0.52749568223953247, 0.06903213262557983, -0.06260865926742554, -0.91609418392181396, 1.06584215164184570, -0.35890170931816101, -0.76510423421859741, -0.46813356876373291, -1.60068511962890625, -0.89080214500427246, -0.13547059893608093, -0.07630273699760437, 0.37853220105171204, 1.70957207679748535, -0.70547664165496826, -0.38473519682884216, 1.15949344635009766, 0.45725306868553162, -0.78283232450485229, -1.63600909709930420, 1.45347750186920166, -1.09974408149719238, -0.46455037593841553, -0.87124449014663696, 0.86830651760101318, -0.27175995707511902, 0.26015612483024597, -1.70919740200042725, 0.21726149320602417, -0.01495384797453880, -0.30622518062591553, -1.01628375053405762, 0.38209602236747742, -0.94009691476821899, -1.12874519824981689, -0.66912066936492920, 0.66552847623825073, -0.11853351444005966, -0.84190636873245239, 1.39648973941802979, 0.19649331271648407, -0.31789240241050720, 1.42648255825042725, -1.85583186149597168, -1.29785394668579102, 1.26233875751495361, -0.18989108502864838, 1.34414124488830566, -0.09856824576854706, 0.04223719239234924, 1.65581536293029785, -0.60808598995208740, 0.76075601577758789, 0.02962519973516464, -1.68644642829895020, -0.08367844671010971, 0.59263539314270020, 0.18510223925113678, 1.17442119121551514, 0.68040013313293457, 0.58852118253707886, -0.50470191240310669, -0.85269480943679810, 0.27931460738182068, -1.02497863769531250, 0.99413657188415527};
    Tensor<float> kernel({4, 3, 1, 1});
    kernel = std::vector<float>{-0.13979892432689667, -1.77591812610626221, 0.68104261159896851, 0.63342130184173584, -0.12718589603900909, 1.74943304061889648, 0.33418190479278564, 0.91040885448455811, 0.75664317607879639, -0.81192034482955933, 0.74198019504547119, -0.11368834972381592};
    Tensor<float> expected_result({4, 8, 8});
    expected_result = std::vector<float>{-4.16475868225097656, -3.90550708770751953, 5.28718376159667969, -2.35507750511169434, -2.20648407936096191, 0.09743182361125946, -2.69714641571044922, -1.70884943008422852, 0.43707019090652466, 3.67225646972656250, 4.12622404098510742, 0.79691225290298462, -1.67560708522796631, 0.61131930351257324, -0.65378242731094360, -0.10600345581769943, -3.28269934654235840, -2.15384697914123535, 1.53277897834777832, 0.91329091787338257, -0.35498833656311035, -2.23296642303466797, -1.07363486289978027, -0.59183114767074585, 0.25904238224029541, -0.77587127685546875, -1.18099570274353027, 0.79662621021270752, 2.24960207939147949, -1.63192117214202881, -1.93002271652221680, -0.37661123275756836, 0.82872152328491211, 0.85826373100280762, 1.17797946929931641, -0.31648787856101990, -2.02046179771423340, -0.79631161689758301, -2.59318017959594727, 3.89355659484863281, 4.46347045898437500, -2.85890388488769531, -2.08034110069274902, 3.03596043586730957, 2.41658401489257812, -0.70500153303146362, 0.26250416040420532, 0.14309012889862061, 3.37922978401184082, -1.12600195407867432, -2.98556542396545410, 1.28925073146820068, -0.21219564974308014, 2.44584035873413086, -0.39386680722236633, 1.51612865924835205, -2.04010319709777832, -1.48229086399078369, 0.85603457689285278, 1.67830467224121094, -2.57500171661376953, 2.84573125839233398, 0.40623587369918823, 0.47542446851730347, -0.79517799615859985, -1.69132697582244873, 0.95779168605804443, -1.34416496753692627, -2.06937026977539062, -0.07749596983194351, -3.41018080711364746, -1.99172556400299072, -0.92769169807434082, -0.02070890180766582, 1.07911074161529541, 3.30920314788818359, -1.22519695758819580, 0.15470039844512939, 2.80672502517700195, 0.63789248466491699, -1.12869060039520264, -2.11978054046630859, 3.48260641098022461, -1.77954232692718506, -0.93468725681304932, -1.19493710994720459, 0.94602280855178833, -1.49511516094207764, 1.76930463314056396, -1.84010648727416992, 0.66995370388031006, 0.47736075520515442, -0.94242167472839355, -2.01104760169982910, 0.85231971740722656, -2.91438579559326172, -0.69937986135482788, -2.41600704193115234, 1.75457918643951416, 0.54937750101089478, -1.82297408580780029, 0.98436653614044189, -0.02602530829608440, 0.95457410812377930, 2.25816988945007324, -2.90802073478698730, -2.31739044189453125, 3.73557162284851074, -0.64380037784576416, 1.43160355091094971, -0.08530645072460175, 1.46924543380737305, 2.83290934562683105, -0.46730145812034607, 2.06470322608947754, -0.27617102861404419, -3.82253193855285645, 1.60925769805908203, 1.47050833702087402, -0.00989861786365509, 1.87245583534240723, 0.42884969711303711, 0.87630343437194824, -0.64174032211303711, -1.13737189769744873, 0.85009485483169556, -2.48497891426086426, 2.08847355842590332, 1.90650200843811035, 1.04883551597595215, -2.03510308265686035, 0.57987672090530396, 0.03615962341427803, -0.27724555134773254, -0.58920127153396606, -0.25358796119689941, -0.67112416028976440, -2.02972984313964844, -1.63964450359344482, 1.62251734733581543, 0.11747564375400543, -0.42661321163177490, 1.97699642181396484, 0.50604522228240967, 0.99580466747283936, -0.37167206406593323, 1.18903708457946777, -1.67392015457153320, -0.38034760951995850, 0.36354920268058777, 1.32540178298950195, -0.40124750137329102, 0.68865960836410522, -1.03438556194305420, 1.00276434421539307, -0.24306087195873260, -1.72961008548736572, -0.35484382510185242, 1.55093455314636230, -1.37221789360046387, -1.19934463500976562, -1.72639298439025879, 0.35169699788093567, 0.34680721163749695, 0.00425275648012757, 1.40834426879882812, 1.47546291351318359, -1.85125207901000977, -0.90966749191284180, -0.40177422761917114, -0.35283237695693970, 0.39899629354476929, -1.65033578872680664, 1.51977241039276123, -0.21764709055423737, 0.53930282592773438, 0.00679458631202579, 0.16899830102920532, 2.77351093292236328, -0.79906600713729858, -2.13926005363464355, -0.70320940017700195, 1.05749356746673584, -0.74932128190994263, 2.35316395759582520, 1.25843179225921631, 0.13609643280506134, -1.37912786006927490, 0.58001172542572021, -1.08010244369506836, -1.65618181228637695, 1.00396978855133057, 2.25745749473571777, 1.27726745605468750, -0.35842502117156982, 1.68705010414123535, 1.61648321151733398, -1.08330500125885010, 1.52267253398895264, 1.04112613201141357, 0.77977949380874634, -1.33908450603485107, -1.84843134880065918, -0.50716245174407959, 0.45160612463951111, -1.35620748996734619, -0.72128766775131226, 0.30115756392478943, 0.64566904306411743, -0.48441833257675171, -1.61074006557464600, -0.60374289751052856, 0.23020912706851959, 0.17990028858184814, 1.21071445941925049, 1.54069876670837402, -1.83345019817352295, -1.48581147193908691, 0.00971585977822542, -0.93830847740173340, -0.20396280288696289, 0.73248076438903809, 0.41076853871345520, 1.73977327346801758, -2.10933232307434082, 1.33898389339447021, -1.10668277740478516, -0.93445736169815063, 1.03370523452758789, 2.37510395050048828, 1.35300838947296143, -3.32632565498352051, -0.96178358793258667, 0.26482450962066650, 0.59493988752365112, -2.90766930580139160, -0.37399014830589294, 1.61148822307586670, -0.21244066953659058, -1.92889285087585449, -0.82449853420257568, -0.50925856828689575, 0.04536558687686920, 0.03300950303673744, 1.07100307941436768, -3.16846323013305664, -0.39812225103378296, -0.01575331203639507, 1.02423572540283203, 1.57705163955688477, -0.00567903369665146, -0.91780710220336914, 0.25764530897140503, -1.37289750576019287, 0.69794404506683350, -0.52078640460968018};
    // run Temper nn::conv2d
    Tensor<float> result = nn::conv2d(input, kernel, 1, {0, 0});
    // check values
    EXPECT_NEAR(result[0][0][0], expected_result[0][0][0], 0.0001);
    EXPECT_NEAR(result[0][0][1], expected_result[0][0][1], 0.0001);
    EXPECT_NEAR(result[0][0][2], expected_result[0][0][2], 0.0001);
    EXPECT_NEAR(result[0][0][3], expected_result[0][0][3], 0.0001);
    EXPECT_NEAR(result[0][0][4], expected_result[0][0][4], 0.0001);
    EXPECT_NEAR(result[0][0][5], expected_result[0][0][5], 0.0001);
    EXPECT_NEAR(result[0][0][6], expected_result[0][0][6], 0.0001);
    EXPECT_NEAR(result[0][0][7], expected_result[0][0][7], 0.0001);
    EXPECT_NEAR(result[0][1][0], expected_result[0][1][0], 0.0001);
    EXPECT_NEAR(result[0][1][1], expected_result[0][1][1], 0.0001);
    EXPECT_NEAR(result[0][1][2], expected_result[0][1][2], 0.0001);
    EXPECT_NEAR(result[0][1][3], expected_result[0][1][3], 0.0001);
    EXPECT_NEAR(result[0][1][4], expected_result[0][1][4], 0.0001);
    EXPECT_NEAR(result[0][1][5], expected_result[0][1][5], 0.0001);
    EXPECT_NEAR(result[0][1][6], expected_result[0][1][6], 0.0001);
    EXPECT_NEAR(result[0][1][7], expected_result[0][1][7], 0.0001);
    EXPECT_NEAR(result[0][2][0], expected_result[0][2][0], 0.0001);
    EXPECT_NEAR(result[0][2][1], expected_result[0][2][1], 0.0001);
    EXPECT_NEAR(result[0][2][2], expected_result[0][2][2], 0.0001);
    EXPECT_NEAR(result[0][2][3], expected_result[0][2][3], 0.0001);
    EXPECT_NEAR(result[0][2][4], expected_result[0][2][4], 0.0001);
    EXPECT_NEAR(result[0][2][5], expected_result[0][2][5], 0.0001);
    EXPECT_NEAR(result[0][2][6], expected_result[0][2][6], 0.0001);
    EXPECT_NEAR(result[0][2][7], expected_result[0][2][7], 0.0001);
    EXPECT_NEAR(result[0][3][0], expected_result[0][3][0], 0.0001);
    EXPECT_NEAR(result[0][3][1], expected_result[0][3][1], 0.0001);
    EXPECT_NEAR(result[0][3][2], expected_result[0][3][2], 0.0001);
    EXPECT_NEAR(result[0][3][3], expected_result[0][3][3], 0.0001);
    EXPECT_NEAR(result[0][3][4], expected_result[0][3][4], 0.0001);
    EXPECT_NEAR(result[0][3][5], expected_result[0][3][5], 0.0001);
    EXPECT_NEAR(result[0][3][6], expected_result[0][3][6], 0.0001);
    EXPECT_NEAR(result[0][3][7], expected_result[0][3][7], 0.0001);
    EXPECT_NEAR(result[0][4][0], expected_result[0][4][0], 0.0001);
    EXPECT_NEAR(result[0][4][1], expected_result[0][4][1], 0.0001);
    EXPECT_NEAR(result[0][4][2], expected_result[0][4][2], 0.0001);
    EXPECT_NEAR(result[0][4][3], expected_result[0][4][3], 0.0001);
    EXPECT_NEAR(result[0][4][4], expected_result[0][4][4], 0.0001);
    EXPECT_NEAR(result[0][4][5], expected_result[0][4][5], 0.0001);
    EXPECT_NEAR(result[0][4][6], expected_result[0][4][6], 0.0001);
    EXPECT_NEAR(result[0][4][7], expected_result[0][4][7], 0.0001);
    EXPECT_NEAR(result[0][5][0], expected_result[0][5][0], 0.0001);
    EXPECT_NEAR(result[0][5][1], expected_result[0][5][1], 0.0001);
    EXPECT_NEAR(result[0][5][2], expected_result[0][5][2], 0.0001);
    EXPECT_NEAR(result[0][5][3], expected_result[0][5][3], 0.0001);
    EXPECT_NEAR(result[0][5][4], expected_result[0][5][4], 0.0001);
    EXPECT_NEAR(result[0][5][5], expected_result[0][5][5], 0.0001);
    EXPECT_NEAR(result[0][5][6], expected_result[0][5][6], 0.0001);
    EXPECT_NEAR(result[0][5][7], expected_result[0][5][7], 0.0001);
    EXPECT_NEAR(result[0][6][0], expected_result[0][6][0], 0.0001);
    EXPECT_NEAR(result[0][6][1], expected_result[0][6][1], 0.0001);
    EXPECT_NEAR(result[0][6][2], expected_result[0][6][2], 0.0001);
    EXPECT_NEAR(result[0][6][3], expected_result[0][6][3], 0.0001);
    EXPECT_NEAR(result[0][6][4], expected_result[0][6][4], 0.0001);
    EXPECT_NEAR(result[0][6][5], expected_result[0][6][5], 0.0001);
    EXPECT_NEAR(result[0][6][6], expected_result[0][6][6], 0.0001);
    EXPECT_NEAR(result[0][6][7], expected_result[0][6][7], 0.0001);
    EXPECT_NEAR(result[0][7][0], expected_result[0][7][0], 0.0001);
    EXPECT_NEAR(result[0][7][1], expected_result[0][7][1], 0.0001);
    EXPECT_NEAR(result[0][7][2], expected_result[0][7][2], 0.0001);
    EXPECT_NEAR(result[0][7][3], expected_result[0][7][3], 0.0001);
    EXPECT_NEAR(result[0][7][4], expected_result[0][7][4], 0.0001);
    EXPECT_NEAR(result[0][7][5], expected_result[0][7][5], 0.0001);
    EXPECT_NEAR(result[0][7][6], expected_result[0][7][6], 0.0001);
    EXPECT_NEAR(result[0][7][7], expected_result[0][7][7], 0.0001);
    EXPECT_NEAR(result[1][0][0], expected_result[1][0][0], 0.0001);
    EXPECT_NEAR(result[1][0][1], expected_result[1][0][1], 0.0001);
    EXPECT_NEAR(result[1][0][2], expected_result[1][0][2], 0.0001);
    EXPECT_NEAR(result[1][0][3], expected_result[1][0][3], 0.0001);
    EXPECT_NEAR(result[1][0][4], expected_result[1][0][4], 0.0001);
    EXPECT_NEAR(result[1][0][5], expected_result[1][0][5], 0.0001);
    EXPECT_NEAR(result[1][0][6], expected_result[1][0][6], 0.0001);
    EXPECT_NEAR(result[1][0][7], expected_result[1][0][7], 0.0001);
    EXPECT_NEAR(result[1][1][0], expected_result[1][1][0], 0.0001);
    EXPECT_NEAR(result[1][1][1], expected_result[1][1][1], 0.0001);
    EXPECT_NEAR(result[1][1][2], expected_result[1][1][2], 0.0001);
    EXPECT_NEAR(result[1][1][3], expected_result[1][1][3], 0.0001);
    EXPECT_NEAR(result[1][1][4], expected_result[1][1][4], 0.0001);
    EXPECT_NEAR(result[1][1][5], expected_result[1][1][5], 0.0001);
    EXPECT_NEAR(result[1][1][6], expected_result[1][1][6], 0.0001);
    EXPECT_NEAR(result[1][1][7], expected_result[1][1][7], 0.0001);
    EXPECT_NEAR(result[1][2][0], expected_result[1][2][0], 0.0001);
    EXPECT_NEAR(result[1][2][1], expected_result[1][2][1], 0.0001);
    EXPECT_NEAR(result[1][2][2], expected_result[1][2][2], 0.0001);
    EXPECT_NEAR(result[1][2][3], expected_result[1][2][3], 0.0001);
    EXPECT_NEAR(result[1][2][4], expected_result[1][2][4], 0.0001);
    EXPECT_NEAR(result[1][2][5], expected_result[1][2][5], 0.0001);
    EXPECT_NEAR(result[1][2][6], expected_result[1][2][6], 0.0001);
    EXPECT_NEAR(result[1][2][7], expected_result[1][2][7], 0.0001);
    EXPECT_NEAR(result[1][3][0], expected_result[1][3][0], 0.0001);
    EXPECT_NEAR(result[1][3][1], expected_result[1][3][1], 0.0001);
    EXPECT_NEAR(result[1][3][2], expected_result[1][3][2], 0.0001);
    EXPECT_NEAR(result[1][3][3], expected_result[1][3][3], 0.0001);
    EXPECT_NEAR(result[1][3][4], expected_result[1][3][4], 0.0001);
    EXPECT_NEAR(result[1][3][5], expected_result[1][3][5], 0.0001);
    EXPECT_NEAR(result[1][3][6], expected_result[1][3][6], 0.0001);
    EXPECT_NEAR(result[1][3][7], expected_result[1][3][7], 0.0001);
    EXPECT_NEAR(result[1][4][0], expected_result[1][4][0], 0.0001);
    EXPECT_NEAR(result[1][4][1], expected_result[1][4][1], 0.0001);
    EXPECT_NEAR(result[1][4][2], expected_result[1][4][2], 0.0001);
    EXPECT_NEAR(result[1][4][3], expected_result[1][4][3], 0.0001);
    EXPECT_NEAR(result[1][4][4], expected_result[1][4][4], 0.0001);
    EXPECT_NEAR(result[1][4][5], expected_result[1][4][5], 0.0001);
    EXPECT_NEAR(result[1][4][6], expected_result[1][4][6], 0.0001);
    EXPECT_NEAR(result[1][4][7], expected_result[1][4][7], 0.0001);
    EXPECT_NEAR(result[1][5][0], expected_result[1][5][0], 0.0001);
    EXPECT_NEAR(result[1][5][1], expected_result[1][5][1], 0.0001);
    EXPECT_NEAR(result[1][5][2], expected_result[1][5][2], 0.0001);
    EXPECT_NEAR(result[1][5][3], expected_result[1][5][3], 0.0001);
    EXPECT_NEAR(result[1][5][4], expected_result[1][5][4], 0.0001);
    EXPECT_NEAR(result[1][5][5], expected_result[1][5][5], 0.0001);
    EXPECT_NEAR(result[1][5][6], expected_result[1][5][6], 0.0001);
    EXPECT_NEAR(result[1][5][7], expected_result[1][5][7], 0.0001);
    EXPECT_NEAR(result[1][6][0], expected_result[1][6][0], 0.0001);
    EXPECT_NEAR(result[1][6][1], expected_result[1][6][1], 0.0001);
    EXPECT_NEAR(result[1][6][2], expected_result[1][6][2], 0.0001);
    EXPECT_NEAR(result[1][6][3], expected_result[1][6][3], 0.0001);
    EXPECT_NEAR(result[1][6][4], expected_result[1][6][4], 0.0001);
    EXPECT_NEAR(result[1][6][5], expected_result[1][6][5], 0.0001);
    EXPECT_NEAR(result[1][6][6], expected_result[1][6][6], 0.0001);
    EXPECT_NEAR(result[1][6][7], expected_result[1][6][7], 0.0001);
    EXPECT_NEAR(result[1][7][0], expected_result[1][7][0], 0.0001);
    EXPECT_NEAR(result[1][7][1], expected_result[1][7][1], 0.0001);
    EXPECT_NEAR(result[1][7][2], expected_result[1][7][2], 0.0001);
    EXPECT_NEAR(result[1][7][3], expected_result[1][7][3], 0.0001);
    EXPECT_NEAR(result[1][7][4], expected_result[1][7][4], 0.0001);
    EXPECT_NEAR(result[1][7][5], expected_result[1][7][5], 0.0001);
    EXPECT_NEAR(result[1][7][6], expected_result[1][7][6], 0.0001);
    EXPECT_NEAR(result[1][7][7], expected_result[1][7][7], 0.0001);
    EXPECT_NEAR(result[2][0][0], expected_result[2][0][0], 0.0001);
    EXPECT_NEAR(result[2][0][1], expected_result[2][0][1], 0.0001);
    EXPECT_NEAR(result[2][0][2], expected_result[2][0][2], 0.0001);
    EXPECT_NEAR(result[2][0][3], expected_result[2][0][3], 0.0001);
    EXPECT_NEAR(result[2][0][4], expected_result[2][0][4], 0.0001);
    EXPECT_NEAR(result[2][0][5], expected_result[2][0][5], 0.0001);
    EXPECT_NEAR(result[2][0][6], expected_result[2][0][6], 0.0001);
    EXPECT_NEAR(result[2][0][7], expected_result[2][0][7], 0.0001);
    EXPECT_NEAR(result[2][1][0], expected_result[2][1][0], 0.0001);
    EXPECT_NEAR(result[2][1][1], expected_result[2][1][1], 0.0001);
    EXPECT_NEAR(result[2][1][2], expected_result[2][1][2], 0.0001);
    EXPECT_NEAR(result[2][1][3], expected_result[2][1][3], 0.0001);
    EXPECT_NEAR(result[2][1][4], expected_result[2][1][4], 0.0001);
    EXPECT_NEAR(result[2][1][5], expected_result[2][1][5], 0.0001);
    EXPECT_NEAR(result[2][1][6], expected_result[2][1][6], 0.0001);
    EXPECT_NEAR(result[2][1][7], expected_result[2][1][7], 0.0001);
    EXPECT_NEAR(result[2][2][0], expected_result[2][2][0], 0.0001);
    EXPECT_NEAR(result[2][2][1], expected_result[2][2][1], 0.0001);
    EXPECT_NEAR(result[2][2][2], expected_result[2][2][2], 0.0001);
    EXPECT_NEAR(result[2][2][3], expected_result[2][2][3], 0.0001);
    EXPECT_NEAR(result[2][2][4], expected_result[2][2][4], 0.0001);
    EXPECT_NEAR(result[2][2][5], expected_result[2][2][5], 0.0001);
    EXPECT_NEAR(result[2][2][6], expected_result[2][2][6], 0.0001);
    EXPECT_NEAR(result[2][2][7], expected_result[2][2][7], 0.0001);
    EXPECT_NEAR(result[2][3][0], expected_result[2][3][0], 0.0001);
    EXPECT_NEAR(result[2][3][1], expected_result[2][3][1], 0.0001);
    EXPECT_NEAR(result[2][3][2], expected_result[2][3][2], 0.0001);
    EXPECT_NEAR(result[2][3][3], expected_result[2][3][3], 0.0001);
    EXPECT_NEAR(result[2][3][4], expected_result[2][3][4], 0.0001);
    EXPECT_NEAR(result[2][3][5], expected_result[2][3][5], 0.0001);
    EXPECT_NEAR(result[2][3][6], expected_result[2][3][6], 0.0001);
    EXPECT_NEAR(result[2][3][7], expected_result[2][3][7], 0.0001);
    EXPECT_NEAR(result[2][4][0], expected_result[2][4][0], 0.0001);
    EXPECT_NEAR(result[2][4][1], expected_result[2][4][1], 0.0001);
    EXPECT_NEAR(result[2][4][2], expected_result[2][4][2], 0.0001);
    EXPECT_NEAR(result[2][4][3], expected_result[2][4][3], 0.0001);
    EXPECT_NEAR(result[2][4][4], expected_result[2][4][4], 0.0001);
    EXPECT_NEAR(result[2][4][5], expected_result[2][4][5], 0.0001);
    EXPECT_NEAR(result[2][4][6], expected_result[2][4][6], 0.0001);
    EXPECT_NEAR(result[2][4][7], expected_result[2][4][7], 0.0001);
    EXPECT_NEAR(result[2][5][0], expected_result[2][5][0], 0.0001);
    EXPECT_NEAR(result[2][5][1], expected_result[2][5][1], 0.0001);
    EXPECT_NEAR(result[2][5][2], expected_result[2][5][2], 0.0001);
    EXPECT_NEAR(result[2][5][3], expected_result[2][5][3], 0.0001);
    EXPECT_NEAR(result[2][5][4], expected_result[2][5][4], 0.0001);
    EXPECT_NEAR(result[2][5][5], expected_result[2][5][5], 0.0001);
    EXPECT_NEAR(result[2][5][6], expected_result[2][5][6], 0.0001);
    EXPECT_NEAR(result[2][5][7], expected_result[2][5][7], 0.0001);
    EXPECT_NEAR(result[2][6][0], expected_result[2][6][0], 0.0001);
    EXPECT_NEAR(result[2][6][1], expected_result[2][6][1], 0.0001);
    EXPECT_NEAR(result[2][6][2], expected_result[2][6][2], 0.0001);
    EXPECT_NEAR(result[2][6][3], expected_result[2][6][3], 0.0001);
    EXPECT_NEAR(result[2][6][4], expected_result[2][6][4], 0.0001);
    EXPECT_NEAR(result[2][6][5], expected_result[2][6][5], 0.0001);
    EXPECT_NEAR(result[2][6][6], expected_result[2][6][6], 0.0001);
    EXPECT_NEAR(result[2][6][7], expected_result[2][6][7], 0.0001);
    EXPECT_NEAR(result[2][7][0], expected_result[2][7][0], 0.0001);
    EXPECT_NEAR(result[2][7][1], expected_result[2][7][1], 0.0001);
    EXPECT_NEAR(result[2][7][2], expected_result[2][7][2], 0.0001);
    EXPECT_NEAR(result[2][7][3], expected_result[2][7][3], 0.0001);
    EXPECT_NEAR(result[2][7][4], expected_result[2][7][4], 0.0001);
    EXPECT_NEAR(result[2][7][5], expected_result[2][7][5], 0.0001);
    EXPECT_NEAR(result[2][7][6], expected_result[2][7][6], 0.0001);
    EXPECT_NEAR(result[2][7][7], expected_result[2][7][7], 0.0001);
    EXPECT_NEAR(result[3][0][0], expected_result[3][0][0], 0.0001);
    EXPECT_NEAR(result[3][0][1], expected_result[3][0][1], 0.0001);
    EXPECT_NEAR(result[3][0][2], expected_result[3][0][2], 0.0001);
    EXPECT_NEAR(result[3][0][3], expected_result[3][0][3], 0.0001);
    EXPECT_NEAR(result[3][0][4], expected_result[3][0][4], 0.0001);
    EXPECT_NEAR(result[3][0][5], expected_result[3][0][5], 0.0001);
    EXPECT_NEAR(result[3][0][6], expected_result[3][0][6], 0.0001);
    EXPECT_NEAR(result[3][0][7], expected_result[3][0][7], 0.0001);
    EXPECT_NEAR(result[3][1][0], expected_result[3][1][0], 0.0001);
    EXPECT_NEAR(result[3][1][1], expected_result[3][1][1], 0.0001);
    EXPECT_NEAR(result[3][1][2], expected_result[3][1][2], 0.0001);
    EXPECT_NEAR(result[3][1][3], expected_result[3][1][3], 0.0001);
    EXPECT_NEAR(result[3][1][4], expected_result[3][1][4], 0.0001);
    EXPECT_NEAR(result[3][1][5], expected_result[3][1][5], 0.0001);
    EXPECT_NEAR(result[3][1][6], expected_result[3][1][6], 0.0001);
    EXPECT_NEAR(result[3][1][7], expected_result[3][1][7], 0.0001);
    EXPECT_NEAR(result[3][2][0], expected_result[3][2][0], 0.0001);
    EXPECT_NEAR(result[3][2][1], expected_result[3][2][1], 0.0001);
    EXPECT_NEAR(result[3][2][2], expected_result[3][2][2], 0.0001);
    EXPECT_NEAR(result[3][2][3], expected_result[3][2][3], 0.0001);
    EXPECT_NEAR(result[3][2][4], expected_result[3][2][4], 0.0001);
    EXPECT_NEAR(result[3][2][5], expected_result[3][2][5], 0.0001);
    EXPECT_NEAR(result[3][2][6], expected_result[3][2][6], 0.0001);
    EXPECT_NEAR(result[3][2][7], expected_result[3][2][7], 0.0001);
    EXPECT_NEAR(result[3][3][0], expected_result[3][3][0], 0.0001);
    EXPECT_NEAR(result[3][3][1], expected_result[3][3][1], 0.0001);
    EXPECT_NEAR(result[3][3][2], expected_result[3][3][2], 0.0001);
    EXPECT_NEAR(result[3][3][3], expected_result[3][3][3], 0.0001);
    EXPECT_NEAR(result[3][3][4], expected_result[3][3][4], 0.0001);
    EXPECT_NEAR(result[3][3][5], expected_result[3][3][5], 0.0001);
    EXPECT_NEAR(result[3][3][6], expected_result[3][3][6], 0.0001);
    EXPECT_NEAR(result[3][3][7], expected_result[3][3][7], 0.0001);
    EXPECT_NEAR(result[3][4][0], expected_result[3][4][0], 0.0001);
    EXPECT_NEAR(result[3][4][1], expected_result[3][4][1], 0.0001);
    EXPECT_NEAR(result[3][4][2], expected_result[3][4][2], 0.0001);
    EXPECT_NEAR(result[3][4][3], expected_result[3][4][3], 0.0001);
    EXPECT_NEAR(result[3][4][4], expected_result[3][4][4], 0.0001);
    EXPECT_NEAR(result[3][4][5], expected_result[3][4][5], 0.0001);
    EXPECT_NEAR(result[3][4][6], expected_result[3][4][6], 0.0001);
    EXPECT_NEAR(result[3][4][7], expected_result[3][4][7], 0.0001);
    EXPECT_NEAR(result[3][5][0], expected_result[3][5][0], 0.0001);
    EXPECT_NEAR(result[3][5][1], expected_result[3][5][1], 0.0001);
    EXPECT_NEAR(result[3][5][2], expected_result[3][5][2], 0.0001);
    EXPECT_NEAR(result[3][5][3], expected_result[3][5][3], 0.0001);
    EXPECT_NEAR(result[3][5][4], expected_result[3][5][4], 0.0001);
    EXPECT_NEAR(result[3][5][5], expected_result[3][5][5], 0.0001);
    EXPECT_NEAR(result[3][5][6], expected_result[3][5][6], 0.0001);
    EXPECT_NEAR(result[3][5][7], expected_result[3][5][7], 0.0001);
    EXPECT_NEAR(result[3][6][0], expected_result[3][6][0], 0.0001);
    EXPECT_NEAR(result[3][6][1], expected_result[3][6][1], 0.0001);
    EXPECT_NEAR(result[3][6][2], expected_result[3][6][2], 0.0001);
    EXPECT_NEAR(result[3][6][3], expected_result[3][6][3], 0.0001);
    EXPECT_NEAR(result[3][6][4], expected_result[3][6][4], 0.0001);
    EXPECT_NEAR(result[3][6][5], expected_result[3][6][5], 0.0001);
    EXPECT_NEAR(result[3][6][6], expected_result[3][6][6], 0.0001);
    EXPECT_NEAR(result[3][6][7], expected_result[3][6][7], 0.0001);
    EXPECT_NEAR(result[3][7][0], expected_result[3][7][0], 0.0001);
    EXPECT_NEAR(result[3][7][1], expected_result[3][7][1], 0.0001);
    EXPECT_NEAR(result[3][7][2], expected_result[3][7][2], 0.0001);
    EXPECT_NEAR(result[3][7][3], expected_result[3][7][3], 0.0001);
    EXPECT_NEAR(result[3][7][4], expected_result[3][7][4], 0.0001);
    EXPECT_NEAR(result[3][7][5], expected_result[3][7][5], 0.0001);
    EXPECT_NEAR(result[3][7][6], expected_result[3][7][6], 0.0001);
    EXPECT_NEAR(result[3][7][7], expected_result[3][7][7], 0.0001);
}

/**
  * @test CONV2D.conv2d_view_with_weird_strides
  * @brief Ensure nn::conv2d accepts non-contiguous/alias views
  */
TEST(CONV2D, conv2d_view_with_weird_strides)
{
    Tensor<float> input_owner({20}, MemoryLocation:: DEVICE);
    std::vector<float> input_owner_vals = {
        0.00000000000000000, 1.00000000000000000, 2.00000000000000000, 3.00000000000000000, 4.00000000000000000, 5.00000000000000000, 6.00000000000000000, 7.00000000000000000, 8.00000000000000000, 9.00000000000000000, 10.00000000000000000, 11.00000000000000000, 12.00000000000000000, 13.00000000000000000, 14.00000000000000000, 15.00000000000000000, 16.00000000000000000, 17.00000000000000000, 18.00000000000000000, 19.00000000000000000
    };
    input_owner = input_owner_vals;

    Tensor<float> input_alias(
        input_owner,
        std::vector<uint64_t>{0ull},
        std::vector<uint64_t>{1ull, 2ull, 2ull},
        std::vector<uint64_t>{8ull, 4ull, 2ull}
    );

    Tensor<float> kernel_owner({20}, MemoryLocation:: DEVICE);
    std::vector<float> kernel_owner_vals = {
        0.00000000000000000, 1.00000000000000000, 2.00000000000000000, 3.00000000000000000, 4.00000000000000000, 5.00000000000000000, 6.00000000000000000, 7.00000000000000000, 8.00000000000000000, 9.00000000000000000, 10.00000000000000000, 11.00000000000000000, 12.00000000000000000, 13.00000000000000000, 14.00000000000000000, 15.00000000000000000, 16.00000000000000000, 17.00000000000000000, 18.00000000000000000, 19.00000000000000000
    };
    kernel_owner = kernel_owner_vals;

    Tensor<float> kernel_alias(
        kernel_owner,
        std::vector<uint64_t>{0ull},
        std::vector<uint64_t>{1ull, 1ull, 2ull, 2ull},
        std::vector<uint64_t>{8ull, 8ull, 4ull, 2ull}
    );

    Tensor<float> result = nn::conv2d(input_alias, kernel_alias, 1, {0, 0});

    Tensor<float> expected_result({1, 1, 1});
    expected_result = std:: vector<float>{16.00000000000000000};

    // compare element-wise (unroll to report precise index on failure)
    EXPECT_NEAR(result[0], expected_result[0], 0.0001);
}
